model AffiliatePayout {
  id                  String                        @id
  affiliateId         String
  amount              Decimal                       @db.Decimal(10, 2)
  currency            String                        @default("EGP")
  status              AffiliatePayoutsStatus        @default(PENDING)
  paymentMethod       AffiliatePayoutsPaymentMethod
  paymentDetails      String?                       @db.Text
  transactionId       String?
  externalReference   String?
  processedAt         DateTime?
  processedBy         String?
  isExternalPayment   Boolean                       @default(true)
  externalPaymentDate DateTime?
  notes               String?                       @db.Text
  createdAt           DateTime                      @default(now())
  updatedAt           DateTime
  affiliates          Affiliate                     @relation(fields: [affiliateId], references: [id], onDelete: Cascade)
  commissions         Commission[]

  @@index([affiliateId])
  @@index([paymentMethod])
  @@index([status])
}

model AffiliateProduct {
  id          String    @id
  affiliateId String
  productId   String
  basePrice   Decimal   @db.Decimal(10, 2)
  markup      Decimal   @db.Decimal(10, 2)
  finalPrice  Decimal   @db.Decimal(10, 2)
  isActive    Boolean   @default(true)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime
  affiliates  Affiliate @relation(fields: [affiliateId], references: [id], onDelete: Cascade)
  products    Product   @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([affiliateId, productId])
  @@index([affiliateId])
  @@index([productId])
}

model AffiliateReferral {
  id           String    @id
  affiliateId  String
  customerId   String?
  orderId      String?   @unique
  referralCode String
  referralUrl  String?   @db.Text
  ipAddress    String?
  userAgent    String?
  source       String?
  converted    Boolean   @default(false)
  convertedAt  DateTime?
  createdAt    DateTime  @default(now())
  affiliates   Affiliate @relation(fields: [affiliateId], references: [id], onDelete: Cascade)
  customers    Customer? @relation(fields: [customerId], references: [id])
  orders       Order?    @relation("OrderAffiliateReferral", references: [id], fields: [orderId])

  @@index([affiliateId])
  @@index([converted])
  @@index([customerId])
  @@index([orderId])
  @@index([referralCode])
}

model AffiliateSetting {
  id                  String   @id
  companyId           String   @unique
  commissionType      String   @default("PERCENTAGE")
  commissionRate      Float    @default(5)
  cookieDuration      Int      @default(30)
  termsAndConditions  String?  @db.Text
  isActive            Boolean  @default(true)
  createdAt           DateTime @default(now())
  updatedAt           DateTime
  platformMarginType  String   @default("FIXED")
  platformMarginValue Float    @default(0)
  companies           Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
}

model Affiliate {
  id                       String                   @id
  userId                   String                   @unique
  companyId                String?
  affiliateCode            String                   @unique
  commissionType           AffiliatesCommissionType @default(PERCENTAGE)
  commissionRate           Float                    @default(5)
  status                   AffiliatesStatus         @default(PENDING)
  totalEarnings            Decimal                  @default(0.00) @db.Decimal(12, 2)
  paidEarnings             Decimal                  @default(0.00) @db.Decimal(12, 2)
  pendingEarnings          Decimal                  @default(0.00) @db.Decimal(12, 2)
  totalSales               Int                      @default(0)
  totalClicks              Int                      @default(0)
  conversionRate           Float                    @default(0)
  paymentMethod            AffiliatesPaymentMethod?
  paymentDetails           String?                  @db.Text
  minPayout                Decimal                  @default(100.00) @db.Decimal(10, 2)
  canCreateOrdersForOthers Boolean                  @default(true)
  canViewCustomerData      Boolean                  @default(true)
  createdAt                DateTime                 @default(now())
  updatedAt                DateTime
  affiliate_payouts        AffiliatePayout[]
  affiliate_products       AffiliateProduct[]
  affiliate_referrals      AffiliateReferral[]
  companies                Company?                 @relation(fields: [companyId], references: [id], onDelete: Cascade)
  users                    User                     @relation(fields: [userId], references: [id], onDelete: Cascade)
  commissions              Commission[]
  guestOrders              GuestOrder[]
  orders                   Order[]

  @@index([affiliateCode])
  @@index([companyId])
  @@index([status])
}

model Commission {
  id                String                      @id
  orderId           String
  affiliateId       String?
  merchantId        String?
  type              CommissionType
  calculationType   CommissionsCalculationType?
  amount            Decimal                     @db.Decimal(10, 2)
  rate              Float?
  markup            Decimal?                    @db.Decimal(10, 2)
  baseAmount        Decimal?                    @db.Decimal(10, 2)
  status            CommissionsStatus           @default(CONFIRMED)
  orderTotal        Decimal                     @db.Decimal(10, 2)
  companyId         String
  paidAt            DateTime?
  payoutId          String?
  notes             String?                     @db.Text
  createdAt         DateTime                    @default(now())
  updatedAt         DateTime
  affiliates        Affiliate?                  @relation(fields: [affiliateId], references: [id])
  companies         Company                     @relation(fields: [companyId], references: [id], onDelete: Cascade)
  merchants         Merchant?                   @relation(fields: [merchantId], references: [id])
  orders            Order                       @relation(fields: [orderId], references: [id], onDelete: Cascade)
  affiliate_payouts AffiliatePayout?            @relation(fields: [payoutId], references: [id])

  @@index([affiliateId])
  @@index([companyId])
  @@index([merchantId])
  @@index([orderId])
  @@index([payoutId])
  @@index([status])
}

model AiAnalytic {
  id                    String   @id
  date                  DateTime @db.Date
  totalMessages         Int      @default(0)
  aiResponses           Int      @default(0)
  humanHandoffs         Int      @default(0)
  avgResponseTime       Float?
  avgConfidence         Float?
  topIntents            String?
  sentimentDistribution String?
  createdAt             DateTime @default(now())

  @@index([date])
  @@map("ai_analytics")
}

model AiInteraction {
  id                        String    @id
  companyId                 String
  customerId                String?
  userMessage               String    @db.Text
  aiResponse                String    @db.Text
  intent                    String?
  sentiment                 String?
  confidence                Float?
  requiresHumanIntervention Boolean   @default(false)
  metadata                  String?   @db.Text
  createdAt                 DateTime  @default(now())
  modelUsed                 String?
  responseTime              Int?
  tokensUsed                Int?
  keyId                     String?
  keyName                   String?
  companies                 Company   @relation(fields: [companyId], references: [id], onDelete: Cascade)
  customers                 Customer? @relation(fields: [customerId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([customerId])
  @@index([keyName])
  @@index([modelUsed])
  @@map("ai_interactions")
}

model AiKey {
  id                String          @id
  name              String
  provider          AiKeysProvider  @default(GOOGLE)
  apiKey            String          @unique
  baseUrl           String?
  isActive          Boolean         @default(true)
  companyId         String?
  keyType           AiKeysKeyType   @default(CENTRAL)
  usage             String          @db.Text
  currentUsage      Int             @default(0)
  maxRequestsPerDay Int             @default(1500)
  priority          Int             @default(1)
  createdAt         DateTime        @default(now())
  updatedAt         DateTime
  companies         Company?        @relation(fields: [companyId], references: [id], onDelete: Cascade)
  aiModelConfigs    AiModelConfig[]

  @@index([companyId])
  @@index([provider, isActive])
  @@map("ai_keys")
}

model AiModelConfig {
  id        String   @id
  keyId     String
  modelName String
  isEnabled Boolean  @default(true)
  priority  Int      @default(1)
  usage     String?  @db.Text
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now())
  aiKey     AiKey    @relation(fields: [keyId], references: [id], onDelete: Cascade)

  @@unique([keyId, modelName])
  @@index([keyId])
  @@map("ai_model_configs")
}

model AiNotification {
  id        String    @id
  companyId String
  type      String
  severity  String    @default("medium")
  title     String
  message   String    @db.Text
  metadata  String?   @db.Text
  isRead    Boolean   @default(false)
  readAt    DateTime?
  createdAt DateTime  @default(now())
  updatedAt DateTime

  @@index([companyId])
  @@index([createdAt])
  @@index([isRead])
  @@map("ai_notifications")
}

model AiSettings {
  id                         String   @id
  companyId                  String   @unique
  promptTemplate             String?  @db.Text
  autoReplyEnabled           Boolean  @default(false)
  confidenceThreshold        Float    @default(0.7)
  escalationRules            String?  @db.Text
  createdAt                  DateTime @default(now())
  updatedAt                  DateTime
  autoCreateOrders           Boolean  @default(false)
  autoSuggestProducts        Boolean  @default(true)
  defaultProductId           String?
  includeImages              Boolean  @default(true)
  maxSuggestions             Int      @default(3)
  modelSettings              String?  @db.Text
  responsePrompt             String?  @db.Text
  memorySettings             String?  @db.Text
  useAdvancedTools           Boolean  @default(false)
  workingHours               String?  @db.Text
  workingHoursEnabled        Boolean  @default(true)
  maxRepliesPerCustomer      Int      @default(5)
  multimodalEnabled          Boolean  @default(true)
  ragEnabled                 Boolean  @default(true)
  qualityEvaluationEnabled   Boolean  @default(true)
  queueSettings              String?  @db.Text
  aiMaxTokens                Int?     @default(2048)
  aiResponseStyle            String?  @default("balanced")
  aiTemperature              Float?   @default(0.7)
  aiTopK                     Int?     @default(40)
  aiTopP                     Float?   @default(0.9)
  enableDiversityCheck       Boolean  @default(true)
  enableEmotionalResponse    Boolean  @default(true)
  enableLongTermMemory       Boolean  @default(false)
  enableLowQualityAlerts     Boolean  @default(true)
  enableSmartSuggestions     Boolean  @default(false)
  enableToneAdaptation       Boolean  @default(true)
  maxMessagesPerConversation Int?     @default(50)
  memoryRetentionDays        Int?     @default(30)
  minQualityScore            Float?   @default(70)
  replyMode                  String   @default("all")
  autoCleanup                Boolean  @default(true)
  compressionEnabled         Boolean  @default(false)
  maxConversationsPerUser    Int?     @default(100)
  responseRules              String?  @db.Text
  disableDefaultTemplates    Boolean  @default(false)
  enableFailover             Boolean  @default(true)
  useModernAgent             Boolean  @default(false)
  companies                  Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@map("ai_settings")
}

model LearningData {
  id             String   @id
  companyId      String
  customerId     String?
  conversationId String?
  type           String
  data           String?  @db.Text
  userMessage    String?  @db.Text
  aiResponse     String?  @db.Text
  intent         String?
  sentiment      String?
  processingTime Int?
  ragDataUsed    Boolean  @default(false)
  memoryUsed     Boolean  @default(false)
  model          String?
  confidence     Float?
  outcome        String?
  feedback       String?  @db.Text
  insights       String?  @db.Text
  metadata       String?  @db.Text
  createdAt      DateTime @default(now())
  companies      Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([confidence])
  @@index([createdAt])
  @@index([intent])
  @@index([type])
  @@map("learning_data")
}

model LearningSettings {
  id                    String   @id
  companyId             String   @unique
  enabled               Boolean  @default(true)
  learningSpeed         String   @default("medium")
  autoApplyImprovements Boolean  @default(false)
  dataRetentionDays     Int      @default(90)
  minimumSampleSize     Int      @default(50)
  confidenceThreshold   Float    @default(0.8)
  settings              String?  @db.Text
  createdAt             DateTime @default(now())
  updatedAt             DateTime
  companies             Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@map("learning_settings")
}

model SearchAnalytic {
  id            String   @id
  companyId     String
  customerId    String?
  query         String   @db.Text
  intent        String?
  resultsCount  Int      @default(0)
  wasSuccessful Boolean  @default(true)
  responseTime  Int?
  metadata      String?  @db.Text
  createdAt     DateTime @default(now())

  @@index([companyId, createdAt])
  @@index([companyId])
  @@index([intent])
  @@index([wasSuccessful])
  @@map("search_analytics")
}

model AiFailureLog {
  id             String   @id
  companyId      String
  conversationId String?
  customerId     String?
  errorType      String   @db.VarChar(100)
  errorMessage   String?  @db.Text
  context        String?  @db.LongText
  createdAt      DateTime @default(now())

  @@index([companyId, createdAt])
  @@index([errorType])
  @@map("ai_failure_logs")
}

model AIChatMessage {
  id               String        @id
  sessionId        String
  role             String
  content          String        @db.LongText
  isError          Boolean       @default(false)
  createdAt        DateTime      @default(now())
  ai_chat_sessions AIChatSession @relation(fields: [sessionId], references: [id], onDelete: Cascade)

  @@index([sessionId])
}

model AIChatSession {
  id               String          @id
  userId           String
  title            String?
  isActive         Boolean         @default(true)
  createdAt        DateTime        @default(now())
  updatedAt        DateTime
  ai_chat_messages AIChatMessage[]
  dev_team_members DevTeamMember   @relation(fields: [userId], references: [id])

  @@index([userId])
}

model AiTraceStep {
  id        String   @id @default(cuid())
  traceId   String
  stepType  String // EXPANSION, RETRIEVAL, RERANK, GENERATION
  latencyMs Int
  input     String   @db.Text
  output    String   @db.Text
  metadata  String?  @db.Text
  order     Int
  createdAt DateTime @default(now())

  trace AiTrace @relation(fields: [traceId], references: [id], onDelete: Cascade)

  @@index([traceId])
  @@index([createdAt])
  @@map("ai_trace_steps")
}

model AiTrace {
  id        String   @id @default(cuid())
  companyId String
  query     String   @db.Text
  timestamp DateTime @default(now())
  latencyMs Int?
  metadata  String?  @db.Text
  createdAt DateTime @default(now())

  company Company       @relation(fields: [companyId], references: [id], onDelete: Cascade)
  steps   AiTraceStep[]

  @@index([companyId])
  @@index([createdAt])
  @@map("ai_traces")
}

model DailyAnalytic {
  id                 String   @id @default(cuid())
  companyId          String
  date               DateTime @db.Date
  totalVisits        Int      @default(0)
  uniqueVisitors     Int      @default(0)
  totalProductViews  Int      @default(0)
  totalAddToCarts    Int      @default(0)
  totalCheckouts     Int      @default(0)
  totalPurchases     Int      @default(0)
  totalRevenue       Decimal  @default(0) @db.Decimal(12, 2)
  conversionRate     Decimal  @default(0) @db.Decimal(5, 2)
  avgOrderValue      Decimal  @default(0) @db.Decimal(10, 2)
  bounceRate         Decimal  @default(0) @db.Decimal(5, 2)
  avgSessionDuration Int      @default(0)
  company            Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@unique([companyId, date])
  @@index([companyId, date])
  @@map("daily_analytics")
}

model ProductAnalytic {
  id              String   @id @default(cuid())
  productId       String
  companyId       String
  date            DateTime @db.Date
  views           Int      @default(0)
  uniqueViews     Int      @default(0)
  addToCarts      Int      @default(0)
  purchases       Int      @default(0)
  revenue         Decimal  @default(0) @db.Decimal(10, 2)
  conversionRate  Decimal  @default(0) @db.Decimal(5, 2)
  avgViewDuration Int      @default(0)
  product         Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  company         Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@unique([companyId, productId, date])
  @@index([companyId, date])
  @@index([productId, companyId])
  @@map("product_analytics")
}

model AssetAssignment {
  id              String          @id @default(cuid())
  assetId         String
  userId          String
  assignedBy      String? // User ID
  assignedAt      DateTime        @default(now())
  returnedAt      DateTime?
  returnCondition AssetCondition?
  notes           String?         @db.Text

  asset Asset @relation(fields: [assetId], references: [id], onDelete: Cascade)
  // user     User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  // assigner User?    @relation("AssetAssigner", fields: [assignedBy], references: [id])

  @@index([assetId])
  @@index([userId])
  @@index([assignedBy])
  @@map("asset_assignments")
}

model AssetCategory {
  id          String   @id @default(cuid())
  companyId   String
  name        String
  description String?  @db.Text
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  company Company @relation(fields: [companyId], references: [id], onDelete: Cascade)
  assets  Asset[]

  @@unique([companyId, name])
  @@index([companyId])
  @@map("asset_categories")
}

model AssetMaintenance {
  id             String    @id @default(cuid())
  assetId        String
  type           String // Repair, Maintenance, Upgrade
  description    String    @db.Text
  cost           Decimal?  @db.Decimal(12, 2)
  status         String // Scheduled, In Progress, Completed
  startDate      DateTime
  completionDate DateTime?
  performedBy    String? // Vendor or Person
  notes          String?   @db.Text
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  asset Asset @relation(fields: [assetId], references: [id], onDelete: Cascade)

  @@index([assetId])
  @@map("asset_maintenance")
}

model Asset {
  id            String         @id @default(cuid())
  companyId     String
  categoryId    String?
  name          String
  description   String?        @db.Text
  code          String? // Asset Tag/Number
  serialNumber  String?
  model         String?
  brand         String?
  status        AssetStatus    @default(AVAILABLE)
  condition     AssetCondition @default(NEW)
  purchaseDate  DateTime?
  purchaseValue Decimal?       @db.Decimal(12, 2)
  currency      String         @default("EGP")
  location      String?
  branchId      String? // Branch/Location
  image         String?
  notes         String?        @db.Text
  metadata      String?        @db.Text

  // Warranty fields
  warrantyStartDate DateTime?
  warrantyEndDate   DateTime?
  warrantyMonths    Int?
  warrantyProvider  String?

  // Depreciation fields
  depreciationMethod String?  @default("STRAIGHT_LINE") // STRAIGHT_LINE, DECLINING_BALANCE
  usefulLifeYears    Int?     @default(5)
  salvageValue       Decimal? @db.Decimal(12, 2)
  currentBookValue   Decimal? @db.Decimal(12, 2)

  assignedToId String? // Current holder (User)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  company        Company               @relation(fields: [companyId], references: [id], onDelete: Cascade)
  category       AssetCategory?        @relation(fields: [categoryId], references: [id])
  // currentHolder User?              @relation("CurrentAssetHolder", fields: [assignedToId], references: [id])
  assignments    AssetAssignment[]
  maintenance    AssetMaintenance[]
  custodyHistory AssetCustodyHistory[]
  requests       AssetRequest[]
  audits         AssetAudit[]
  attachments    AssetAttachment[]

  @@unique([companyId, code])
  @@index([companyId])
  @@index([categoryId])
  @@index([status])
  @@index([assignedToId])
  @@index([branchId])
  @@map("assets")
}

model AssetCustodyHistory {
  id              String          @id @default(cuid())
  assetId         String
  userId          String
  assignedBy      String?
  action          String // ASSIGNED, RETURNED, TRANSFERRED
  assignedAt      DateTime        @default(now())
  returnedAt      DateTime?
  returnCondition AssetCondition?
  notes           String?         @db.Text
  documentUrl     String? // PDF custody form
  signatureUrl    String? // Signature image
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt

  asset Asset @relation(fields: [assetId], references: [id], onDelete: Cascade)

  @@index([assetId])
  @@index([userId])
  @@index([assignedBy])
  @@map("asset_custody_history")
}

model AssetRequest {
  id              String             @id @default(cuid())
  companyId       String
  assetId         String?
  requestedBy     String // User ID
  assetType       String // Type of asset requested
  category        String?
  reason          String             @db.Text
  priority        String             @default("NORMAL") // LOW, NORMAL, HIGH, URGENT
  status          AssetRequestStatus @default(PENDING)
  approvedBy      String?
  approvedAt      DateTime?
  rejectedBy      String?
  rejectedAt      DateTime?
  rejectionReason String?            @db.Text
  fulfilledBy     String?
  fulfilledAt     DateTime?
  notes           String?            @db.Text
  createdAt       DateTime           @default(now())
  updatedAt       DateTime           @updatedAt

  asset Asset? @relation(fields: [assetId], references: [id])

  @@index([companyId])
  @@index([assetId])
  @@index([requestedBy])
  @@index([status])
  @@map("asset_requests")
}

model AssetAudit {
  id             String          @id @default(cuid())
  companyId      String
  assetId        String?
  auditName      String
  auditDate      DateTime
  status         String          @default("IN_PROGRESS") // IN_PROGRESS, COMPLETED
  conductedBy    String
  assetFound     Boolean?
  assetCondition AssetCondition?
  discrepancy    String?         @db.Text
  notes          String?         @db.Text
  completedAt    DateTime?
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt

  asset Asset? @relation(fields: [assetId], references: [id])

  @@index([companyId])
  @@index([assetId])
  @@index([status])
  @@map("asset_audits")
}

model AssetAttachment {
  id          String   @id @default(cuid())
  assetId     String
  type        String // IMAGE, INVOICE, WARRANTY, MANUAL, OTHER
  fileName    String
  fileUrl     String
  fileSize    Int?
  mimeType    String?
  description String?  @db.Text
  uploadedBy  String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  asset Asset @relation(fields: [assetId], references: [id], onDelete: Cascade)

  @@index([assetId])
  @@index([type])
  @@map("asset_attachments")
}

model Conversation {
  id                        String               @id
  customerId                String
  assignedUserId            String?
  channel                   ConversationsChannel
  status                    ConversationsStatus  @default(ACTIVE)
  subject                   String?
  priority                  Int                  @default(1)
  tags                      String?
  lastMessageAt             DateTime?
  lastMessagePreview        String?
  isRead                    Boolean              @default(false)
  metadata                  String?              @db.Text
  companyId                 String
  createdAt                 DateTime             @default(now())
  updatedAt                 DateTime
  aiEnabled                 Boolean              @default(true)
  lastMessageIsFromCustomer Boolean              @default(false)
  unreadCount               Int                  @default(0)
  broadcastRecipients       BroadcastRecipient[]
  users                     User?                @relation(fields: [assignedUserId], references: [id])
  companies                 Company              @relation(fields: [companyId], references: [id], onDelete: Cascade)
  customers                 Customer             @relation(fields: [customerId], references: [id], onDelete: Cascade)
  messages                  Message[]
  orders                    Order[]

  @@index([assignedUserId])
  @@index([companyId])
  @@index([companyId, lastMessageAt])
  @@index([companyId, status, lastMessageAt])
  @@index([customerId])
  @@index([lastMessageAt])
  @@index([status])
  @@index([companyId, lastMessageIsFromCustomer, status])
  @@map("conversations")
}

model PromptTemplate {
  id          String   @id
  companyId   String
  key         String
  content     String
  description String?
  category    String   @default("general")
  variables   String?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime

  @@unique([companyId, key])
  @@index([companyId])
}

model CheckoutFormSettings {
  id                     String   @id
  companyId              String   @unique
  showGuestName          Boolean  @default(true)
  requireGuestName       Boolean  @default(true)
  showGuestPhone         Boolean  @default(true)
  requireGuestPhone      Boolean  @default(true)
  showGuestEmail         Boolean  @default(true)
  requireGuestEmail      Boolean  @default(false)
  showCity               Boolean  @default(true)
  requireCity            Boolean  @default(true)
  showShippingAddress    Boolean  @default(true)
  requireShippingAddress Boolean  @default(true)
  showPaymentMethod      Boolean  @default(true)
  showNotes              Boolean  @default(true)
  createdAt              DateTime @default(now())
  updatedAt              DateTime
  companies              Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@map("checkout_form_settings")
}

model ConversationMemory {
  id             String   @id
  conversationId String
  senderId       String
  userMessage    String
  aiResponse     String
  intent         String?
  sentiment      String?
  timestamp      DateTime @default(now())
  metadata       String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime
  companyId      String
  companies      Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId, conversationId])
  @@index([companyId])
  @@index([companyId, senderId])
  @@index([conversationId])
  @@index([senderId])
  @@index([timestamp])
  @@map("conversation_memory")
}

model ConversationOutcome {
  id                   String   @id
  conversationId       String
  customerId           String
  companyId            String
  outcome              String
  outcomeValue         Float?
  responseQuality      Float?
  customerSatisfaction Float?
  conversionTime       Int?
  messageCount         Int?
  aiResponseCount      Int?
  humanHandoff         Boolean  @default(false)
  metadata             String?  @db.Text
  createdAt            DateTime @default(now())
  updatedAt            DateTime
  companies            Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  customers            Customer @relation(fields: [customerId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([conversationId])
  @@index([createdAt])
  @@index([customerId])
  @@index([outcome])
  @@map("conversation_outcomes")
}

model DevNotification {
  id               String        @id
  memberId         String
  taskId           String?
  projectId        String?
  type             String
  title            String
  message          String        @db.Text
  isRead           Boolean       @default(false)
  readAt           DateTime?
  link             String?
  createdAt        DateTime      @default(now())
  dev_team_members DevTeamMember @relation(fields: [memberId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([isRead])
  @@index([memberId])
  @@map("dev_notifications")
}

model DevProject {
  id               String              @id
  name             String
  description      String              @db.Text
  status           DevProjectsStatus   @default(PLANNING)
  priority         DevProjectsPriority @default(MEDIUM)
  color            String              @default("#6366f1")
  icon             String?
  startDate        DateTime?
  endDate          DateTime?
  progress         Int                 @default(0)
  managerId        String?
  teamMembers      String?             @db.LongText
  tags             String?             @db.LongText
  repository       String?
  createdAt        DateTime            @default(now())
  updatedAt        DateTime
  dev_team_members DevTeamMember?      @relation(fields: [managerId], references: [id])
  dev_releases     DevRelease[]
  dev_tasks        DevTask[]

  companyRel   Company? @relation(fields: [companyRelId], references: [id])
  companyRelId String?

  @@index([managerId])
  @@index([priority])
  @@index([status])
  @@map("dev_projects")
}

model DevRelease {
  id           String            @id
  version      String
  name         String
  description  String?           @db.Text
  status       DevReleasesStatus @default(PLANNING)
  releaseDate  DateTime?
  changelog    String?           @db.LongText
  projectId    String?
  createdAt    DateTime          @default(now())
  updatedAt    DateTime
  dev_projects DevProject?       @relation(fields: [projectId], references: [id])
  dev_tasks    DevTask[]

  @@index([projectId])
  @@index([releaseDate])
  @@index([status])
  @@map("dev_releases")
}

model DevTaskActivity {
  id               String         @id
  taskId           String
  memberId         String?
  action           String
  field            String?
  oldValue         String?        @db.Text
  newValue         String?        @db.Text
  description      String?        @db.Text
  createdAt        DateTime       @default(now())
  dev_team_members DevTeamMember? @relation(fields: [memberId], references: [id])
  dev_tasks        DevTask        @relation(fields: [taskId], references: [id], onDelete: Cascade)

  @@index([action])
  @@index([createdAt])
  @@index([memberId])
  @@index([taskId])
  @@map("dev_task_activities")
}

model DevTaskAttachment {
  id           String   @id
  taskId       String
  fileName     String
  originalName String
  fileSize     Int
  fileType     String
  filePath     String
  uploadedBy   String
  createdAt    DateTime @default(now())
  dev_tasks    DevTask  @relation(fields: [taskId], references: [id], onDelete: Cascade)

  @@index([taskId])
  @@map("dev_task_attachments")
}

model DevTaskChecklistItem {
  id               String           @id
  checklistId      String
  content          String
  isCompleted      Boolean          @default(false)
  completedAt      DateTime?
  completedBy      String?
  position         Int              @default(0)
  createdAt        DateTime         @default(now())
  updatedAt        DateTime
  devTaskChecklist DevTaskChecklist @relation(fields: [checklistId], references: [id], onDelete: Cascade)

  @@index([checklistId])
  @@map("dev_task_checklist_items")
}

model DevTaskChecklist {
  id                    String                 @id
  taskId                String
  title                 String
  position              Int                    @default(0)
  createdAt             DateTime               @default(now())
  updatedAt             DateTime
  devTaskChecklistItems DevTaskChecklistItem[]
  dev_tasks             DevTask                @relation(fields: [taskId], references: [id], onDelete: Cascade)

  @@index([taskId])
  @@map("dev_task_checklists")
}

model DevTaskComment {
  id                      String           @id
  taskId                  String
  authorId                String
  content                 String           @db.Text
  parentCommentId         String?
  mentions                String?          @db.LongText
  isEdited                Boolean          @default(false)
  editedAt                DateTime?
  createdAt               DateTime         @default(now())
  updatedAt               DateTime
  dev_team_members        DevTeamMember    @relation(fields: [authorId], references: [id])
  devTaskComment          DevTaskComment?  @relation("dev_task_commentsTodev_task_comments", fields: [parentCommentId], references: [id])
  other_dev_task_comments DevTaskComment[] @relation("dev_task_commentsTodev_task_comments")
  dev_tasks               DevTask          @relation(fields: [taskId], references: [id], onDelete: Cascade)

  @@index([authorId])
  @@index([parentCommentId])
  @@index([taskId])
  @@map("dev_task_comments")
}

model DevTaskWatcher {
  id               String        @id
  taskId           String
  memberId         String
  createdAt        DateTime      @default(now())
  dev_team_members DevTeamMember @relation(fields: [memberId], references: [id], onDelete: Cascade)
  dev_tasks        DevTask       @relation(fields: [taskId], references: [id], onDelete: Cascade)

  @@unique([taskId, memberId])
  @@index([memberId])
  @@index([taskId])
  @@map("dev_task_watchers")
}

model DevTask {
  id                                                      String              @id
  title                                                   String
  description                                             String              @db.Text
  type                                                    DevTaskType         @default(FEATURE)
  status                                                  DevTasksStatus      @default(BACKLOG)
  priority                                                DevTasksPriority    @default(MEDIUM)
  component                                               String?
  assigneeId                                              String?
  reporterId                                              String
  projectId                                               String?
  releaseId                                               String?
  parentTaskId                                            String?
  order                                                   Int                 @default(0)
  dueDate                                                 DateTime?
  startDate                                               DateTime?
  completedDate                                           DateTime?
  estimatedHours                                          Float               @default(0)
  actualHours                                             Float               @default(0)
  progress                                                Int                 @default(0)
  tags                                                    String?             @db.LongText
  labels                                                  String?             @db.LongText
  gitBranch                                               String?
  gitPR                                                   String?
  companyId                                               String?
  ticketId                                                String?
  createdAt                                               DateTime            @default(now())
  updatedAt                                               DateTime
  acceptanceCriteria                                      String?             @db.Text
  businessValue                                           String?             @db.Text
  xpEarned                                                Int?
  relatedLinks                                            String?             @db.LongText
  devTaskActivities                                       DevTaskActivity[]
  devTaskAttachments                                      DevTaskAttachment[]
  devTaskChecklists                                       DevTaskChecklist[]
  devTaskComments                                         DevTaskComment[]
  devTaskWatchers                                         DevTaskWatcher[]
  dev_team_members_dev_tasks_assigneeIdTodev_team_members DevTeamMember?      @relation("dev_tasks_assigneeIdTodev_team_members", fields: [assigneeId], references: [id])
  dev_tasks                                               DevTask?            @relation("dev_tasksTodev_tasks", fields: [parentTaskId], references: [id])
  other_dev_tasks                                         DevTask[]           @relation("dev_tasksTodev_tasks")
  dev_projects                                            DevProject?         @relation(fields: [projectId], references: [id])
  dev_releases                                            DevRelease?         @relation(fields: [releaseId], references: [id])
  dev_team_members_dev_tasks_reporterIdTodev_team_members DevTeamMember       @relation("dev_tasks_reporterIdTodev_team_members", fields: [reporterId], references: [id])
  devTimeLogs                                             DevTimeLog[]

  companyRel   Company? @relation(fields: [companyRelId], references: [id])
  companyRelId String?

  @@index([assigneeId])
  @@index([component])
  @@index([dueDate])
  @@index([order])
  @@index([parentTaskId])
  @@index([priority])
  @@index([projectId])
  @@index([releaseId])
  @@index([reporterId])
  @@index([status])
  @@index([type])
  @@map("dev_tasks")
}

model ExcludedModel {
  id          String    @id
  modelName   String
  keyId       String?
  companyId   String?
  reason      String
  excludedAt  DateTime  @default(now())
  retryAt     DateTime
  retryCount  Int       @default(0)
  lastRetryAt DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime

  @@index([companyId])
  @@index([modelName, keyId])
  @@index([retryAt])
  @@map("excluded_models")
}

model FewShotExample {
  id              String    @id
  companyId       String
  customerMessage String    @db.Text
  aiResponse      String    @db.Text
  category        String?
  tags            String?   @db.Text
  priority        Int       @default(0)
  isActive        Boolean   @default(true)
  usageCount      Int       @default(0)
  lastUsedAt      DateTime?
  notes           String?   @db.Text
  createdAt       DateTime  @default(now())
  updatedAt       DateTime

  @@index([category])
  @@index([companyId])
  @@index([isActive])
  @@index([priority])
  @@map("few_shot_examples")
}

model FewShotSettings {
  id                   String   @id
  companyId            String   @unique
  enabled              Boolean  @default(false)
  maxExamplesPerPrompt Int      @default(3)
  selectionStrategy    String   @default("priority")
  autoLearnFromGood    Boolean  @default(false)
  minQualityScore      Float    @default(80)
  createdAt            DateTime @default(now())
  updatedAt            DateTime

  @@map("few_shot_settings")
}

model FooterSettings {
  id             String   @id
  companyId      String   @unique
  aboutStore     String?  @db.Text
  showAboutStore Boolean  @default(true)
  email          String?
  showEmail      Boolean  @default(true)
  phone          String?
  showPhone      Boolean  @default(true)
  address        String?  @db.Text
  showAddress    Boolean  @default(true)
  showQuickLinks Boolean  @default(true)
  copyrightText  String?  @db.Text
  showCopyright  Boolean  @default(true)
  createdAt      DateTime @default(now())
  updatedAt      DateTime
  companies      Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@map("footer_settings")
}

model GlobalAiConfig {
  id              String                         @id
  defaultProvider GlobalAiConfigsDefaultProvider @default(GOOGLE)
  isActive        Boolean                        @default(true)
  settings        String?                        @db.Text
  createdAt       DateTime                       @default(now())
  updatedAt       DateTime
  enableFailover  Boolean                        @default(true)

  @@map("global_ai_configs")
}

model HomepageTemplate {
  id          String   @id
  companyId   String
  name        String
  description String?  @db.Text
  content     String   @db.LongText
  thumbnail   String?  @db.Text
  isActive    Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime
  companies   Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([isActive])
  @@map("homepage_templates")
}

model ImageGallery {
  id        String   @id
  userId    String
  companyId String
  filename  String
  fileUrl   String
  fileType  String
  fileSize  Int
  createdAt DateTime @default(now())
  updatedAt DateTime
  companies Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  users     User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([createdAt])
  @@index([userId])
  @@map("image_gallery")
}

model Inventory {
  id              String    @id
  productId       String
  warehouseId     String
  quantity        Int       @default(0)
  reserved        Int       @default(0)
  available       Int       @default(0)
  minStock        Int       @default(0)
  maxStock        Int?
  reorderPoint    Int       @default(0)
  reorderQuantity Int       @default(0)
  cost            Decimal?  @db.Decimal(10, 2)
  createdAt       DateTime  @default(now())
  updatedAt       DateTime
  batchNumber     String?
  expiryDate      DateTime?
  products        Product   @relation(fields: [productId], references: [id], onDelete: Cascade)
  warehouse       Warehouse @relation(fields: [warehouseId], references: [id], onDelete: Cascade)

  @@unique([productId, warehouseId, batchNumber])
  @@index([productId])
  @@index([warehouseId])
  @@map("inventory")
}

model KnowledgeBase {
  id        String   @id
  title     String
  content   String
  category  String
  tags      String?
  isActive  Boolean  @default(true)
  priority  Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime

  @@index([category])
  @@index([isActive])
  @@map("knowledge_base")
}

model MediaFile {
  id             String   @id
  conversationId String
  senderId       String
  fileName       String
  fileType       String
  fileSize       Int?
  fileUrl        String
  analysis       String?
  processed      Boolean  @default(false)
  createdAt      DateTime @default(now())

  @@index([conversationId])
  @@index([fileType])
  @@map("media_files")
}

model Message {
  id             String       @id
  conversationId String
  senderId       String?
  type           MessageType  @default(TEXT)
  content        String       @db.Text
  attachments    String?      @db.Text
  metadata       String?      @db.Text
  isFromCustomer Boolean      @default(true)
  isRead         Boolean      @default(false)
  readAt         DateTime?
  createdAt      DateTime     @default(now())
  updatedAt      DateTime
  conversation   Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  users          User?        @relation(fields: [senderId], references: [id])

  @@index([conversationId, isFromCustomer, createdAt])
  @@index([conversationId])
  @@index([conversationId, createdAt])
  @@index([createdAt])
  @@index([isFromCustomer])
  @@index([senderId])
  @@map("messages")
}

model Notification {
  id        String    @id @default(cuid())
  title     String
  message   String
  type      String
  data      Json?
  isRead    Boolean   @default(false)
  readAt    DateTime?
  createdAt DateTime  @default(now())

  userId    String?
  companyId String

  user    User?   @relation(fields: [userId], references: [id])
  company Company @relation(fields: [companyId], references: [id])

  @@index([companyId])
  @@index([userId])
  @@map("notifications")
}

model PageResponseSettings {
  id                    String   @id
  pageId                String
  companyId             String
  responseMethod        String
  fixedMessengerMessage String?  @db.Text
  aiPrompt              String?  @db.Text
  createdAt             DateTime @default(now())
  updatedAt             DateTime
  commentMessages       String?  @db.Text
  companies             Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@unique([pageId, companyId])
  @@index([companyId])
  @@index([pageId])
  @@map("page_response_settings")
}

model PlanConfiguration {
  id            String    @id
  planType      String    @unique
  price         Float
  currency      String    @default("EGP")
  billingCycle  String    @default("monthly")
  features      String    @db.LongText
  description   String?
  descriptionEn String?
  isActive      Boolean   @default(true)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime
  companies     Company[]

  @@map("plan_configurations")
}

model PostResponseSettings {
  id                    String   @id
  postId                String
  companyId             String
  responseMethod        String
  createdAt             DateTime @default(now())
  updatedAt             DateTime
  aiPrompt              String?  @db.Text
  fixedMessengerMessage String?  @db.Text
  commentMessages       String?  @db.Text
  featuredProductId     String?
  companies             Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  products              Product? @relation(fields: [featuredProductId], references: [id])

  @@unique([postId, companyId])
  @@index([companyId])
  @@index([featuredProductId])
  @@index([postId])
  @@map("post_response_settings")
}

model PostTracking {
  id           String   @id
  postId       String
  companyId    String
  visitCount   Int      @default(1)
  firstVisitAt DateTime @default(now())
  lastVisitAt  DateTime @default(now())
  createdAt    DateTime @default(now())
  updatedAt    DateTime
  companies    Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@unique([postId, companyId])
  @@index([companyId])
  @@index([lastVisitAt])
  @@index([postId])
  @@map("post_tracking")
}

model Project {
  id          String           @id
  name        String
  description String           @db.Text
  status      ProjectsStatus   @default(PLANNING)
  priority    ProjectsPriority @default(MEDIUM)
  startDate   DateTime?
  endDate     DateTime?
  budget      Decimal?         @db.Decimal(10, 2)
  spentBudget Decimal?         @default(0.00) @db.Decimal(10, 2)
  progress    Int              @default(0)
  managerId   String
  teamMembers String?          @db.LongText
  tags        String?          @db.LongText
  companyId   String
  createdAt   DateTime         @default(now())
  updatedAt   DateTime
  companies   Company          @relation(fields: [companyId], references: [id], onDelete: Cascade)
  users       User             @relation(fields: [managerId], references: [id])
  tasks       Task[]

  @@index([companyId])
  @@index([managerId])
  @@index([priority])
  @@index([status])
}

model PromptLibrary {
  id             String   @id
  name           String
  nameAr         String?
  description    String   @db.Text
  descriptionAr  String?  @db.Text
  category       String
  businessType   String?
  promptContent  String   @db.Text
  responsePrompt String?  @db.Text
  variables      String?  @db.Text
  tags           String?  @db.Text
  icon           String?
  previewImage   String?
  isActive       Boolean  @default(true)
  isFeatured     Boolean  @default(false)
  usageCount     Int      @default(0)
  rating         Float    @default(0)
  sortOrder      Int      @default(0)
  createdBy      String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime

  @@index([businessType])
  @@index([category])
  @@index([isActive])
  @@index([isFeatured])
  @@map("prompt_library")
}

model RecentlyViewed {
  id        String   @id
  sessionId String
  productId String
  companyId String
  viewedAt  DateTime @default(now())
  companies Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  products  Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([sessionId, productId, companyId])
  @@index([companyId])
  @@index([productId])
  @@index([sessionId, companyId])
  @@index([viewedAt])
  @@map("recently_viewed")
}

model ResponseEffectiveness {
  id                 String   @id
  companyId          String
  messageId          String?
  conversationId     String
  responseText       String   @db.Text
  responseType       String
  customerReaction   String?
  effectivenessScore Float
  leadToPurchase     Boolean  @default(false)
  responseTime       Int?
  wordCount          Int?
  sentimentScore     Float?
  keywords           String?  @db.Text
  metadata           String?  @db.Text
  createdAt          DateTime @default(now())
  companies          Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([conversationId])
  @@index([createdAt])
  @@index([effectivenessScore])
  @@index([leadToPurchase])
  @@index([responseType])
  @@map("response_effectiveness")
}

model SentMessageStat {
  id                    String    @id
  companyId             String
  facebookPageId        String?
  recipientFacebookId   String
  recipientCustomerId   String?
  messageId             String    @unique
  messageContent        String?   @db.Text
  messageType           String?
  messageStatus         String
  ignoredReason         String?
  conversationId        String?
  conversationStatus    String?
  sentAt                DateTime  @default(now())
  savedAt               DateTime?
  conversationCreatedAt DateTime?
  createdAt             DateTime  @default(now())
  updatedAt             DateTime
  companies             Company   @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([companyId, sentAt])
  @@index([conversationStatus])
  @@index([messageStatus])
  @@index([recipientFacebookId])
  @@index([sentAt])
  @@map("sent_message_stats")
}

model SkippedFacebookPage {
  id                   String    @id
  pageId               String
  pageName             String
  reason               String
  attemptedCompanyId   String
  connectedToCompanyId String?
  isResolved           Boolean   @default(false)
  resolvedAt           DateTime?
  createdAt            DateTime  @default(now())
  updatedAt            DateTime

  @@index([attemptedCompanyId])
  @@index([createdAt])
  @@index([isResolved])
  @@map("skipped_facebook_pages")
}

model DevSystemSettings {
  id        String   @id
  key       String   @unique @default("default")
  value     String   @db.LongText
  group     String   @default("general")
  createdAt DateTime @default(now())
  updatedAt DateTime

  @@map("dev_system_settings")
}

model StorePage {
  id              String             @id
  companyId       String
  title           String
  slug            String
  content         String             @db.Text
  pageType        StorePagesPageType @default(CUSTOM)
  isActive        Boolean            @default(true)
  showInFooter    Boolean            @default(true)
  showInMenu      Boolean            @default(false)
  order           Int                @default(0)
  metaTitle       String?
  metaDescription String?            @db.Text
  createdAt       DateTime           @default(now())
  updatedAt       DateTime
  companies       Company            @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@unique([companyId, slug])
  @@index([companyId])
  @@index([isActive])
  @@index([slug])
  @@map("store_pages")
}

model StorePromotionSettings {
  id                    String   @id
  companyId             String   @unique
  freeShippingEnabled   Boolean  @default(false)
  freeShippingThreshold Decimal  @default(0.00) @db.Decimal(10, 2)
  freeShippingMessage   String?  @db.Text
  createdAt             DateTime @default(now())
  updatedAt             DateTime
  companies             Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@map("store_promotion_settings")
}

model StorefrontSettings {
  id                               String                @id
  companyId                        String                @unique
  quickViewEnabled                 Boolean               @default(true)
  quickViewShowAddToCart           Boolean               @default(true)
  quickViewShowWishlist            Boolean               @default(true)
  comparisonEnabled                Boolean               @default(true)
  maxComparisonProducts            Int                   @default(4)
  comparisonShowPrice              Boolean               @default(true)
  comparisonShowSpecs              Boolean               @default(true)
  wishlistEnabled                  Boolean               @default(true)
  wishlistRequireLogin             Boolean               @default(false)
  wishlistMaxItems                 Int                   @default(100)
  advancedFiltersEnabled           Boolean               @default(true)
  filterByPrice                    Boolean               @default(true)
  filterByRating                   Boolean               @default(true)
  filterByBrand                    Boolean               @default(false)
  filterByAttributes               Boolean               @default(true)
  reviewsEnabled                   Boolean               @default(true)
  reviewsRequirePurchase           Boolean               @default(false)
  reviewsModerationEnabled         Boolean               @default(true)
  reviewsShowRating                Boolean               @default(true)
  minRatingToDisplay               Int                   @default(1)
  countdownEnabled                 Boolean               @default(true)
  countdownShowOnProduct           Boolean               @default(true)
  countdownShowOnListing           Boolean               @default(false)
  backInStockEnabled               Boolean               @default(true)
  backInStockNotifyEmail           Boolean               @default(true)
  backInStockNotifySMS             Boolean               @default(false)
  recentlyViewedEnabled            Boolean               @default(true)
  recentlyViewedCount              Int                   @default(8)
  recentlyViewedDays               Int                   @default(30)
  imageZoomEnabled                 Boolean               @default(true)
  imageZoomType                    String                @default("hover")
  productVideosEnabled             Boolean               @default(true)
  videoAutoplay                    Boolean               @default(false)
  videoShowControls                Boolean               @default(true)
  sizeGuideEnabled                 Boolean               @default(true)
  sizeGuideShowOnProduct           Boolean               @default(true)
  socialSharingEnabled             Boolean               @default(true)
  shareFacebook                    Boolean               @default(true)
  shareTwitter                     Boolean               @default(true)
  shareWhatsApp                    Boolean               @default(true)
  shareTelegram                    Boolean               @default(true)
  badgesEnabled                    Boolean               @default(true)
  badgeNew                         Boolean               @default(true)
  badgeBestSeller                  Boolean               @default(true)
  badgeOnSale                      Boolean               @default(true)
  badgeOutOfStock                  Boolean               @default(true)
  tabsEnabled                      Boolean               @default(true)
  tabDescription                   Boolean               @default(true)
  tabSpecifications                Boolean               @default(true)
  tabReviews                       Boolean               @default(true)
  tabShipping                      Boolean               @default(true)
  stickyAddToCartEnabled           Boolean               @default(true)
  stickyShowOnMobile               Boolean               @default(true)
  stickyShowOnDesktop              Boolean               @default(true)
  seoEnabled                       Boolean               @default(true)
  seoMetaDescription               Boolean               @default(true)
  seoStructuredData                Boolean               @default(true)
  seoSitemap                       Boolean               @default(true)
  seoOpenGraph                     Boolean               @default(true)
  multiLanguageEnabled             Boolean               @default(false)
  defaultLanguage                  String                @default("ar")
  supportedLanguages               String                @db.LongText
  createdAt                        DateTime              @default(now())
  updatedAt                        DateTime
  capiStatus                       String?               @default("not_configured")
  capiTrackAddToCart               Boolean               @default(true)
  capiTrackInitiateCheckout        Boolean               @default(true)
  capiTrackPageView                Boolean               @default(true)
  capiTrackPurchase                Boolean               @default(true)
  capiTrackSearch                  Boolean               @default(true)
  capiTrackViewContent             Boolean               @default(true)
  eventDeduplicationEnabled        Boolean               @default(true)
  eventMatchQualityTarget          Int                   @default(8)
  facebookConvApiEnabled           Boolean               @default(false)
  facebookConvApiTestCode          String?
  facebookConvApiToken             String?               @db.Text
  facebookPixelEnabled             Boolean               @default(false)
  facebookPixelId                  String?
  gdprCompliant                    Boolean               @default(true)
  hashUserData                     Boolean               @default(true)
  lastCapiTest                     DateTime?
  lastPixelTest                    DateTime?
  pixelStatus                      String?               @default("not_configured")
  pixelTrackAddToCart              Boolean               @default(true)
  pixelTrackAddToWishlist          Boolean               @default(false)
  pixelTrackInitiateCheckout       Boolean               @default(true)
  pixelTrackPageView               Boolean               @default(true)
  pixelTrackPurchase               Boolean               @default(true)
  pixelTrackSearch                 Boolean               @default(true)
  pixelTrackViewContent            Boolean               @default(true)
  stickyAutoScrollToCheckout       Boolean               @default(false)
  stickyScrollThreshold            Int                   @default(300)
  stickyShowBuyNow                 Boolean               @default(true)
  stickyTrackAnalytics             Boolean               @default(true)
  stickyShowAddToCartButton        Boolean               @default(true)
  stickyShowProductImage           Boolean               @default(true)
  stickyShowProductName            Boolean               @default(true)
  stickyShowQuantity               Boolean               @default(true)
  badgeBuyerProtection             Boolean               @default(true)
  badgeCashOnDelivery              Boolean               @default(true)
  badgeCustom1                     Boolean               @default(false)
  badgeCustom1Text                 String?
  badgeCustom2                     Boolean               @default(false)
  badgeCustom2Text                 String?
  badgeFreeShipping                Boolean               @default(true)
  badgeHighRating                  Boolean               @default(true)
  badgeLayout                      String                @default("horizontal")
  badgeQualityGuarantee            Boolean               @default(true)
  badgeSecurePayment               Boolean               @default(true)
  keyboardShortcuts                Boolean               @default(true)
  navigationEnabled                Boolean               @default(false)
  navigationType                   String                @default("sameCategory")
  onlineVisitorsEnabled            Boolean               @default(false)
  onlineVisitorsMax                Int                   @default(50)
  onlineVisitorsMin                Int                   @default(5)
  onlineVisitorsText               String                @default("{count}     ")
  onlineVisitorsType               String                @default("fake")
  onlineVisitorsUpdateInterval     Int                   @default(30)
  reasonsToPurchaseEnabled         Boolean               @default(false)
  reasonsToPurchaseList            String?               @db.Text
  reasonsToPurchaseMaxItems        Int                   @default(4)
  reasonsToPurchaseStyle           String                @default("list")
  reasonsToPurchaseType            String                @default("global")
  securityBadgesEnabled            Boolean               @default(false)
  showNavigationButtons            Boolean               @default(true)
  soldNumberEnabled                Boolean               @default(false)
  soldNumberMax                    Int                   @default(500)
  soldNumberMin                    Int                   @default(10)
  soldNumberText                   String                @default("  {count} ")
  soldNumberType                   String                @default("real")
  stockProgressEnabled             Boolean               @default(false)
  stockProgressHighColor           String                @default("#10b981")
  stockProgressLowColor            String                @default("#ef4444")
  stockProgressMediumColor         String                @default("#f59e0b")
  stockProgressThreshold           Int                   @default(10)
  stockProgressType                String                @default("percentage")
  variantColorShowName             Boolean               @default(true)
  variantColorSize                 String                @default("medium")
  variantColorStyle                String                @default("buttons")
  variantSizeShowGuide             Boolean               @default(false)
  variantSizeShowStock             Boolean               @default(true)
  variantSizeStyle                 String                @default("buttons")
  estimatedDeliveryDefaultText     String                @default("  {time}")
  estimatedDeliveryEnabled         Boolean               @default(false)
  estimatedDeliveryShowOnProduct   Boolean               @default(true)
  fomoDelay                        Int                   @default(30)
  fomoEnabled                      Boolean               @default(false)
  fomoMessage                      String?               @db.Text
  fomoShowOncePerSession           Boolean               @default(true)
  fomoTrigger                      String                @default("time")
  fomoType                         String                @default("soldCount")
  productPageLayoutEnabled         Boolean               @default(false)
  productPageOrder                 String?               @db.Text
  productPageShowActions           Boolean               @default(true)
  productPageShowBackInStock       Boolean               @default(true)
  productPageShowBadges            Boolean               @default(true)
  productPageShowCategory          Boolean               @default(true)
  productPageShowCheckoutForm      Boolean               @default(true)
  productPageShowCountdown         Boolean               @default(true)
  productPageShowDescription       Boolean               @default(true)
  productPageShowEstimatedDelivery Boolean               @default(true)
  productPageShowFreeShipping      Boolean               @default(true)
  productPageShowOnlineVisitors    Boolean               @default(true)
  productPageShowPreOrder          Boolean               @default(true)
  productPageShowPrice             Boolean               @default(true)
  productPageShowQuantity          Boolean               @default(true)
  productPageShowReasonsToPurchase Boolean               @default(true)
  productPageShowSKU               Boolean               @default(true)
  productPageShowSecurityBadges    Boolean               @default(true)
  productPageShowSizeGuide         Boolean               @default(true)
  productPageShowSocialSharing     Boolean               @default(true)
  productPageShowSoldNumber        Boolean               @default(true)
  productPageShowStockProgress     Boolean               @default(true)
  productPageShowStockStatus       Boolean               @default(true)
  productPageShowTabs              Boolean               @default(true)
  productPageShowTitle             Boolean               @default(true)
  productPageShowVariants          Boolean               @default(true)
  productPageShowVolumeDiscounts   Boolean               @default(true)
  galleryLayout                    String                @default("bottom")
  galleryStyle                     String                @default("slider")
  imageBorderRadius                Int                   @default(8)
  imageHoverEffect                 String                @default("zoom")
  imageLoadingEffect               String                @default("skeleton")
  imagePlaceholder                 String                @default("?")
  imageShadow                      Boolean               @default(true)
  lightboxBackgroundColor          String                @default("rgba(0,0,0,0.9)")
  lightboxCloseOnOverlay           Boolean               @default(true)
  lightboxEnabled                  Boolean               @default(true)
  lightboxKeyboardNav              Boolean               @default(true)
  lightboxShowArrows               Boolean               @default(true)
  lightboxShowCounter              Boolean               @default(true)
  lightboxShowThumbnails           Boolean               @default(true)
  lightboxZoomEnabled              Boolean               @default(true)
  mainImageAspectRatio             String                @default("1:1")
  mobileFullscreenOnTap            Boolean               @default(true)
  mobileGalleryLayout              String                @default("slider")
  mobilePinchZoom                  Boolean               @default(true)
  mobileShowThumbnails             Boolean               @default(false)
  mobileSwipeEnabled               Boolean               @default(true)
  mouseWheelZoom                   Boolean               @default(false)
  sliderAutoplay                   Boolean               @default(false)
  sliderAutoplaySpeed              Int                   @default(3000)
  sliderEnabled                    Boolean               @default(true)
  sliderInfiniteLoop               Boolean               @default(true)
  sliderShowArrows                 Boolean               @default(true)
  sliderShowDots                   Boolean               @default(false)
  sliderTransitionEffect           String                @default("slide")
  sliderTransitionSpeed            Int                   @default(300)
  thumbnailBorderRadius            Int                   @default(8)
  thumbnailSize                    String                @default("medium")
  thumbnailSpacing                 Int                   @default(8)
  thumbnailsPerRow                 Int                   @default(4)
  variationImagesAnimation         String                @default("fade")
  variationImagesBehavior          String                @default("replace")
  variationImagesEnabled           Boolean               @default(true)
  videoMuted                       Boolean               @default(true)
  videoPlayMode                    String                @default("inline")
  videoPosition                    String                @default("end")
  videoSources                     String                @default("[\"youtube\", \"vimeo\", \"self-hosted\"]")
  videoThumbnailIcon               Boolean               @default(true)
  view360AutoRotate                Boolean               @default(true)
  view360Enabled                   Boolean               @default(false)
  view360RotateSpeed               Int                   @default(5)
  view360ShowControls              Boolean               @default(true)
  zoomLensShape                    String                @default("square")
  zoomLensSize                     Int                   @default(150)
  zoomLevel                        Float                 @default(2.5)
  zoomStyle                        String                @default("side")
  zoomWindowPosition               String                @default("right")
  zoomWindowSize                   Int                   @default(400)
  mobileBottomNavbarEnabled        Boolean               @default(true)
  mobileBottomNavbarShowAccount    Boolean               @default(true)
  mobileBottomNavbarShowCart       Boolean               @default(false)
  mobileBottomNavbarShowCompare    Boolean               @default(true)
  mobileBottomNavbarShowHome       Boolean               @default(true)
  mobileBottomNavbarShowSearch     Boolean               @default(false)
  mobileBottomNavbarShowShop       Boolean               @default(true)
  mobileBottomNavbarShowWishlist   Boolean               @default(true)
  facebookPixelConfigs             FacebookPixelConfig[]
  companies                        Company               @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([facebookConvApiEnabled])
  @@index([facebookPixelEnabled])
  @@map("storefront_settings")
}

model Subscription {
  id              String                @id
  companyId       String
  planType        SubscriptionsPlanType
  status          SubscriptionsStatus   @default(ACTIVE)
  startDate       DateTime              @default(now())
  endDate         DateTime?
  nextBillingDate DateTime?
  billingCycle    String                @default("monthly")
  price           Float
  currency        String                @default("EGP")
  autoRenew       Boolean               @default(true)
  trialEndDate    DateTime?
  cancelledAt     DateTime?
  cancelReason    String?
  metadata        String?               @db.LongText
  createdAt       DateTime              @default(now())
  updatedAt       DateTime
  invoices        Invoice[]
  payments        Payment[]
  companies       Company               @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@map("subscriptions")
}

model SystemPrompt {
  id        String   @id
  name      String
  content   String   @db.Text
  category  String   @default("general")
  isActive  Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime
  companyId String?
  companies Company? @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@map("system_prompts")
}

model SystemSettings {
  id               String    @id
  systemName       String    @unique
  displayName      String
  description      String?
  category         String    @default("general")
  isEnabled        Boolean   @default(true)
  config           String?   @db.LongText
  resourceUsage    String?   @db.LongText
  lastStatusChange DateTime?
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @default(now())

  @@map("system_settings")
}

model TaskActivity {
  id          String   @id
  taskId      String
  userId      String
  action      String
  field       String?
  oldValue    String?  @db.Text
  newValue    String?  @db.Text
  description String?  @db.Text
  companyId   String
  createdAt   DateTime @default(now())
  companies   Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  tasks       Task     @relation(fields: [taskId], references: [id], onDelete: Cascade)
  users       User     @relation(fields: [userId], references: [id])

  @@index([companyId])
  @@index([createdAt])
  @@index([taskId])
  @@index([userId])
  @@map("task_activities")
}

model TaskAttachment {
  id            String   @id
  taskId        String
  userId        String
  fileName      String
  originalName  String
  fileSize      Int
  fileType      String
  filePath      String
  downloadCount Int      @default(0)
  companyId     String
  createdAt     DateTime @default(now())
  companies     Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  tasks         Task     @relation(fields: [taskId], references: [id], onDelete: Cascade)
  users         User     @relation(fields: [userId], references: [id])

  @@index([companyId])
  @@index([taskId])
  @@index([userId])
  @@map("task_attachments")
}

model TaskChecklistItem {
  id            String        @id
  checklistId   String
  content       String
  isCompleted   Boolean       @default(false)
  completedAt   DateTime?
  completedBy   String?
  position      Int           @default(0)
  createdAt     DateTime      @default(now())
  updatedAt     DateTime
  taskChecklist TaskChecklist @relation(fields: [checklistId], references: [id], onDelete: Cascade)
  users         User?         @relation(fields: [completedBy], references: [id])

  @@index([checklistId])
  @@index([completedBy])
  @@map("task_checklist_items")
}

model TaskChecklist {
  id                 String              @id
  taskId             String
  title              String
  position           Int                 @default(0)
  companyId          String
  createdAt          DateTime            @default(now())
  updatedAt          DateTime
  taskChecklistItems TaskChecklistItem[]
  companies          Company             @relation(fields: [companyId], references: [id], onDelete: Cascade)
  tasks              Task                @relation(fields: [taskId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([taskId])
  @@map("task_checklists")
}

model TaskComment {
  id                  String        @id
  taskId              String
  userId              String
  content             String        @db.Text
  parentCommentId     String?
  mentions            String?       @db.LongText
  isEdited            Boolean       @default(false)
  editedAt            DateTime?
  companyId           String
  createdAt           DateTime      @default(now())
  updatedAt           DateTime
  companies           Company       @relation(fields: [companyId], references: [id], onDelete: Cascade)
  taskComment         TaskComment?  @relation("task_commentsTotask_comments", fields: [parentCommentId], references: [id])
  other_task_comments TaskComment[] @relation("task_commentsTotask_comments")
  tasks               Task          @relation(fields: [taskId], references: [id], onDelete: Cascade)
  users               User          @relation(fields: [userId], references: [id])

  @@index([companyId])
  @@index([parentCommentId])
  @@index([taskId])
  @@index([userId])
  @@map("task_comments")
}

model TaskDependency {
  id                                         String   @id
  taskId                                     String
  dependsOnId                                String
  type                                       String   @default("blocked_by")
  companyId                                  String
  createdAt                                  DateTime @default(now())
  companies                                  Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  tasks_task_dependencies_dependsOnIdTotasks Task     @relation("task_dependencies_dependsOnIdTotasks", fields: [dependsOnId], references: [id], onDelete: Cascade)
  tasks_task_dependencies_taskIdTotasks      Task     @relation("task_dependencies_taskIdTotasks", fields: [taskId], references: [id], onDelete: Cascade)

  @@unique([taskId, dependsOnId])
  @@index([companyId])
  @@index([dependsOnId])
  @@index([taskId])
  @@map("task_dependencies")
}

model TaskNotification {
  id        String    @id
  userId    String
  taskId    String?
  projectId String?
  type      String
  title     String
  message   String    @db.Text
  isRead    Boolean   @default(false)
  readAt    DateTime?
  link      String?
  companyId String
  createdAt DateTime  @default(now())
  companies Company   @relation(fields: [companyId], references: [id], onDelete: Cascade)
  users     User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([createdAt])
  @@index([isRead])
  @@index([userId])
  @@map("task_notifications")
}

model TaskTemplate {
  id              String                       @id
  name            String
  description     String?                      @db.Text
  defaultStatus   TaskTemplatesDefaultStatus   @default(PENDING)
  defaultPriority TaskTemplatesDefaultPriority @default(MEDIUM)
  type            String                       @default("general")
  estimatedHours  Int                          @default(0)
  tags            String?                      @db.LongText
  checklist       String?                      @db.LongText
  isPublic        Boolean                      @default(false)
  createdBy       String
  companyId       String
  createdAt       DateTime                     @default(now())
  updatedAt       DateTime
  companies       Company                      @relation(fields: [companyId], references: [id], onDelete: Cascade)
  users           User                         @relation(fields: [createdBy], references: [id])

  @@index([companyId])
  @@index([createdBy])
  @@map("task_templates")
}

model TaskWatcher {
  id        String   @id
  taskId    String
  userId    String
  companyId String
  createdAt DateTime @default(now())
  companies Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  tasks     Task     @relation(fields: [taskId], references: [id], onDelete: Cascade)
  users     User     @relation(fields: [userId], references: [id])

  @@unique([taskId, userId])
  @@index([companyId])
  @@index([taskId])
  @@index([userId])
  @@map("task_watchers")
}

model Task {
  id                                                     String           @id
  projectId                                              String?
  title                                                  String
  description                                            String           @db.Text
  status                                                 TasksStatus      @default(PENDING)
  priority                                               TasksPriority    @default(MEDIUM)
  type                                                   String           @default("general")
  assignedTo                                             String
  createdBy                                              String
  dueDate                                                DateTime?
  estimatedHours                                         Int              @default(0)
  actualHours                                            Int              @default(0)
  progress                                               Int              @default(0)
  tags                                                   String?          @db.LongText
  dependencies                                           String?          @db.LongText
  companyId                                              String
  createdAt                                              DateTime         @default(now())
  updatedAt                                              DateTime
  categoryId                                             String?
  color                                                  String?
  completedDate                                          DateTime?
  isRecurring                                            Boolean          @default(false)
  order                                                  Int              @default(0)
  parentTaskId                                           String?
  recurringRule                                          String?          @db.LongText
  startDate                                              DateTime?
  taskActivities                                         TaskActivity[]
  taskAttachments                                        TaskAttachment[]
  taskChecklists                                         TaskChecklist[]
  taskComments                                           TaskComment[]
  task_dependencies_task_dependencies_dependsOnIdTotasks TaskDependency[] @relation("task_dependencies_dependsOnIdTotasks")
  task_dependencies_task_dependencies_taskIdTotasks      TaskDependency[] @relation("task_dependencies_taskIdTotasks")
  taskWatchers                                           TaskWatcher[]
  users_tasks_assignedToTousers                          User             @relation("tasks_assignedToTousers", fields: [assignedTo], references: [id])
  taskCategory                                           TaskCategory?    @relation(fields: [categoryId], references: [id])
  companies                                              Company          @relation(fields: [companyId], references: [id], onDelete: Cascade)
  users_tasks_createdByTousers                           User             @relation("tasks_createdByTousers", fields: [createdBy], references: [id])
  tasks                                                  Task?            @relation("tasksTotasks", fields: [parentTaskId], references: [id])
  other_tasks                                            Task[]           @relation("tasksTotasks")
  projects                                               Project?         @relation(fields: [projectId], references: [id])
  time_entries                                           TimeEntry[]

  @@index([assignedTo])
  @@index([categoryId])
  @@index([companyId])
  @@index([createdBy])
  @@index([dueDate])
  @@index([order])
  @@index([parentTaskId])
  @@index([priority])
  @@index([projectId])
  @@index([status])
}

model TelegramConfig {
  id            String   @id
  companyId     String
  botToken      String?  @db.Text
  botName       String?
  botUsername   String?
  apiId         String?  @db.Text
  apiHash       String?  @db.Text
  isActive      Boolean  @default(false)
  clientSession String?  @db.Text
  clientPhone   String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime
  label         String   @default("Official Bot")
  sessionString String?  @db.Text
  type          String   @default("BOT")
  companies     Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@unique([companyId, type])
  @@index([companyId])
  @@index([type])
  @@map("telegram_configs")
}

model TextGallery {
  id        String   @id
  userId    String
  companyId String
  title     String?
  content   String   @db.Text
  imageUrls String?  @db.LongText
  createdAt DateTime @default(now())
  updatedAt DateTime
  isPinned  Boolean  @default(false)
  companies Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  users     User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([createdAt])
  @@index([userId])
  @@map("text_gallery")
}

model TimeEntry {
  id          String    @id
  taskId      String
  userId      String
  startTime   DateTime
  endTime     DateTime?
  duration    Int       @default(0)
  description String?   @db.Text
  isBillable  Boolean   @default(false)
  hourlyRate  Decimal?  @db.Decimal(10, 2)
  isRunning   Boolean   @default(false)
  companyId   String
  createdAt   DateTime  @default(now())
  updatedAt   DateTime
  companies   Company   @relation(fields: [companyId], references: [id], onDelete: Cascade)
  tasks       Task      @relation(fields: [taskId], references: [id], onDelete: Cascade)
  users       User      @relation(fields: [userId], references: [id])

  @@index([companyId])
  @@index([startTime])
  @@index([taskId])
  @@index([userId])
}

model WalletNumber {
  id              String           @id
  name            String
  number          String
  isActive        Boolean          @default(true)
  icon            String
  color           String
  createdAt       DateTime         @default(now())
  updatedAt       DateTime
  paymentReceipts PaymentReceipt[]

  @@map("wallet_numbers")
}

model WhatsAppContact {
  id              String          @id
  sessionId       String
  jid             String
  phoneNumber     String
  name            String?
  pushName        String?
  profilePicUrl   String?         @db.Text
  isGroup         Boolean         @default(false)
  isBlocked       Boolean         @default(false)
  customerId      String?
  category        String?         @default("LEAD")
  tags            String?         @db.Text
  notes           String?         @db.Text
  lastMessageAt   DateTime?
  unreadCount     Int             @default(0)
  totalMessages   Int             @default(0)
  isArchived      Boolean         @default(false)
  isPinned        Boolean         @default(false)
  isMuted         Boolean         @default(false)
  createdAt       DateTime        @default(now())
  updatedAt       DateTime
  customers       Customer?       @relation(fields: [customerId], references: [id])
  whatsAppSession WhatsAppSession @relation(fields: [sessionId], references: [id], onDelete: Cascade)

  @@unique([sessionId, jid])
  @@index([category])
  @@index([customerId])
  @@index([lastMessageAt])
  @@index([phoneNumber])
  @@index([sessionId])
  @@map("whatsapp_contacts")
}

model WhatsAppEventLog {
  id        String   @id
  sessionId String
  companyId String
  eventType String
  eventData String?  @db.Text
  level     String   @default("info")
  createdAt DateTime @default(now())

  @@index([companyId])
  @@index([createdAt])
  @@index([eventType])
  @@index([sessionId])
  @@map("whatsapp_event_logs")
}

model WhatsAppMessage {
  id              String                      @id
  sessionId       String
  remoteJid       String
  messageId       String                      @unique
  fromMe          Boolean
  messageType     WhatsAppMessagesMessageType @default(TEXT)
  content         String?                     @db.Text
  mediaUrl        String?                     @db.Text
  mediaType       String?
  mediaMimeType   String?
  mediaSize       Int?
  mediaFileName   String?
  quotedMessageId String?
  quotedContent   String?                     @db.Text
  status          WhatsAppMessagesStatus      @default(SENT)
  timestamp       DateTime
  isAIResponse    Boolean                     @default(false)
  aiConfidence    Float?
  interactiveData String?                     @db.Text
  metadata        String?                     @db.Text
  createdAt       DateTime                    @default(now())
  updatedAt       DateTime
  senderId        String?
  participant     String?
  users           User?                       @relation(fields: [senderId], references: [id])
  whatsAppSession WhatsAppSession             @relation(fields: [sessionId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([remoteJid])
  @@index([senderId])
  @@index([sessionId])
  @@index([sessionId, remoteJid])
  @@index([sessionId, timestamp])
  @@index([timestamp])
  @@map("whatsapp_messages")
}

model WhatsAppQuickReply {
  id         String    @id
  companyId  String
  title      String
  shortcut   String?
  content    String    @db.Text
  category   String    @default("general")
  variables  String?   @db.Text
  mediaUrl   String?   @db.Text
  mediaType  String?
  usageCount Int       @default(0)
  lastUsedAt DateTime?
  isActive   Boolean   @default(true)
  sortOrder  Int       @default(0)
  createdAt  DateTime  @default(now())
  updatedAt  DateTime
  companies  Company   @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@unique([companyId, shortcut])
  @@index([category])
  @@index([companyId])
  @@index([isActive])
  @@map("whatsapp_quick_replies")
}

model WhatsAppSession {
  id                  String                 @id
  companyId           String
  name                String
  phoneNumber         String?
  status              WhatsAppSessionsStatus @default(DISCONNECTED)
  lastConnectedAt     DateTime?
  lastDisconnectedAt  DateTime?
  authState           String?                @db.LongText
  isDefault           Boolean                @default(false)
  aiEnabled           Boolean                @default(true)
  autoReply           Boolean                @default(false)
  aiMode              String                 @default("suggest")
  welcomeMessage      String?                @db.Text
  awayMessage         String?                @db.Text
  workingHoursEnabled Boolean                @default(false)
  workingHours        String?                @db.Text
  metadata            String?                @db.Text
  createdAt           DateTime               @default(now())
  updatedAt           DateTime
  profileName         String?
  profilePictureUrl   String?                @db.Text
  profileStatus       String?
  whatsAppContacts    WhatsAppContact[]
  whatsAppMessages    WhatsAppMessage[]
  companies           Company                @relation(fields: [companyId], references: [id], onDelete: Cascade)
  whatsAppStatuses    WhatsAppStatuse[]

  @@index([companyId])
  @@index([phoneNumber])
  @@index([status])
  @@map("whatsapp_sessions")
}

model WhatsAppSettings {
  id                   String   @id
  companyId            String   @unique
  isEnabled            Boolean  @default(true)
  maxSessions          Int      @default(3)
  notificationSound    Boolean  @default(true)
  browserNotifications Boolean  @default(true)
  defaultAIMode        String   @default("suggest")
  aiWelcomeEnabled     Boolean  @default(false)
  aiAwayEnabled        Boolean  @default(false)
  maxImageSize         Int      @default(16)
  maxVideoSize         Int      @default(64)
  maxDocumentSize      Int      @default(100)
  autoCompressImages   Boolean  @default(true)
  autoArchiveDays      Int?
  metadata             String?  @db.Text
  createdAt            DateTime @default(now())
  updatedAt            DateTime
  companies            Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@map("whatsapp_settings")
}

model WhatsAppStatuse {
  id              String             @id
  sessionId       String
  remoteJid       String
  messageId       String             @unique
  type            WhatsAppStatusType @default(TEXT)
  content         String?            @db.Text
  mediaUrl        String?            @db.Text
  mediaType       String?
  mediaMimeType   String?
  timestamp       DateTime
  expiresAt       DateTime
  isViewed        Boolean            @default(false)
  viewedAt        DateTime?
  metadata        String?            @db.Text
  createdAt       DateTime           @default(now())
  updatedAt       DateTime
  whatsAppSession WhatsAppSession    @relation(fields: [sessionId], references: [id], onDelete: Cascade)

  @@index([expiresAt])
  @@index([remoteJid])
  @@index([sessionId])
  @@index([timestamp])
  @@map("whatsapp_statuses")
}

model Faq {
  id                   String    @id
  companyId            String
  question             String    @db.Text
  answer               String    @db.Text
  category             String    @default("general")
  tags                 String?   @db.Text
  order                Int       @default(0)
  helpful              Int       @default(0)
  notHelpful           Int       @default(0)
  isActive             Boolean   @default(true)
  version              Int       @default(1)
  createdAt            DateTime  @default(now())
  updatedAt            DateTime
  embedding            String?   @db.Text
  embeddingGeneratedAt DateTime?
  companies            Company   @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([category])
  @@index([companyId])
  @@index([companyId, isActive])
  @@index([isActive])
  @@map("faqs")
}

model RagPerformance {
  id            String   @id
  companyId     String
  operation     String
  responseTime  Int
  tokensUsed    Int?
  cacheHit      Boolean  @default(false)
  errorOccurred Boolean  @default(false)
  errorMessage  String?  @db.Text
  metadata      String?  @db.Text
  createdAt     DateTime @default(now())

  @@index([companyId, createdAt])
  @@index([companyId])
  @@index([errorOccurred])
  @@index([operation])
  @@map("rag_performance")
}

model RagRateLimit {
  id           String   @id
  companyId    String
  ipAddress    String?
  requestType  String   @default("search")
  requestCount Int      @default(1)
  windowStart  DateTime @default(now())
  createdAt    DateTime @default(now())
  updatedAt    DateTime

  @@unique([companyId, ipAddress, windowStart])
  @@index([companyId])
  @@index([ipAddress])
  @@index([windowStart])
  @@map("rag_rate_limits")
}

model ReturnReason {
  id                   String                @id
  reason               String
  description          String?
  companyId            String
  isActive             Boolean               @default(true)
  createdAt            DateTime              @default(now())
  updatedAt            DateTime
  categoryId           String?
  returnReasonCategory ReturnReasonCategory? @relation(fields: [categoryId], references: [id])
  companies            Company               @relation(fields: [companyId], references: [id], onDelete: Cascade)
  returnRequests       ReturnRequest[]

  @@index([categoryId])
  @@index([companyId])
  @@map("return_reasons")
}

model ReturnRequest {
  id                    String                         @id
  orderId               String
  customerId            String
  companyId             String
  reasonId              String
  status                ReturnRequestsStatus           @default(PENDING)
  adminNotes            String?                        @db.Text
  customerNotes         String?                        @db.Text
  refundAmount          Decimal?                       @db.Decimal(10, 2)
  assignedTo            String?
  createdAt             DateTime                       @default(now())
  updatedAt             DateTime
  isReviewed            Boolean                        @default(false)
  orderItemId           String?
  rejectionReason       String?                        @db.Text
  responsibleParty      ReturnRequestsResponsibleParty @default(OTHER)
  reviewedAt            DateTime?
  reviewedBy            String?
  returnActivityLogs    ReturnActivityLog[]
  returnContactAttempts ReturnContactAttempt[]
  users                 User?                          @relation(fields: [assignedTo], references: [id])
  companies             Company                        @relation(fields: [companyId], references: [id], onDelete: Cascade)
  customers             Customer                       @relation(fields: [customerId], references: [id], onDelete: Cascade)
  orders                Order                          @relation(fields: [orderId], references: [id], onDelete: Cascade)
  returnReason          ReturnReason                   @relation(fields: [reasonId], references: [id])

  @@index([assignedTo])
  @@index([companyId])
  @@index([customerId])
  @@index([orderId])
  @@index([reasonId])
  @@index([status])
  @@map("return_requests")
}

model ReturnSettings {
  id                 String   @id
  companyId          String   @unique
  excellentThreshold Int      @default(90)
  goodThreshold      Int      @default(70)
  minOrdersForRating Int      @default(3)
  autoApproveScore   Int      @default(95)
  enableAutoApproval Boolean  @default(false)
  createdAt          DateTime @default(now())
  updatedAt          DateTime
  companies          Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@map("return_settings")
}

model ReturnContactAttempt {
  id              String        @id
  returnRequestId String
  userId          String
  method          String
  result          String
  notes           String?       @db.Text
  createdAt       DateTime      @default(now())
  returnRequest   ReturnRequest @relation(fields: [returnRequestId], references: [id], onDelete: Cascade)
  users           User          @relation(fields: [userId], references: [id])

  @@index([returnRequestId])
  @@index([userId])
  @@map("return_contact_attempts")
}

model ReturnActivityLog {
  id              String        @id
  returnRequestId String
  userId          String?
  action          String
  details         String?       @db.Text
  createdAt       DateTime      @default(now())
  returnRequest   ReturnRequest @relation(fields: [returnRequestId], references: [id], onDelete: Cascade)
  users           User?         @relation(fields: [userId], references: [id])

  @@index([returnRequestId])
  @@index([userId])
  @@map("return_activity_logs")
}

model ImageStudioSettings {
  id                  String   @id
  enabled             Boolean  @default(true)
  basicModelName      String   @default("gemini-2.5-flash-image")
  proModelName        String   @default("gemini-3-pro-image-preview")
  defaultModel        String   @default("basic")
  maxImagesPerRequest Int      @default(1)
  maxRequestsPerDay   Int      @default(50)
  allowedCompanies    String?  @db.Text
  createdAt           DateTime @default(now())
  updatedAt           DateTime
  selectedKeyId       String?

  @@map("image_studio_settings")
}

model ImageStudioUsage {
  id               String   @id
  companyId        String
  date             DateTime @db.Date
  basicImagesCount Int      @default(0)
  proImagesCount   Int      @default(0)
  totalImagesCount Int      @default(0)
  createdAt        DateTime @default(now())
  updatedAt        DateTime
  companies        Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@unique([companyId, date])
  @@index([companyId])
  @@index([date])
  @@map("image_studio_usage")
}

model ImageStudioHistory {
  id           String   @id
  companyId    String
  userId       String
  prompt       String   @db.Text
  modelType    String
  modelName    String
  imageUrl     String?
  status       String   @default("pending")
  errorMessage String?  @db.Text
  metadata     String?  @db.Text
  createdAt    DateTime @default(now())
  updatedAt    DateTime
  companies    Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  users        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([createdAt])
  @@index([status])
  @@index([userId])
  @@map("image_studio_history")
}

model DevTeamMember {
  id                                               String            @id
  userId                                           String            @unique
  role                                             String            @default("developer")
  department                                       String?
  skills                                           String?           @db.LongText
  availability                                     String            @default("available")
  isActive                                         Boolean           @default(true)
  createdAt                                        DateTime          @default(now())
  updatedAt                                        DateTime
  level                                            Int               @default(1)
  xp                                               Int               @default(0)
  dailyTarget                                      Int?
  hourlyRate                                       Decimal?          @db.Decimal(10, 2)
  weeklyTarget                                     Int?
  ai_chat_sessions                                 AIChatSession[]
  dev_member_badges                                DevMemberBadge[]
  dev_notifications                                DevNotification[]
  dev_projects                                     DevProject[]
  devTaskActivities                                DevTaskActivity[]
  devTaskComments                                  DevTaskComment[]
  devTaskWatchers                                  DevTaskWatcher[]
  dev_tasks_dev_tasks_assigneeIdTodev_team_members DevTask[]         @relation("dev_tasks_assigneeIdTodev_team_members")
  dev_tasks_dev_tasks_reporterIdTodev_team_members DevTask[]         @relation("dev_tasks_reporterIdTodev_team_members")
  users                                            User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  devTimeLogs                                      DevTimeLog[]

  companyRel   Company? @relation(fields: [companyRelId], references: [id])
  companyRelId String?

  @@index([isActive])
  @@index([role])
  @@index([userId])
  @@map("dev_team_members")
}

model DevTimeLog {
  id               String        @id
  taskId           String
  memberId         String
  startTime        DateTime
  endTime          DateTime?
  duration         Int           @default(0)
  description      String?       @db.Text
  isBillable       Boolean       @default(false)
  isRunning        Boolean       @default(false)
  createdAt        DateTime      @default(now())
  updatedAt        DateTime
  activityType     String?
  isPaused         Boolean       @default(false)
  pauseDuration    Int           @default(0)
  pauseHistory     String?       @db.LongText
  pausedAt         DateTime?
  dev_team_members DevTeamMember @relation(fields: [memberId], references: [id])
  dev_tasks        DevTask       @relation(fields: [taskId], references: [id], onDelete: Cascade)

  @@index([isPaused])
  @@index([isRunning])
  @@index([memberId])
  @@index([taskId])
  @@map("dev_time_logs")
}

model WalletTransaction {
  id            String                @id @default(cuid())
  walletId      String
  type          WalletTransactionType
  amount        Float
  balanceBefore Float
  balanceAfter  Float
  orderId       String?
  description   String
  metadata      String?               @db.Text
  createdAt     DateTime              @default(now())

  wallet CustomerWallet @relation(fields: [walletId], references: [id], onDelete: Cascade)
  order  Order?         @relation(fields: [orderId], references: [id], onDelete: SetNull)

  @@index([walletId])
  @@index([type])
  @@index([createdAt])
  @@map("wallet_transactions")
}

model Appointment {
  id              String   @id @default(cuid())
  companyId       String
  customerId      String?
  customerName    String
  customerEmail   String?
  customerPhone   String?
  staffId         String
  staffName       String
  title           String
  description     String?  @db.Text
  appointmentDate DateTime @db.Date
  startTime       String // Format: "HH:mm"
  endTime         String? // Format: "HH:mm"
  duration        Int      @default(30) // in minutes
  status          String   @default("pending") // pending, confirmed, completed, cancelled, no_show
  type            String   @default("consultation") // consultation, training, meeting, demo
  location        String?
  meetingLink     String?  @db.Text
  notes           String?  @db.Text
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  company  Company   @relation(fields: [companyId], references: [id], onDelete: Cascade)
  customer Customer? @relation(fields: [customerId], references: [id], onDelete: SetNull)

  @@index([companyId])
  @@index([customerId])
  @@index([staffId])
  @@index([appointmentDate])
  @@index([status])
  @@map("appointments")
}

model CallAttemptLog {
  id        String   @id
  orderId   String
  userId    String
  result    String?
  notes     String?
  createdAt DateTime @default(now())
  orders    Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  users     User     @relation(fields: [userId], references: [id])

  @@index([orderId])
  @@index([userId])
  @@map("call_attempt_logs")
}

model EmployeeNotificationPreference {
  id                 String   @id
  companyId          String
  employeeId         String
  phone              String
  attendanceReminder Boolean  @default(true)
  leaveUpdates       Boolean  @default(true)
  payrollNotice      Boolean  @default(true)
  birthdayWish       Boolean  @default(true)
  announcements      Boolean  @default(true)
  isOptedIn          Boolean  @default(true)
  createdAt          DateTime @default(now())
  updatedAt          DateTime
  companies          Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@unique([companyId, employeeId])
  @@unique([companyId, phone])
  @@map("employee_notification_preferences")
}

model StoreVisit {
  id          String   @id @default(cuid())
  companyId   String
  sessionId   String
  ipAddress   String?
  userAgent   String?  @db.Text
  referrer    String?  @db.Text
  landingPage String?  @db.Text
  visitedAt   DateTime @default(now())
  duration    Int?
  pagesViewed Int      @default(1)
  company     Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId, visitedAt])
  @@index([sessionId, companyId])
  @@map("store_visits")
}

model DevMemberBadge {
  id        String        @id @default(cuid())
  memberId  String
  badgeCode String
  earnedAt  DateTime      @default(now())
  member    DevTeamMember @relation(fields: [memberId], references: [id], onDelete: Cascade)

  @@index([memberId])
  @@map("dev_member_badges")
}

model MarketplaceApp {
  id          String  @id @default(cuid())
  slug        String  @unique
  name        String
  description String  @db.Text
  logo        String?
  images      Json?

  monthlyPrice Decimal @db.Decimal(10, 2)
  yearlyPrice  Decimal @db.Decimal(10, 2)

  features Json?

  isActive   Boolean @default(true)
  isPublic   Boolean @default(true)
  isFeatured Boolean @default(false)

  installations CompanyApp[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  mainRoute  String?
  adminRoute String?

  category String @default("general")

  reviews      AppReview[]
  pricingRules AppPricingRule[]

  rating       Float   @default(0)
  reviewCount  Int     @default(0)
  installCount Int     @default(0)
  isPopular    Boolean @default(false)
  requiredApps Json?
  trialDays    Int     @default(14)
  icon         String?

  @@map("marketplace_apps")
}

model CompanyApp {
  id        String @id @default(cuid())
  companyId String
  appId     String

  status String @default("ACTIVE") // ACTIVE, TRIAL, CANCELLED, EXPIRED

  trialEndsAt DateTime?
  validUntil  DateTime?

  settings Json?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  company Company        @relation(fields: [companyId], references: [id], onDelete: Cascade)
  app     MarketplaceApp @relation(fields: [appId], references: [id], onDelete: Cascade)

  usageLogs AppUsageLog[]

  @@unique([companyId, appId])
  @@map("company_apps")
}

model AppUsageLog {
  id           String   @id @default(cuid())
  companyAppId String
  feature      String?
  quantity     Int      @default(1)
  totalCost    Decimal  @default(0) @db.Decimal(10, 2)
  metadata     Json?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  companyApp CompanyApp @relation(fields: [companyAppId], references: [id], onDelete: Cascade)

  @@index([companyAppId])
  @@index([createdAt])
  @@index([feature])
  @@map("app_usage_logs")
}

model AppReview {
  id          String   @id @default(cuid())
  appId       String
  companyId   String
  userId      String
  rating      Int
  title       String?
  comment     String?  @db.Text
  isVerified  Boolean  @default(false)
  isPublished Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  app     MarketplaceApp @relation(fields: [appId], references: [id], onDelete: Cascade)
  company Company        @relation(fields: [companyId], references: [id], onDelete: Cascade)
  user    User           @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([appId, companyId])
  @@index([appId])
  @@index([companyId])
  @@index([userId])
  @@map("app_reviews")
}

model AppPricingRule {
  id        String   @id @default(cuid())
  appId     String
  name      String
  condition Json
  action    Json
  priority  Int      @default(0)
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  app MarketplaceApp @relation(fields: [appId], references: [id], onDelete: Cascade)

  @@index([appId])
  @@map("app_pricing_rules")
}

model AppBundle {
  id          String  @id @default(cuid())
  slug        String  @unique
  name        String
  nameEn      String?
  description String  @db.Text

  appIds Json

  monthlyPrice Decimal  @db.Decimal(10, 2)
  yearlyPrice  Decimal? @db.Decimal(10, 2)

  discount Decimal @db.Decimal(5, 2)

  isActive   Boolean @default(true)
  isFeatured Boolean @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([slug])
  @@index([isActive])
  @@map("app_bundles")
}

model CompanyWallet {
  id        String  @id @default(cuid())
  companyId String  @unique
  balance   Decimal @default(0) @db.Decimal(10, 2)
  currency  String  @default("EGP")

  updatedAt DateTime @updatedAt

  company      Company       @relation(fields: [companyId], references: [id], onDelete: Cascade)
  transactions Transaction[]

  @@map("company_wallets")
}

model Transaction {
  id          String  @id @default(cuid())
  walletId    String
  amount      Decimal @db.Decimal(10, 2)
  type        String // DEPOSIT, WITHDRAWAL, PAYMENT, REFUND
  status      String  @default("COMPLETED")
  description String?
  referenceId String?

  createdAt DateTime @default(now())

  wallet CompanyWallet @relation(fields: [walletId], references: [id], onDelete: Cascade)

  @@index([walletId])
  @@map("transactions")
}

model Company {
  id                              String                           @id
  name                            String
  email                           String                           @unique
  phone                           String?
  website                         String?
  logo                            String?
  address                         String?
  currency                        String                           @default("EGP")
  plan                            CompaniesPlan                    @default(BASIC)
  planConfigurationId             String?
  isActive                        Boolean                          @default(true)
  settings                        String?                          @db.Text
  createdAt                       DateTime                         @default(now())
  updatedAt                       DateTime
  slug                            String?                          @unique
  facebookUserAccessToken         String?                          @db.Text
  facebookPixelAccessToken        String?                          @db.Text
  useCentralKeys                  Boolean                          @default(false)
  facebookAdsAccessToken          String?                          @db.Text
  turboApiKey                     String?                          @db.Text
  turboAutoCreate                 Boolean                          @default(false)
  turboEnabled                    Boolean                          @default(false)
  turboWebhookUrl                 String?
  turboMainClientCode             Int?
  turboWebhookToken               String?                          @db.Text
  turboSenderNumber               String?
  sidebarLayout                   String                           @default("three-tier")
  customDomain                    String?                          @unique
  timezone                        String                           @default("Asia/Riyadh")
  geofenceEnabled                 Boolean                          @default(false)
  geofenceRadius                  Int?                             @default(200)
  officeLatitude                  Decimal?                         @db.Decimal(10, 8)
  officeLongitude                 Decimal?                         @db.Decimal(11, 8)
  platformCommissionRate          Float?                           @default(5)
  SupportTicket                   SupportTicket[]
  activity_logs                   ActivityLog[]
  affiliate_settings              AffiliateSetting?
  affiliates                      Affiliate[]
  aiInteractions                  AiInteraction[]
  aiKeies                         AiKey[]
  aiSettings                      AiSettings?
  aiTraces                        AiTrace[]
  appointments                    Appointment[]
  assetCategories                 AssetCategory[]
  assets                          Asset[]
  backInStockNotifications        BackInStockNotification[]
  branches                        Branche[]
  broadcastCampaigns              BroadcastCampaign[]
  broadcastSettings               BroadcastSettings?
  categories                      Category[]
  checkoutFormSettings            CheckoutFormSettings?
  commissions                     Commission[]
  planConfiguration               PlanConfiguration?               @relation(fields: [planConfigurationId], references: [id])
  conversationMemories            ConversationMemory[]
  conversationOutcomes            ConversationOutcome[]
  conversations                   Conversation[]
  conversion_events               ConversionEvent[]
  coupons                         Coupon[]
  customerLists                   CustomerList[]
  customerLoyaltyPrograms         CustomerLoyaltyProgram[]
  customerLoyaltyRecords          CustomerLoyaltyRecord[]
  customerLoyaltyTiers            CustomerLoyaltyTier[]
  customerNotificationPreferences CustomerNotificationPreference[]
  customers                       Customer[]

  dailyAnalytics                  DailyAnalytic[]
  deliveryOptions                 DeliveryOption[]
  employeeNotificationPreferences EmployeeNotificationPreference[]
  facebookAdAccounts              FacebookAdAccount[]
  facebookAdTests                 FacebookAdTest[]
  facebookCampaigns               FacebookCampaign[]
  facebookComments                FacebookComment[]
  facebookCustomAudiences         FacebookCustomAudience[]
  facebookDynamicAds              FacebookDynamicAd[]
  facebookLookalikeAudiences      FacebookLookalikeAudience[]
  facebookPages                   FacebookPage[]
  facebookProductCatalogs         FacebookProductCatalog[]
  faqs                            Faq[]
  footerSettings                  FooterSettings?
  guestCarts                      GuestCart[]
  guestOrders                     GuestOrder[]
  homepageTemplates               HomepageTemplate[]
  hrAdvanceRequests               HrAdvanceRequest[]
  hrAttendances                   HrAttendance[]
  hrHRAuditLogs                   HrHRAuditLog[]
  hrBenefitEnrollments            HrBenefitEnrollment[]
  hrBenefits                      HrBenefit[]
  hrDepartments                   HrDepartment[]
  hrEmployeeDocuments             HrEmployeeDocument[]
  hrEmployeeTrainings             HrEmployeeTraining[]
  hrEmployeeWarnings              HrEmployeeWarning[]
  hrFeedbacks                     HrFeedback[]
  hrGoals                         HrGoal[]
  hrKudos                         HrKudos[]
  hrLatenessBalances              HrLatenessBalance[]
  hrLeaveRequests                 HrLeaveRequest[]
  hrManualDeductions              HrManualDeduction[]
  hrPayrolls                      HrPayroll[]
  hrPerformanceReviews            HrPerformanceReview[]
  hrPositions                     HrPosition[]
  hrPromotions                    HrPromotion[]
  hr_resignations                 Resignation[]

  hrRewardEligibilityLogs HrRewardEligibilityLog[]
  hrRewardRecords         HrRewardRecord[]
  hrRewardSettings        HrRewardSettings?
  hrRewardTypes           HrRewardType[]
  hrSalaryHistories       HrSalaryHistory[]
  hrHRSettings            HrHRSettings?
  hrShiftAssignments      HrShiftAssignment[]
  hrShifts                HrShift[]
  imageGalleries          ImageGallery[]
  imageStudioHistories    ImageStudioHistory[]
  imageStudioUsages       ImageStudioUsage[]
  integrations            Integration[]
  invoices                Invoice[]
  lateWarnings            LateWarning[]
  learningDatas           LearningData[]
  learningSettings        LearningSettings?
  merchants               Merchant[]

  orderInvoiceSettings OrderInvoiceSettings?
  orderStatusConfigs   OrderStatusConfig[]
  orders               Order[]
  pageResponseSettings PageResponseSettings[]
  payments             Payment[]
  policies             Policy[]
  postResponseSettings PostResponseSettings[]
  postTrackings        PostTracking[]
  productAnalytics     ProductAnalytic[]
  productReviews       ProductReview[]
  productVisits        ProductVisit[]
  products             Product[]

  projects                        Project[]
  purchaseInvoices                PurchaseInvoice[]
  purchaseOrders                  PurchaseOrder[]
  recentlyVieweds                 RecentlyViewed[]
  responseEffectiveness           ResponseEffectiveness[]
  returnReasonCategories          ReturnReasonCategory[]
  returnReasons                   ReturnReason[]
  returnRequests                  ReturnRequest[]
  returnSettings                  ReturnSettings?
  sentMessageStats                SentMessageStat[]
  shippingZones                   ShippingZone[]
  storePages                      StorePage[]
  storePromotionSettings          StorePromotionSettings?
  storeVisits                     StoreVisit[]
  storefrontSettings              StorefrontSettings?
  subscriptions                   Subscription[]
  supplierPayments                SupplierPayment[]
  suppliers                       Supplier[]
  systemPrompts                   SystemPrompt[]
  taskActivities                  TaskActivity[]
  taskAttachments                 TaskAttachment[]
  taskCategories                  TaskCategory[]
  taskChecklists                  TaskChecklist[]
  taskComments                    TaskComment[]
  taskDependencies                TaskDependency[]
  taskNotifications               TaskNotification[]
  taskTemplates                   TaskTemplate[]
  taskWatchers                    TaskWatcher[]
  tasks                           Task[]
  telegramConfigs                 TelegramConfig[]
  textGalleries                   TextGallery[]
  time_entries                    TimeEntry[]
  userCompanies                   UserCompany[]
  dev_projects                    DevProject[]
  dev_team_members                DevTeamMember[]
  dev_tasks                       DevTask[]
  users                           User[]
  warehouses                      Warehouse[]
  whatsapp_notification_logs      WhatsAppNotificationLog[]
  whatsapp_notification_queue     WhatsAppNotificationQueue[]
  whatsapp_notification_settings  WhatsAppNotificationSettings?
  whatsapp_notification_templates WhatsAppNotificationTemplate[]
  whatsAppQuickReplies            WhatsAppQuickReply[]
  whatsAppSessions                WhatsAppSession[]
  whatsAppSettings                WhatsAppSettings?
  wishlists                       Wishlist[]
  woocommerceSettings             WoocommerceSettings?
  woocommerceSyncLogs             WoocommerceSyncLog[]
  installedApps                   CompanyApp[]
  wallet                          CompanyWallet?

  notifications Notification[]
  appReviews    AppReview[]

  userInvitations UserInvitation[] @relation

  hrEmployees HrEmployee[] @relation

  customerWallets CustomerWallet[] @relation

  @@index([planConfigurationId])
  @@map("companies")
}

model User {
  id                                                String                   @id
  email                                             String                   @unique
  password                                          String
  firstName                                         String
  lastName                                          String
  avatar                                            String?
  phone                                             String?
  role                                              String?
  isActive                                          Boolean                  @default(true)
  isEmailVerified                                   Boolean                  @default(false)
  emailVerifiedAt                                   DateTime?
  lastLoginAt                                       DateTime?
  passwordChangedAt                                 DateTime?
  companyId                                         String?
  createdAt                                         DateTime                 @default(now())
  updatedAt                                         DateTime
  resetPasswordExpires                              DateTime?
  resetPasswordToken                                String?
  availability                                      String?                  @default("available")
  department                                        String?
  skills                                            String?                  @db.Text
  baseSalary                                        Decimal?                 @db.Decimal(12, 2)
  contractType                                      UsersContractType?
  departmentId                                      String?
  employeeNumber                                    String?
  hireDate                                          DateTime?
  positionId                                        String?
  timezone                                          String                   @default("Asia/Riyadh")
  enableAutoDeduction                               Boolean                  @default(true)
  lateDeductionRate                                 Decimal?                 @db.Decimal(10, 2)
  maxDailyLateMinutes                               Int?                     @default(10)
  monthlyGraceMinutes                               Int?                     @default(60)
  SupportMessage                                    SupportMessage[]
  SupportTicket_SupportTicket_assignedUserIdTousers SupportTicket[]          @relation("SupportTicket_assignedUserIdTousers")
  SupportTicket_SupportTicket_userIdTousers         SupportTicket[]          @relation("SupportTicket_userIdTousers")
  activities                                        Activity[]
  activity_logs                                     ActivityLog[]
  affiliates                                        Affiliate?
  callAttemptLogs                                   CallAttemptLog[]
  hrClearanceChecklists                             HrClearanceChecklist[]
  conversations                                     Conversation[]
  customerNotes                                     CustomerNote[]
  dev_team_members                                  DevTeamMember?
  guestOrders                                       GuestOrder[]
  hrAttendances                                     HrAttendance[]
  hrHRAuditLogs                                     HrHRAuditLog[]
  hr_kudos_hr_kudos_fromUserIdTousers               HrKudos[]                @relation("hr_kudos_fromUserIdTousers")
  hr_kudos_hr_kudos_toUserIdTousers                 HrKudos[]                @relation("hr_kudos_toUserIdTousers")
  hrRewardEligibilityLogs                           HrRewardEligibilityLog[]
  hrRewardRecords                                   HrRewardRecord[]
  hrShiftAssignments                                HrShiftAssignment[]
  imageGalleries                                    ImageGallery[]
  imageStudioHistories                              ImageStudioHistory[]
  messages                                          Message[]
  notifications                                     Notification[]
  orderNotes                                        OrderNote[]
  orders                                            Order[]                  @relation("OrderCreatedBy")
  projects                                          Project[]
  returnActivityLogs                                ReturnActivityLog[]
  returnContactAttempts                             ReturnContactAttempt[]
  returnRequests                                    ReturnRequest[]
  taskActivities                                    TaskActivity[]
  taskAttachments                                   TaskAttachment[]
  taskChecklistItems                                TaskChecklistItem[]
  taskComments                                      TaskComment[]
  taskNotifications                                 TaskNotification[]
  taskTemplates                                     TaskTemplate[]
  taskWatchers                                      TaskWatcher[]
  tasks_tasks_assignedToTousers                     Task[]                   @relation("tasks_assignedToTousers")
  tasks_tasks_createdByTousers                      Task[]                   @relation("tasks_createdByTousers")
  textGalleries                                     TextGallery[]
  time_entries                                      TimeEntry[]
  userCompanies                                     UserCompany[]
  userInvitations                                   UserInvitation[]
  company                                           Company?                 @relation(fields: [companyId], references: [id], onDelete: Cascade)
  hrDepartment                                      HrDepartment?            @relation(fields: [departmentId], references: [id])
  hrPosition                                        HrPosition?              @relation(fields: [positionId], references: [id])
  whatsAppMessages                                  WhatsAppMessage[]

  hrEmployees HrEmployee[] @relation
  Order       Order[]

  appReviews AppReview[]

  @@index([companyId])
  @@index([departmentId])
  @@index([positionId])
}

model UserCompany {
  id        String            @id
  userId    String
  companyId String
  role      UserCompaniesRole @default(AGENT)
  isActive  Boolean           @default(true)
  isDefault Boolean           @default(false)
  joinedAt  DateTime          @default(now())
  createdAt DateTime          @default(now())
  updatedAt DateTime
  company   Company           @relation(fields: [companyId], references: [id], onDelete: Cascade)
  user      User              @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, companyId])
  @@index([companyId])
  @@index([userId])
  @@map("user_companies")
}

model UserInvitation {
  id         String                @id
  email      String
  firstName  String
  lastName   String
  role       String                @default("AGENT")
  token      String                @unique
  status     UserInvitationsStatus @default(PENDING)
  invitedBy  String
  companyId  String
  expiresAt  DateTime
  acceptedAt DateTime?
  createdAt  DateTime              @default(now())
  updatedAt  DateTime
  company    Company               @relation(fields: [companyId], references: [id], onDelete: Cascade)
  user       User                  @relation(fields: [invitedBy], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([invitedBy])
  @@index([token])
  @@map("user_invitations")
}

model Activity {
  id          String    @id
  userId      String?
  customerId  String?
  action      String
  description String
  metadata    String?   @db.Text
  ipAddress   String?
  userAgent   String?
  createdAt   DateTime  @default(now())
  customers   Customer? @relation(fields: [customerId], references: [id])
  users       User?     @relation(fields: [userId], references: [id])

  @@index([customerId])
  @@index([userId])
  @@map("activities")
}

model ActivityLog {
  id           String   @id
  userId       String
  companyId    String
  category     String
  action       String
  description  String   @db.Text
  targetType   String?
  targetId     String?
  targetName   String?
  metadata     String?  @db.Text
  severity     String   @default("LOW")
  isSuccess    Boolean  @default(true)
  errorMessage String?  @db.Text
  tags         String?  @db.Text
  isLocked     Boolean  @default(true)
  createdAt    DateTime @default(now())
  updatedAt    DateTime
  company      Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([action])
  @@index([category])
  @@index([companyId, createdAt(sort: Desc)])
  @@index([companyId])
  @@index([createdAt(sort: Desc)])
  @@index([isSuccess])
  @@index([severity])
  @@index([userId, createdAt(sort: Desc)])
  @@index([userId])
  @@map("activity_logs")
}

model Integration {
  id          String    @id
  name        String
  type        String
  platform    String
  externalId  String
  accessToken String?   @db.Text
  config      String    @db.Text
  settings    String?   @db.Text
  status      String    @default("ACTIVE")
  isActive    Boolean   @default(true)
  lastSyncAt  DateTime?
  companyId   String
  createdAt   DateTime  @default(now())
  updatedAt   DateTime
  companies   Company   @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@unique([companyId, platform, externalId])
  @@map("integrations")
}

model Policy {
  id                   String    @id
  companyId            String
  title                String
  content              String    @db.Text
  category             String    @default("general")
  tags                 String?   @db.Text
  order                Int       @default(0)
  isActive             Boolean   @default(true)
  version              Int       @default(1)
  effectiveAt          DateTime  @default(now())
  expiresAt            DateTime?
  createdAt            DateTime  @default(now())
  updatedAt            DateTime
  embedding            String?   @db.Text
  embeddingGeneratedAt DateTime?
  companies            Company   @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([category])
  @@index([companyId])
  @@index([companyId, isActive, effectiveAt])
  @@index([isActive])
  @@map("policies")
}

model Customer {
  id                             String                          @id
  firstName                      String
  lastName                       String
  email                          String?
  phone                          String?
  avatar                         String?
  facebookId                     String?
  whatsappId                     String?
  telegramId                     String?
  status                         CustomersStatus                 @default(LEAD)
  tags                           String?
  notes                          String?
  metadata                       String?                         @db.Text
  companyId                      String
  createdAt                      DateTime                        @default(now())
  updatedAt                      DateTime
  customerRating                 CustomersCustomerRating         @default(UNKNOWN)
  successScore                   Float                           @default(0)
  deliveryRate                   Float                           @default(0)
  totalDelivered                 Int                             @default(0)
  totalOrdersCount               Int                             @default(0)
  activities                     Activity[]
  affiliate_referrals            AffiliateReferral[]
  aiInteractions                 AiInteraction[]
  appointments                   Appointment[]
  blockedCustomersOnPages        BlockedCustomersOnPage[]
  conversationOutcomes           ConversationOutcome[]
  conversations                  Conversation[]
  customerLoyaltyRecords         CustomerLoyaltyRecord[]
  customerNotes                  CustomerNote[]
  customerNotificationPreference CustomerNotificationPreference?
  companies                      Company                         @relation(fields: [companyId], references: [id], onDelete: Cascade)
  orders                         Order[]
  returnRequests                 ReturnRequest[]
  whatsAppContacts               WhatsAppContact[]
  whatsapp_notification_logs     WhatsAppNotificationLog[]

  customerWallets CustomerWallet[] @relation

  @@unique([facebookId, companyId])
  @@unique([telegramId, companyId])
  @@unique([whatsappId, companyId])
  @@index([companyId])
  @@index([companyId, status])
  @@index([facebookId])
  @@index([status])
  @@map("customers")
}

model BackInStockNotification {
  id            String    @id
  productId     String
  companyId     String
  customerName  String
  customerEmail String?
  customerPhone String?
  notifyEmail   Boolean   @default(true)
  notifySMS     Boolean   @default(false)
  isNotified    Boolean   @default(false)
  notifiedAt    DateTime?
  createdAt     DateTime  @default(now())
  companies     Company   @relation(fields: [companyId], references: [id], onDelete: Cascade)
  products      Product   @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([isNotified])
  @@index([productId])
  @@map("back_in_stock_notifications")
}

model BlockedCustomersOnPage {
  id             String       @id
  facebookPageId String
  pageId         String
  customerId     String
  facebookId     String
  blockedBy      String?
  reason         String?      @db.Text
  blockedAt      DateTime     @default(now())
  createdAt      DateTime     @default(now())
  updatedAt      DateTime
  metadata       String?      @db.Text
  customers      Customer     @relation(fields: [customerId], references: [id], onDelete: Cascade)
  facebookPage   FacebookPage @relation(fields: [facebookPageId], references: [id], onDelete: Cascade)

  @@unique([facebookPageId, customerId])
  @@unique([pageId, facebookId])
  @@index([customerId])
  @@index([facebookId])
  @@index([facebookPageId])
  @@index([pageId])
  @@map("blocked_customers_on_page")
}

model Branche {
  id           String   @id
  name         String
  address      String?
  city         String?
  phone        String
  email        String?
  workingHours String?
  isActive     Boolean  @default(true)
  companyId    String
  createdAt    DateTime @default(now())
  updatedAt    DateTime
  companies    Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([isActive])
  @@map("branches")
}

model Category {
  id               String     @id
  name             String
  description      String?    @db.Text
  image            String?
  parentId         String?
  isActive         Boolean    @default(true)
  sortOrder        Int        @default(0)
  companyId        String
  createdAt        DateTime   @default(now())
  updatedAt        DateTime
  displayType      String     @default("default")
  metaDescription  String?    @db.Text
  metaTitle        String?
  slug             String?
  companies        Company    @relation(fields: [companyId], references: [id], onDelete: Cascade)
  category         Category?  @relation("categoriesTocategories", fields: [parentId], references: [id])
  other_categories Category[] @relation("categoriesTocategories")
  products         Product[]

  @@unique([companyId, slug])
  @@index([companyId])
  @@index([parentId])
  @@index([slug])
  @@map("categories")
}

model CouponUsage {
  id             String   @id
  couponId       String
  companyId      String
  customerId     String?
  orderId        String?
  discountAmount Decimal  @db.Decimal(10, 2)
  orderAmount    Decimal  @db.Decimal(10, 2)
  usedAt         DateTime @default(now())
  coupon         Coupon   @relation(fields: [couponId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([couponId])
  @@index([customerId])
  @@index([orderId])
  @@index([usedAt])
  @@map("coupon_usages")
}

model Coupon {
  id                String        @id
  companyId         String
  code              String
  name              String
  description       String?       @db.Text
  type              CouponType    @default(PERCENTAGE)
  value             Decimal       @db.Decimal(10, 2)
  minOrderAmount    Decimal?      @db.Decimal(10, 2)
  maxDiscountAmount Decimal?      @db.Decimal(10, 2)
  usageLimit        Int?
  usageCount        Int           @default(0)
  userUsageLimit    Int?
  validFrom         DateTime
  validTo           DateTime
  isActive          Boolean       @default(true)
  customerSegments  String?       @db.Text
  metadata          String?       @db.Text
  createdBy         String?
  createdAt         DateTime      @default(now())
  updatedAt         DateTime
  couponUsages      CouponUsage[]
  companies         Company       @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@unique([companyId, code])
  @@index([code])
  @@index([companyId])
  @@index([isActive])
  @@index([validFrom, validTo])
  @@map("coupons")
}

model CustomerList {
  id          String   @id
  name        String
  description String?  @db.Text
  criteria    String   @db.LongText
  count       Int      @default(0)
  isDefault   Boolean  @default(false)
  companyId   String
  createdAt   DateTime @default(now())
  updatedAt   DateTime
  companies   Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@map("customer_lists")
}

model CustomerNote {
  id         String   @id
  customerId String
  authorId   String
  content    String   @db.Text
  createdAt  DateTime @default(now())
  updatedAt  DateTime
  users      User     @relation(fields: [authorId], references: [id], onDelete: Cascade)
  customers  Customer @relation(fields: [customerId], references: [id], onDelete: Cascade)

  @@index([authorId])
  @@index([customerId])
  @@map("customer_notes")
}

model DeliveryOption {
  id           String   @id
  name         String
  description  String?  @db.Text
  deliveryTime String
  price        Decimal  @db.Decimal(10, 2)
  isDefault    Boolean  @default(false)
  isActive     Boolean  @default(true)
  icon         String?
  sortOrder    Int      @default(0)
  companyId    String
  createdAt    DateTime @default(now())
  updatedAt    DateTime
  companies    Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([isActive])
  @@map("delivery_options")
}

model GuestCart {
  id        String   @id
  cartId    String   @unique
  items     String   @db.LongText
  total     Decimal  @default(0.00) @db.Decimal(10, 2)
  companyId String
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now())
  expiresAt DateTime
  companies Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([cartId])
  @@index([companyId])
  @@index([expiresAt])
  @@map("guest_carts")
}

model GuestOrder {
  id                  String               @id
  orderNumber         String
  guestEmail          String
  guestPhone          String
  guestName           String
  items               String               @db.LongText
  total               Decimal              @db.Decimal(10, 2)
  shippingCost        Decimal              @default(0.00) @db.Decimal(10, 2)
  discountAmount      Decimal              @default(0.00) @db.Decimal(10, 2)
  finalTotal          Decimal              @db.Decimal(10, 2)
  shippingAddress     String               @db.LongText
  paymentMethod       String
  status              String               @default("pending")
  notes               String?              @db.Text
  companyId           String
  createdAt           DateTime             @default(now())
  updatedAt           DateTime             @default(now())
  isViewed            Boolean              @default(false)
  metadata            String?              @db.Text
  affiliateId         String?
  turboLabelUrl       String?              @db.Text
  turboMetadata       String?              @db.Text
  turboShipmentId     String?
  turboShipmentStatus String?
  turboTrackingNumber String?
  createdBy           String?
  createdByName       String?
  OrderStatusHistory  OrderStatusHistory[]
  affiliates          Affiliate?           @relation(fields: [affiliateId], references: [id])
  companies           Company              @relation(fields: [companyId], references: [id], onDelete: Cascade)
  users               User?                @relation(fields: [createdBy], references: [id])
  orderNotes          OrderNote[]

  @@unique([companyId, orderNumber])
  @@index([affiliateId])
  @@index([companyId])
  @@index([createdAt])
  @@index([createdBy])
  @@index([guestEmail])
  @@index([orderNumber])
  @@index([status])
  @@index([turboShipmentId])
  @@index([turboTrackingNumber])
  @@map("guest_orders")
}

model InvoiceItem {
  id          String   @id
  invoiceId   String
  description String
  quantity    Float    @default(1)
  unitPrice   Float
  totalPrice  Float
  metadata    String?  @db.LongText
  createdAt   DateTime @default(now())
  invoice     Invoice  @relation(fields: [invoiceId], references: [id], onDelete: Cascade)

  @@index([invoiceId])
  @@map("invoice_items")
}

model Invoice {
  id              String           @id
  invoiceNumber   String           @unique
  subscriptionId  String?
  companyId       String
  status          InvoicesStatus   @default(DRAFT)
  type            InvoiceType      @default(SUBSCRIPTION)
  issueDate       DateTime         @default(now())
  dueDate         DateTime
  paidDate        DateTime?
  subtotal        Float
  taxAmount       Float            @default(0)
  discountAmount  Float            @default(0)
  totalAmount     Float
  currency        String           @default("EGP")
  notes           String?
  paymentTerms    String?          @default("Net 30")
  metadata        String?          @db.LongText
  createdAt       DateTime         @default(now())
  updatedAt       DateTime
  invoiceItems    InvoiceItem[]
  companies       Company          @relation(fields: [companyId], references: [id], onDelete: Cascade)
  subscription    Subscription?    @relation(fields: [subscriptionId], references: [id])
  paymentReceipts PaymentReceipt[]
  payments        Payment[]

  @@index([companyId])
  @@index([subscriptionId])
  @@map("invoices")
}

model OrderItem {
  id               String          @id
  orderId          String
  productId        String?
  quantity         Int
  price            Decimal         @db.Decimal(10, 2)
  total            Decimal         @db.Decimal(10, 2)
  productName      String?
  productColor     String?
  productSize      String?
  productSku       String?
  metadata         String?         @db.Text
  variantId        String?
  extractionSource String?         @default("ai")
  confidence       Float?
  productImage     String?
  productDetails   String?
  basePrice        Decimal?        @db.Decimal(10, 2)
  merchantPrice    Decimal?        @db.Decimal(10, 2)
  orders           Order           @relation(fields: [orderId], references: [id], onDelete: Cascade)
  products         Product?        @relation(fields: [productId], references: [id], onDelete: Cascade)
  productVariant   ProductVariant? @relation(fields: [variantId], references: [id])

  @@index([orderId])
  @@index([productId])
  @@index([variantId])
  @@map("order_items")
}

model OrderNote {
  id           String      @id
  content      String      @db.Text
  orderId      String?
  guestOrderId String?
  authorId     String?
  authorName   String
  createdAt    DateTime    @default(now())
  users        User?       @relation(fields: [authorId], references: [id])
  guestOrder   GuestOrder? @relation(fields: [guestOrderId], references: [id])
  orders       Order?      @relation(fields: [orderId], references: [id])

  @@index([authorId])
  @@index([guestOrderId])
  @@index([orderId])
  @@map("order_notes")
}

model OrderStatusConfig {
  id                  String   @id
  companyId           String
  code                String
  name                String
  nameEn              String?
  description         String?  @db.Text
  color               String   @default("#6B7280")
  icon                String?
  sortOrder           Int      @default(0)
  statusType          String   @default("order")
  source              String   @default("system")
  isSystemStatus      Boolean  @default(false)
  isActive            Boolean  @default(true)
  mapsToSystem        String?
  wooCommerceStatus   String?
  allowedNextStatuses String?  @db.Text
  autoActions         String?  @db.Text
  notifyCustomer      Boolean  @default(false)
  notifyAdmin         Boolean  @default(false)
  emailTemplate       String?  @db.Text
  smsTemplate         String?  @db.Text
  createdAt           DateTime @default(now())
  updatedAt           DateTime
  companies           Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@unique([companyId, code])
  @@index([companyId])
  @@index([source])
  @@index([statusType])
  @@map("order_status_configs")
}

model Order {
  id                     String                    @id @default(cuid())
  orderNumber            String
  customerId             String
  conversationId         String?
  status                 OrderStatus               @default(PENDING)
  isViewed               Boolean                   @default(false)
  paymentStatus          PaymentStatus             @default(PENDING)
  paymentMethod          PaymentMethod             @default(CASH)
  subtotal               Decimal                   @db.Decimal(10, 2)
  tax                    Decimal                   @default(0.00) @db.Decimal(10, 2)
  shipping               Decimal                   @default(0.00) @db.Decimal(10, 2)
  discount               Decimal                   @default(0.00) @db.Decimal(10, 2)
  total                  Decimal                   @db.Decimal(10, 2)
  currency               String                    @default("EGP")
  notes                  String?
  shippingAddress        String?                   @db.Text
  billingAddress         String?                   @db.Text
  customerName           String?
  customerPhone          String?
  customerEmail          String?
  city                   String?
  governorate            String?
  customerAddress        String?
  dataQuality            String?                   @db.Text
  extractionMethod       String?                   @default("ai_enhanced")
  confidence             Float?
  validationStatus       String?                   @default("pending")
  sourceType             String?                   @default("ai_conversation")
  extractionTimestamp    DateTime?
  metadata               String?                   @db.Text
  companyId              String
  createdAt              DateTime                  @default(now())
  updatedAt              DateTime                  @updatedAt
  lastSyncAt             DateTime?
  syncedFromWoo          Boolean                   @default(false)
  syncedToWoo            Boolean                   @default(false)
  wooCommerceDateCreated DateTime?
  wooCommerceId          String?
  wooCommerceOrderKey    String?
  wooCommerceStatus      String?
  wooCommerceUrl         String?
  turboBranchId          String?
  turboLabelUrl          String?
  statusHistory          OrderStatusHistory[]
  turboMetadata          String?                   @db.Text
  turboShipmentId        String?
  turboShipmentStatus    String?
  turboTrackingNumber    String?
  orderItems             OrderItem[]
  orderNotes             OrderNote[]
  company                Company                   @relation(fields: [companyId], references: [id], onDelete: Cascade)
  conversation           Conversation?             @relation(fields: [conversationId], references: [id])
  customer               Customer                  @relation(fields: [customerId], references: [id], onDelete: Cascade)
  returnRequests         ReturnRequest[]
  callAttempts           Int                       @default(0)
  lastCallAttemptAt      DateTime?
  callAttemptLogs        CallAttemptLog[]
  orderInvoice           OrderInvoice?
  conversionEvents       ConversionEvent[]
  notificationLogs       WhatsAppNotificationLog[]

  scheduledDeliveryDate   DateTime?
  isScheduled             Boolean   @default(false)
  scheduledNotes          String?   @db.Text
  autoTransitionEnabled   Boolean   @default(true)
  scheduledTransitionedAt DateTime?

  // Affiliate & Dropshipping fields
  affiliateReferralId String?     @unique //   (     )
  affiliateId         String? //    (   )
  merchantOrderId     String?     @unique //   
  isDropshipped       Boolean     @default(false)
  orderSource         OrderSource @default(REGULAR) // REGULAR, AFFILIATE_REFERRAL, AFFILIATE_DIRECT

  // Order Creator fields
  createdBy     String? //     
  createdByName String? //     

  affiliateReferral AffiliateReferral? @relation("OrderAffiliateReferral")
  affiliate         Affiliate?         @relation(fields: [affiliateId], references: [id])
  merchantOrder     MerchantOrder?     @relation("OrderMerchantOrder")
  commissions       Commission[]
  createdByUser     User?              @relation("OrderCreatedBy", fields: [createdBy], references: [id])

  // Wallet relations
  walletTransactions WalletTransaction[]

  userRel   User?   @relation(fields: [userRelId], references: [id])
  userRelId String?

  @@unique([companyId, orderNumber])
  @@index([affiliateId])
  @@index([companyId])
  @@index([conversationId])
  @@index([createdBy])
  @@index([customerId])
  @@index([isScheduled])
  @@index([orderSource])
  @@index([scheduledDeliveryDate])
  @@index([turboTrackingNumber])
  @@index([wooCommerceId])
  @@map("orders")
}

model PaymentReceipt {
  id             String       @id
  invoiceId      String
  walletNumberId String
  receiptImage   String
  status         String       @default("PENDING")
  submittedAt    DateTime     @default(now())
  reviewedAt     DateTime?
  reviewedBy     String?
  notes          String?
  createdAt      DateTime     @default(now())
  updatedAt      DateTime
  invoice        Invoice      @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
  walletNumber   WalletNumber @relation(fields: [walletNumberId], references: [id], onDelete: Cascade)

  @@index([invoiceId])
  @@index([walletNumberId])
  @@map("payment_receipts")
}

model Payment {
  id               String         @id
  paymentNumber    String         @unique
  invoiceId        String?
  subscriptionId   String?
  companyId        String
  amount           Float
  currency         String         @default("EGP")
  status           PaymentsStatus @default(PENDING)
  method           PaymentsMethod @default(BANK_TRANSFER)
  gateway          String?
  gatewayPaymentId String?
  transactionId    String?
  paidAt           DateTime?
  failedAt         DateTime?
  failureReason    String?
  metadata         String?        @db.LongText
  createdAt        DateTime       @default(now())
  updatedAt        DateTime
  companies        Company        @relation(fields: [companyId], references: [id], onDelete: Cascade)
  invoice          Invoice?       @relation(fields: [invoiceId], references: [id])
  subscription     Subscription?  @relation(fields: [subscriptionId], references: [id])

  @@index([companyId])
  @@index([invoiceId])
  @@index([subscriptionId])
  @@map("payments")
}

model ProductReview {
  id            String   @id
  productId     String
  companyId     String
  customerName  String
  customerEmail String?
  customerPhone String?
  rating        Int
  title         String?
  comment       String?  @db.Text
  isVerified    Boolean  @default(false)
  isApproved    Boolean  @default(false)
  helpfulCount  Int      @default(0)
  createdAt     DateTime @default(now())
  updatedAt     DateTime
  companies     Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  products      Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([isApproved])
  @@index([productId])
  @@index([rating])
  @@map("product_reviews")
}

model ProductVariant {
  id             String      @id
  productId      String
  name           String
  type           String      @default("color")
  sku            String?
  price          Decimal?    @db.Decimal(10, 2)
  comparePrice   Decimal?    @db.Decimal(10, 2)
  cost           Decimal?    @db.Decimal(10, 2)
  images         String?     @db.Text
  stock          Int         @default(0)
  trackInventory Boolean     @default(true)
  isActive       Boolean     @default(true)
  sortOrder      Int         @default(0)
  metadata       String?     @db.Text
  createdAt      DateTime    @default(now())
  updatedAt      DateTime
  orderItems     OrderItem[]
  products       Product     @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([productId, sku])
  @@index([productId])
  @@index([sku])
  @@map("product_variants")
}

model Product {
  id                         String                    @id
  name                       String
  description                String?                   @db.Text
  sku                        String?
  price                      Decimal                   @db.Decimal(10, 2)
  comparePrice               Decimal?                  @db.Decimal(10, 2)
  cost                       Decimal?                  @db.Decimal(10, 2)
  images                     String?                   @db.Text
  stock                      Int                       @default(0)
  trackInventory             Boolean                   @default(true)
  weight                     Decimal?                  @db.Decimal(8, 2)
  dimensions                 String?                   @db.Text
  categoryId                 String?
  isActive                   Boolean                   @default(true)
  isFeatured                 Boolean                   @default(false)
  tags                       String?
  metadata                   String?                   @db.Text
  companyId                  String
  createdAt                  DateTime                  @default(now())
  updatedAt                  DateTime
  barcode                    String?
  easyOrdersId               String?
  easyOrdersUrl              String?
  source                     String?                   @default("manual")
  wooCommerceId              String?
  wooCommerceUrl             String?
  hasPromotedAd              Boolean                   @default(false)
  enableCheckoutForm         Boolean                   @default(true)
  showAddToCartButton        Boolean                   @default(true)
  saleStartDate              DateTime?
  saleEndDate                DateTime?
  sizeGuide                  String?                   @db.Text
  isPreOrder                 Boolean                   @default(false)
  preOrderDate               DateTime?
  preOrderMessage            String?                   @db.Text
  embedding                  String?                   @db.Text
  embeddingGeneratedAt       DateTime?
  slug                       String?
  isDropshipped              Boolean                   @default(false)
  merchantProductId          String?
  basePrice                  Decimal?                  @db.Decimal(10, 2)
  allowAffiliateMarkup       Boolean                   @default(false)
  affiliateCommission        Decimal?                  @db.Decimal(10, 2)
  commissionType             String?                   @default("PERCENTAGE")
  affiliate_products         AffiliateProduct[]
  backInStockNotifications   BackInStockNotification[]
  conversion_events          ConversionEvent[]
  facebookCatalogProducts    FacebookCatalogProduct[]
  inventories                Inventory[]
  merchantProducts           MerchantProduct[]
  orderItems                 OrderItem[]
  postResponseSettings       PostResponseSettings[]
  productAnalytics           ProductAnalytic[]
  productReviews             ProductReview[]
  productVariants            ProductVariant[]
  productVisits              ProductVisit[]
  category                   Category?                 @relation(fields: [categoryId], references: [id])
  companies                  Company                   @relation(fields: [companyId], references: [id], onDelete: Cascade)
  purchaseInvoiceItems       PurchaseInvoiceItem[]
  purchaseOrderItems         PurchaseOrderItem[]
  recentlyVieweds            RecentlyViewed[]
  stockAlerts                StockAlert[]
  stockMovements             StockMovement[]
  whatsapp_notification_logs WhatsAppNotificationLog[]
  wishlists                  Wishlist[]

  @@unique([companyId, sku])
  @@unique([companyId, slug])
  @@index([categoryId])
  @@index([companyId])
  @@index([sku])
  @@index([wooCommerceId])
  @@map("products")
}

model ShippingZone {
  id                    String           @id
  governorates          String           @db.LongText
  price                 Decimal          @default(0.00) @db.Decimal(10, 2)
  deliveryTime          String
  isActive              Boolean          @default(true)
  companyId             String
  createdAt             DateTime         @default(now())
  updatedAt             DateTime
  deliveryTimeType      String           @default("custom")
  freeShippingThreshold Decimal?         @db.Decimal(10, 2)
  name                  String           @default("")
  pricingTiers          String?          @db.LongText
  pricingType           String           @default("flat")
  shippingMethods       ShippingMethod[]
  companies             Company          @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([isActive])
  @@index([pricingType])
  @@map("shipping_zones")
}

model StockAlert {
  id              String              @id
  type            StockAlertType
  priority        StockAlertsPriority
  productId       String
  productName     String
  warehouseId     String
  warehouseName   String
  message         String
  currentStock    Int?
  reorderPoint    Int?
  reorderQuantity Int?
  isRead          Boolean             @default(false)
  createdAt       DateTime            @default(now())
  products        Product             @relation(fields: [productId], references: [id], onDelete: Cascade)
  warehouse       Warehouse           @relation(fields: [warehouseId], references: [id], onDelete: Cascade)

  @@index([isRead])
  @@index([priority])
  @@index([productId])
  @@index([warehouseId])
  @@map("stock_alerts")
}

model StockMovement {
  id          String               @id
  productId   String
  warehouseId String
  type        StockMovementType
  reason      StockMovementsReason
  quantity    Int
  cost        Decimal?             @db.Decimal(10, 2)
  reference   String?
  notes       String?
  userId      String?
  userName    String?
  createdAt   DateTime             @default(now())
  approvedAt  DateTime?
  approvedBy  String?
  batchNumber String?
  expiryDate  DateTime?
  isApproved  Boolean              @default(true)
  products    Product              @relation(fields: [productId], references: [id], onDelete: Cascade)
  warehouse   Warehouse            @relation(fields: [warehouseId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([productId])
  @@index([warehouseId])
  @@map("stock_movements")
}

model TaskCategory {
  id          String   @id
  name        String
  description String?
  color       String   @default("#6366f1")
  icon        String?
  order       Int      @default(0)
  isActive    Boolean  @default(true)
  companyId   String
  createdAt   DateTime @default(now())
  updatedAt   DateTime
  companies   Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  tasks       Task[]

  @@unique([companyId, name])
  @@index([companyId])
  @@index([isActive])
  @@map("task_categories")
}

model Warehouse {
  id             String          @id
  name           String
  location       String?
  type           String          @default("main")
  capacity       Int?
  isActive       Boolean         @default(true)
  companyId      String
  createdAt      DateTime        @default(now())
  updatedAt      DateTime
  inventories    Inventory[]
  stockAlerts    StockAlert[]
  stockMovements StockMovement[]
  companies      Company         @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@map("warehouses")
}

model Wishlist {
  id         String   @id
  sessionId  String
  customerId String?
  productId  String
  variantId  String?
  companyId  String
  createdAt  DateTime @default(now())
  updatedAt  DateTime
  companies  Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  products   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([sessionId, productId, variantId, companyId])
  @@index([companyId])
  @@index([customerId])
  @@index([productId])
  @@index([sessionId])
  @@map("wishlists")
}

model WoocommerceSettings {
  id                  String    @id
  companyId           String    @unique
  storeUrl            String
  consumerKey         String    @db.Text
  consumerSecret      String    @db.Text
  syncEnabled         Boolean   @default(false)
  syncDirection       String    @default("both")
  syncInterval        Int       @default(15)
  webhookSecret       String?   @db.Text
  webhookEnabled      Boolean   @default(false)
  webhookOrderCreated String?
  webhookOrderUpdated String?
  statusMapping       String?   @db.Text
  lastSyncAt          DateTime?
  lastSyncStatus      String?   @default("never")
  lastSyncMessage     String?   @db.Text
  isActive            Boolean   @default(true)
  createdAt           DateTime  @default(now())
  updatedAt           DateTime
  companies           Company   @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@map("woocommerce_settings")
}

model WoocommerceSyncLog {
  id            String    @id
  companyId     String
  syncType      String
  syncDirection String
  status        String
  totalItems    Int       @default(0)
  successCount  Int       @default(0)
  failedCount   Int       @default(0)
  skippedCount  Int       @default(0)
  errorMessage  String?   @db.Text
  errorDetails  String?   @db.Text
  startedAt     DateTime  @default(now())
  completedAt   DateTime?
  duration      Int?
  triggeredBy   String?
  metadata      String?   @db.Text
  companies     Company   @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([startedAt])
  @@index([status])
  @@index([syncType])
  @@map("woocommerce_sync_logs")
}

model CustomerWallet {
  id          String   @id @default(cuid())
  customerId  String   @unique
  companyId   String
  balance     Float    @default(0)
  totalEarned Float    @default(0)
  totalSpent  Float    @default(0)
  currency    String   @default("EGP")
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  customer     Customer?           @relation(fields: [customerId], references: [id])
  company      Company             @relation(fields: [companyId], references: [id], onDelete: Cascade)
  transactions WalletTransaction[]

  @@index([companyId])
  @@map("customer_wallets")
}

model OrderStatusHistory {
  id           String      @id
  orderId      String?
  status       String
  oldStatus    String?
  changedBy    String?
  userName     String?
  reason       String?
  createdAt    DateTime    @default(now())
  guestOrderId String?
  guestOrder   GuestOrder? @relation(fields: [guestOrderId], references: [id], onDelete: Cascade)
  orders       Order?      @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@index([guestOrderId])
  @@index([orderId])
}

model CustomerLoyaltyProgram {
  id                      String                        @id
  companyId               String
  name                    String
  nameAr                  String?
  description             String?                       @db.Text
  type                    CustomerLoyaltyProgramType    @default(POINTS)
  status                  CustomerLoyaltyProgramsStatus @default(DRAFT)
  pointsPerPurchase       Decimal                       @default(1.00) @db.Decimal(10, 2)
  pointsPerReferral       Decimal                       @default(10.00) @db.Decimal(10, 2)
  pointsPerAmount         Decimal?                      @db.Decimal(10, 2)
  redemptionRate          Decimal                       @default(100.00) @db.Decimal(10, 2)
  minimumPoints           Decimal                       @default(100.00) @db.Decimal(10, 2)
  maxPointsPerTransaction Decimal?                      @db.Decimal(10, 2)
  expiryMonths            Int                           @default(12)
  rules                   String?                       @db.Text
  createdBy               String
  createdAt               DateTime                      @default(now())
  updatedAt               DateTime
  companies               Company                       @relation(fields: [companyId], references: [id], onDelete: Cascade)
  customerLoyaltyRecords  CustomerLoyaltyRecord[]
  customerLoyaltyTiers    CustomerLoyaltyTier[]

  @@index([companyId])
  @@index([status])
  @@index([type])
  @@map("customer_loyalty_programs")
}

model CustomerLoyaltyRecord {
  id                     String                       @id
  companyId              String
  customerId             String
  programId              String
  tierId                 String?
  currentPoints          Decimal                      @default(0.00) @db.Decimal(10, 2)
  totalEarned            Decimal                      @default(0.00) @db.Decimal(10, 2)
  totalRedeemed          Decimal                      @default(0.00) @db.Decimal(10, 2)
  status                 CustomerLoyaltyRecordsStatus @default(ACTIVE)
  joinDate               DateTime                     @default(now())
  lastActivity           DateTime                     @default(now())
  lastPointsEarned       DateTime?
  lastPointsRedeemed     DateTime?
  metadata               String?                      @db.Text
  createdAt              DateTime                     @default(now())
  updatedAt              DateTime
  companies              Company                      @relation(fields: [companyId], references: [id], onDelete: Cascade)
  customers              Customer                     @relation(fields: [customerId], references: [id], onDelete: Cascade)
  customerLoyaltyProgram CustomerLoyaltyProgram       @relation(fields: [programId], references: [id], onDelete: Cascade)
  customerLoyaltyTier    CustomerLoyaltyTier?         @relation(fields: [tierId], references: [id])

  @@unique([customerId, programId])
  @@index([companyId])
  @@index([customerId])
  @@index([lastActivity])
  @@index([programId])
  @@index([status])
  @@index([tierId])
  @@map("customer_loyalty_records")
}

model CustomerLoyaltyTier {
  id                     String                  @id
  companyId              String
  programId              String
  name                   String
  nameAr                 String?
  minPoints              Decimal                 @db.Decimal(10, 2)
  maxPoints              Decimal?                @db.Decimal(10, 2)
  benefits               String?                 @db.Text
  color                  String                  @default("#6366f1")
  icon                   String                  @default("crown")
  priority               Int                     @default(1)
  createdAt              DateTime                @default(now())
  updatedAt              DateTime
  customerLoyaltyRecords CustomerLoyaltyRecord[]
  companies              Company                 @relation(fields: [companyId], references: [id], onDelete: Cascade)
  customerLoyaltyProgram CustomerLoyaltyProgram  @relation(fields: [programId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([minPoints])
  @@index([programId])
  @@map("customer_loyalty_tiers")
}

model CustomerNotificationPreference {
  id            String    @id
  companyId     String
  customerId    String    @unique
  phone         String
  orderUpdates  Boolean   @default(true)
  promotions    Boolean   @default(false)
  backInStock   Boolean   @default(true)
  priceDrops    Boolean   @default(true)
  abandonedCart Boolean   @default(true)
  isOptedIn     Boolean   @default(true)
  optedInAt     DateTime  @default(now())
  optedOutAt    DateTime?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime
  companies     Company   @relation(fields: [companyId], references: [id], onDelete: Cascade)
  customers     Customer  @relation(fields: [customerId], references: [id], onDelete: Cascade)

  @@unique([companyId, customerId])
  @@unique([companyId, phone])
  @@map("customer_notification_preferences")
}

model MerchantOrder {
  id              String               @id
  merchantId      String
  orderId         String               @unique
  merchantOrderId String?
  status          MerchantOrdersStatus @default(PENDING)
  items           String               @db.Text
  totalAmount     Decimal              @db.Decimal(10, 2)
  shippingAddress String?              @db.Text
  trackingNumber  String?
  syncedAt        DateTime?
  fulfilledAt     DateTime?
  notes           String?              @db.Text
  createdAt       DateTime             @default(now())
  updatedAt       DateTime
  merchants       Merchant             @relation(fields: [merchantId], references: [id], onDelete: Cascade)
  orders          Order                @relation("OrderMerchantOrder", references: [id], onDelete: Cascade, fields: [orderId])

  @@index([merchantId])
  @@index([orderId])
  @@index([status])
  @@map("merchant_orders")
}

model MerchantProduct {
  id            String    @id
  merchantId    String
  productId     String
  merchantSku   String?
  merchantPrice Decimal   @db.Decimal(10, 2)
  stock         Int       @default(0)
  isActive      Boolean   @default(true)
  syncEnabled   Boolean   @default(true)
  lastSyncedAt  DateTime?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime
  merchants     Merchant  @relation(fields: [merchantId], references: [id], onDelete: Cascade)
  products      Product   @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([merchantId, productId])
  @@index([merchantId])
  @@index([productId])
  @@map("merchant_products")
}

model Merchant {
  id               String            @id
  companyId        String
  name             String
  email            String            @unique
  phone            String?
  address          String?           @db.Text
  isActive         Boolean           @default(true)
  commissionRate   Float             @default(10)
  autoFulfill      Boolean           @default(false)
  apiKey           String?           @unique
  webhookUrl       String?
  settings         String?           @db.Text
  createdAt        DateTime          @default(now())
  updatedAt        DateTime
  commissions      Commission[]
  merchantOrders   MerchantOrder[]
  merchantProducts MerchantProduct[]
  companies        Company           @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([isActive])
}

model OrderInvoiceSettings {
  id                     String   @id
  companyId              String   @unique
  autoGenerate           Boolean  @default(false)
  autoGenerateOnStatus   String?
  invoicePrefix          String   @default("INV")
  invoiceNumberFormat    String   @default("INV-YYYYMMDD-XXXXXX")
  nextInvoiceNumber      Int      @default(1)
  defaultTaxRate         Float    @default(0)
  defaultTerms           String?  @db.Text
  defaultNotes           String?  @db.Text
  defaultDueDays         Int      @default(7)
  showCompanyLogo        Boolean  @default(true)
  showTaxBreakdown       Boolean  @default(true)
  showPaymentMethod      Boolean  @default(true)
  showOrderItems         Boolean  @default(true)
  autoEmailToCustomer    Boolean  @default(false)
  emailSubject           String?
  emailBody              String?  @db.Text
  pdfPageSize            String   @default("A4")
  pdfOrientation         String   @default("portrait")
  primaryColor           String   @default("#4F46E5")
  secondaryColor         String   @default("#6B7280")
  fontFamily             String   @default("Arial")
  createdAt              DateTime @default(now())
  updatedAt              DateTime
  enableSequentialOrders Boolean  @default(false)
  nextOrderNumber        Int      @default(1)
  orderNumberFormat      String   @default("PREFIX-XXXXXX")
  orderPrefix            String   @default("ORD")
  companies              Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@map("order_invoice_settings")
}

model OrderInvoice {
  id              String    @id
  invoiceNumber   String    @unique
  orderId         String    @unique
  companyId       String
  issueDate       DateTime  @default(now())
  dueDate         DateTime?
  subtotal        Decimal   @db.Decimal(10, 2)
  tax             Decimal   @default(0.00) @db.Decimal(10, 2)
  taxRate         Float     @default(0)
  shipping        Decimal   @default(0.00) @db.Decimal(10, 2)
  discount        Decimal   @default(0.00) @db.Decimal(10, 2)
  totalAmount     Decimal   @db.Decimal(10, 2)
  currency        String    @default("EGP")
  customerName    String
  customerPhone   String?
  customerEmail   String?
  customerAddress String?   @db.Text
  city            String?
  governorate     String?
  companyName     String
  companyPhone    String?
  companyEmail    String?
  companyAddress  String?   @db.Text
  companyLogo     String?
  paymentMethod   String?
  paymentStatus   String    @default("PENDING")
  paidAt          DateTime?
  notes           String?   @db.Text
  terms           String?   @db.Text
  generatedBy     String?
  printedAt       DateTime?
  printCount      Int       @default(0)
  emailedAt       DateTime?
  emailCount      Int       @default(0)
  createdAt       DateTime  @default(now())
  updatedAt       DateTime
  orders          Order     @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([invoiceNumber])
  @@index([issueDate])
  @@index([orderId])
  @@index([paymentStatus])
  @@map("order_invoices")
}

model ProductVisit {
  id          String   @id @default(cuid())
  productId   String
  companyId   String
  sessionId   String
  visitedAt   DateTime @default(now())
  duration    Int?
  source      String?
  addedToCart Boolean  @default(false)
  purchased   Boolean  @default(false)
  product     Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  company     Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId, productId, visitedAt])
  @@index([sessionId, companyId])
  @@map("product_visits")
}

model PurchaseInvoiceItem {
  id                String          @id
  purchaseInvoiceId String
  productId         String?
  productName       String
  description       String?         @db.Text
  quantity          Decimal         @db.Decimal(10, 2)
  unitPrice         Decimal         @db.Decimal(12, 2)
  taxRate           Decimal         @default(0.00) @db.Decimal(5, 2)
  discountRate      Decimal         @default(0.00) @db.Decimal(5, 2)
  totalPrice        Decimal         @db.Decimal(12, 2)
  notes             String?         @db.Text
  createdAt         DateTime        @default(now())
  updatedAt         DateTime
  products          Product?        @relation(fields: [productId], references: [id])
  purchaseInvoice   PurchaseInvoice @relation(fields: [purchaseInvoiceId], references: [id], onDelete: Cascade)

  @@index([productId])
  @@index([purchaseInvoiceId])
  @@map("purchase_invoice_items")
}

model PurchaseInvoice {
  id                   String                 @id
  companyId            String
  supplierId           String
  purchaseOrderId      String?
  invoiceNumber        String                 @unique
  invoiceDate          DateTime               @default(now())
  dueDate              DateTime?
  status               PurchaseInvoicesStatus @default(PENDING)
  subtotal             Decimal                @db.Decimal(12, 2)
  taxAmount            Decimal                @default(0.00) @db.Decimal(12, 2)
  discountAmount       Decimal                @default(0.00) @db.Decimal(12, 2)
  shippingCost         Decimal                @default(0.00) @db.Decimal(12, 2)
  totalAmount          Decimal                @db.Decimal(12, 2)
  paidAmount           Decimal                @default(0.00) @db.Decimal(12, 2)
  remainingAmount      Decimal                @db.Decimal(12, 2)
  currency             String                 @default("EGP")
  notes                String?                @db.Text
  attachments          String?                @db.Text
  createdBy            String
  createdAt            DateTime               @default(now())
  updatedAt            DateTime
  purchaseInvoiceItems PurchaseInvoiceItem[]
  companies            Company                @relation(fields: [companyId], references: [id], onDelete: Cascade)
  purchaseOrder        PurchaseOrder?         @relation(fields: [purchaseOrderId], references: [id])
  supplier             Supplier               @relation(fields: [supplierId], references: [id])
  supplierPayments     SupplierPayment[]

  @@index([companyId])
  @@index([invoiceDate])
  @@index([purchaseOrderId])
  @@index([status])
  @@index([supplierId])
  @@map("purchase_invoices")
}

model PurchaseOrderItem {
  id               String        @id
  purchaseOrderId  String
  productId        String?
  productName      String
  description      String?       @db.Text
  quantity         Decimal       @db.Decimal(10, 2)
  unitPrice        Decimal       @db.Decimal(12, 2)
  taxRate          Decimal       @default(0.00) @db.Decimal(5, 2)
  discountRate     Decimal       @default(0.00) @db.Decimal(5, 2)
  totalPrice       Decimal       @db.Decimal(12, 2)
  receivedQuantity Decimal       @default(0.00) @db.Decimal(10, 2)
  notes            String?       @db.Text
  createdAt        DateTime      @default(now())
  updatedAt        DateTime
  products         Product?      @relation(fields: [productId], references: [id])
  purchaseOrder    PurchaseOrder @relation(fields: [purchaseOrderId], references: [id], onDelete: Cascade)

  @@index([productId])
  @@index([purchaseOrderId])
  @@map("purchase_order_items")
}

model PurchaseOrder {
  id                 String               @id
  companyId          String
  supplierId         String
  orderNumber        String               @unique
  orderDate          DateTime             @default(now())
  expectedDelivery   DateTime?
  status             PurchaseOrdersStatus @default(DRAFT)
  subtotal           Decimal              @db.Decimal(12, 2)
  taxAmount          Decimal              @default(0.00) @db.Decimal(12, 2)
  discountAmount     Decimal              @default(0.00) @db.Decimal(12, 2)
  shippingCost       Decimal              @default(0.00) @db.Decimal(12, 2)
  totalAmount        Decimal              @db.Decimal(12, 2)
  currency           String               @default("EGP")
  paymentTerms       String?              @db.Text
  notes              String?              @db.Text
  attachments        String?              @db.Text
  receivedDate       DateTime?
  approvedBy         String?
  approvedAt         DateTime?
  createdBy          String
  createdAt          DateTime             @default(now())
  updatedAt          DateTime
  purchaseInvoices   PurchaseInvoice[]
  purchaseOrderItems PurchaseOrderItem[]
  companies          Company              @relation(fields: [companyId], references: [id], onDelete: Cascade)
  supplier           Supplier             @relation(fields: [supplierId], references: [id])

  @@index([companyId])
  @@index([orderDate])
  @@index([status])
  @@index([supplierId])
  @@map("purchase_orders")
}

model ReturnReasonCategory {
  id            String                            @id
  name          String
  defaultRole   ReturnReasonCategoriesDefaultRole @default(OTHER)
  isActive      Boolean                           @default(true)
  createdAt     DateTime                          @default(now())
  updatedAt     DateTime
  companyId     String
  companies     Company                           @relation(fields: [companyId], references: [id], onDelete: Cascade)
  returnReasons ReturnReason[]

  @@index([companyId])
  @@map("return_reason_categories")
}

model ShippingMethod {
  id           String       @id
  zoneId       String
  type         String       @default("flat_rate")
  title        String
  isEnabled    Boolean      @default(true)
  settings     String?      @db.LongText
  sortOrder    Int          @default(0)
  createdAt    DateTime     @default(now())
  updatedAt    DateTime
  shippingZone ShippingZone @relation(fields: [zoneId], references: [id], onDelete: Cascade)

  @@index([isEnabled])
  @@index([zoneId])
  @@map("shipping_methods")
}

model SupplierPayment {
  id                String                        @id
  companyId         String
  supplierId        String
  purchaseInvoiceId String?
  paymentNumber     String                        @unique
  paymentDate       DateTime                      @default(now())
  amount            Decimal                       @db.Decimal(12, 2)
  paymentMethod     SupplierPaymentsPaymentMethod
  referenceNumber   String?
  bankName          String?
  checkNumber       String?
  checkDate         DateTime?
  notes             String?                       @db.Text
  attachments       String?                       @db.Text
  createdBy         String
  createdAt         DateTime                      @default(now())
  updatedAt         DateTime
  companies         Company                       @relation(fields: [companyId], references: [id], onDelete: Cascade)
  purchaseInvoice   PurchaseInvoice?              @relation(fields: [purchaseInvoiceId], references: [id])
  supplier          Supplier                      @relation(fields: [supplierId], references: [id])

  @@index([companyId])
  @@index([paymentDate])
  @@index([purchaseInvoiceId])
  @@index([supplierId])
  @@map("supplier_payments")
}

model Supplier {
  id                 String            @id
  companyId          String
  name               String
  contactPerson      String?
  email              String?
  phone              String?
  mobile             String?
  address            String?           @db.Text
  city               String?
  country            String?           @default("Egypt")
  taxNumber          String?
  commercialRegister String?
  paymentTerms       String?           @db.Text
  creditLimit        Decimal?          @db.Decimal(12, 2)
  currentBalance     Decimal           @default(0.00) @db.Decimal(12, 2)
  rating             Int?              @default(0)
  notes              String?           @db.Text
  isActive           Boolean           @default(true)
  createdAt          DateTime          @default(now())
  updatedAt          DateTime
  createdBy          String?
  purchaseInvoices   PurchaseInvoice[]
  purchaseOrders     PurchaseOrder[]
  supplierPayments   SupplierPayment[]
  companies          Company           @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([isActive])
  @@map("suppliers")
}

enum InvitationStatus {
  PENDING
  ACCEPTED
  EXPIRED
  CANCELLED
}

enum TaskStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum TaskPriority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum ProjectStatus {
  PLANNING
  ACTIVE
  COMPLETED
  ON_HOLD
}

enum UserRole {
  SUPER_ADMIN
  COMPANY_ADMIN
  MANAGER
  AGENT
}

enum SubscriptionPlan {
  BASIC
  PRO
  ENTERPRISE
}

enum SubscriptionStatus {
  ACTIVE
  INACTIVE
  CANCELLED
  EXPIRED
  TRIAL
  SUSPENDED
}

enum AIKeyType {
  COMPANY
  CENTRAL
}

enum InvoiceStatus {
  DRAFT
  SENT
  PAID
  OVERDUE
  CANCELLED
  REFUNDED
}

enum InvoiceType {
  SUBSCRIPTION
  ONE_TIME

  @@map("InvoiceType")
}

enum CustomerStatus {
  LEAD
  PROSPECT
  CUSTOMER
  VIP
  INACTIVE
}

enum CommunicationChannel {
  FACEBOOK
  WHATSAPP
  TELEGRAM
  EMAIL
  SMS
  PHONE
  WEBSITE
  TEST
}

enum ConversationStatus {
  ACTIVE
  PENDING
  RESOLVED
  CLOSED
}

enum MessageType {
  TEXT
  IMAGE
  VIDEO
  AUDIO
  FILE
  LOCATION
  STICKER
  EMOJI
  TEMPLATE

  @@map("MessageType")
}

enum OrderStatus {
  PENDING
  CONFIRMED
  PROCESSING
  SHIPPED
  DELIVERED
  CANCELLED
  REFUNDED
}

enum PaymentStatus {
  PENDING
  COMPLETED
  FAILED
  REFUNDED
}

enum PaymentMethod {
  CASH
  CREDIT_CARD
  BANK_TRANSFER
  PAYPAL
  STRIPE
}

enum StockMovementType {
  IN
  OUT
  ADJUSTMENT
  TRANSFER
  RETURN

  @@map("StockMovementType")
}

enum StockMovementReason {
  PURCHASE
  SALE
  DAMAGE
  EXPIRED
  LOST
  FOUND
  TRANSFER
  RETURN
  ADJUSTMENT
}

enum AlertPriority {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

enum GlobalAiProvider {
  GOOGLE
  DEEPSEEK
  OPENAI
  ANTHROPIC
  HUGGINGFACE
  OLLAMA
}

enum StockAlertType {
  LOW_STOCK
  OUT_OF_STOCK
  OVERSTOCK
  EXPIRY_WARNING

  @@map("StockAlertType")
}

enum AiKeyProvider {
  GOOGLE
  DEEPSEEK
  OPENAI
  ANTHROPIC
  HUGGINGFACE
  OLLAMA
}

enum SubscriptionPlanType {
  BASIC
  PRO
  ENTERPRISE
}

enum StockAlertPriority {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

enum HrLeaveRequestType {
  ANNUAL
  SICK
  UNPAID
  MATERNITY
  PATERNITY
  BEREAVEMENT
  MARRIAGE
  HAJJ
  STUDY
  EMERGENCY
  OTHER

  @@map("HrLeaveRequestType")
}

enum DevTaskType {
  BUG
  FEATURE
  ENHANCEMENT
  DOCUMENTATION
  SECURITY
  PERFORMANCE
  TESTING
  REFACTOR
  MAINTENANCE
  HOTFIX

  @@map("DevTaskType")
}

enum HrEmployeeWarningType {
  VERBAL
  WRITTEN
  FINAL
  TERMINATION

  @@map("HrEmployeeWarningType")
}

enum TaskTemplateStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum DevProjectStatus {
  PLANNING
  ACTIVE
  ON_HOLD
  COMPLETED
  CANCELLED
}

enum UsercompanyRole {
  SUPER_ADMIN
  COMPANY_ADMIN
  MANAGER
  AGENT
}

enum DevTaskStatus {
  BACKLOG
  TODO
  IN_PROGRESS
  IN_REVIEW
  TESTING
  DONE
  CANCELLED
}

enum TaskTemplatePriority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum DevReleaseStatus {
  PLANNING
  IN_PROGRESS
  READY
  RELEASED
  CANCELLED
}

enum WhatsAppSessionStatus {
  CONNECTED
  DISCONNECTED
  QR_PENDING
  CONNECTING
  LOGGED_OUT
}

enum DevProjectsPriority {
  CRITICAL
  HIGH
  MEDIUM
  LOW

  @@map("dev_projects_priority")
}

enum WhatsAppStatusType {
  TEXT
  IMAGE
  VIDEO
  AUDIO
  DOCUMENT
  STICKER
  LOCATION
  CONTACT
  POLL
  PRODUCT
  ORDER
  CATALOG
  INTERACTIVE
  BUTTON_REPLY
  LIST_REPLY
  TEMPLATE

  @@map("WhatsAppStatusType")
}

enum ProjectPriority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum ReturnStatus {
  PENDING
  APPROVED
  REJECTED
  COMPLETED
}

enum DevTaskPriority {
  CRITICAL
  HIGH
  MEDIUM
  LOW
}

enum StorePageType {
  SHIPPING_POLICY
  RETURN_POLICY
  REFUND_POLICY
  PRIVACY_POLICY
  TERMS_CONDITIONS
  ABOUT_US
  CONTACT_US
  FAQ
  PAYMENT_METHODS
  CUSTOM
}

enum SupportTicketStatus {
  OPEN
  IN_PROGRESS
  RESOLVED
  CLOSED
}

enum WhatsAppMessageType {
  TEXT
  IMAGE
  VIDEO
  AUDIO
  DOCUMENT
  STICKER
  LOCATION
  CONTACT
  REACTION
  POLL
  TEMPLATE
  BUTTONS
  LIST
  PRODUCT
  INTERACTIVE
}

enum CouponType {
  PERCENTAGE
  FIXED_AMOUNT
  FREE_SHIPPING

  @@map("CouponType")
}

enum AiKeyType {
  COMPANY
  CENTRAL
}

enum CompaniesPlan {
  BASIC
  PRO
  ENTERPRISE

  @@map("companies_plan")
}

enum LeaveStatus {
  PENDING
  APPROVED
  REJECTED
  CANCELLED
}

enum TrainingStatus {
  PLANNED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum Gender {
  MALE
  FEMALE
}

enum SupportPriority {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

enum WhatsAppMessagesStatus {
  PENDING
  SENT
  DELIVERED
  READ
  FAILED

  @@map("whatsapp_messages_status")
}

enum AttendanceStatus {
  PRESENT
  ABSENT
  LATE
  HALF_DAY
  ON_LEAVE
  HOLIDAY
  WEEKEND
  REMOTE
}

enum CustomerRating {
  EXCELLENT
  GOOD
  AVERAGE
  BAD
  UNKNOWN
}

enum ReviewStatus {
  DRAFT
  SUBMITTED
  ACKNOWLEDGED
  COMPLETED
}

enum MaritalStatus {
  SINGLE
  MARRIED
  DIVORCED
  WIDOWED
}

enum PayrollStatus {
  DRAFT
  PENDING_APPROVAL
  APPROVED
  PAID
  CANCELLED
}

enum ContractType {
  FULL_TIME
  PART_TIME
  CONTRACT
  TEMPORARY
  INTERNSHIP
  FREELANCE
}

enum EmployeeStatus {
  ACTIVE
  ON_HOLD
  COMPLETED
  CANCELLED
  ON_LEAVE
  SUSPENDED
  TERMINATED
  RESIGNED
}

enum WarningType {
  VERBAL
  WRITTEN
  FINAL
  TERMINATION
}

enum SupportCategory {
  INQUIRY
  TECHNICAL
  BILLING
  OTHER
}

enum LeaveType {
  ANNUAL
  SICK
  UNPAID
  MATERNITY
  PATERNITY
  OTHER
}

enum WalletTransactionType {
  CREDIT
  DEBIT
  CASHBACK
  REFUND
  REFERRAL_BONUS
  REWARD
  ADMIN_ADJUSTMENT
}

enum GlobalAiConfigsDefaultProvider {
  GOOGLE
  DEEPSEEK
  OPENAI
  ANTHROPIC
  HUGGINGFACE
  OLLAMA

  @@map("global_ai_configs_defaultProvider")
}

enum AiKeysProvider {
  GOOGLE
  DEEPSEEK
  OPENAI
  ANTHROPIC
  HUGGINGFACE
  OLLAMA

  @@map("ai_keys_provider")
}

enum SubscriptionsPlanType {
  BASIC
  PRO
  ENTERPRISE

  @@map("subscriptions_planType")
}

enum ReturnReasonCategoriesDefaultRole {
  CUSTOMER
  STORE
  SHIPPING
  OTHER

  @@map("return_reason_categories_defaultRole")
}

enum StockAlertsPriority {
  LOW
  MEDIUM
  HIGH
  CRITICAL

  @@map("stock_alerts_priority")
}

enum WhatsAppNotificationTemplatesCategory {
  ORDERS
  PRODUCTS
  MARKETING
  ABANDONED_CART
  HR
  SYSTEM

  @@map("whatsapp_notification_templates_category")
}

enum TaskTemplatesDefaultStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  CANCELLED

  @@map("task_templates_defaultStatus")
}

enum SubscriptionsStatus {
  ACTIVE
  INACTIVE
  CANCELLED
  EXPIRED
  TRIAL
  SUSPENDED

  @@map("subscriptions_status")
}

enum HrManualDeductionType {
  PENALTY
  VIOLATION
  DAMAGE
  INSURANCE
  LOAN_REPAYMENT
  ADVANCE_REPAYMENT
  TAX
  SOCIAL_INSURANCE
  ABSENCE
  LATE
  EARLY_LEAVE
  OTHER

  @@map("HrManualDeductionType")
}

enum ConversationsChannel {
  FACEBOOK
  WHATSAPP
  TELEGRAM
  EMAIL
  SMS
  PHONE
  WEBSITE
  TEST

  @@map("conversations_channel")
}

enum DevProjectsStatus {
  PLANNING
  ACTIVE
  ON_HOLD
  COMPLETED
  CANCELLED

  @@map("dev_projects_status")
}

enum ProjectsStatus {
  PLANNING
  ACTIVE
  COMPLETED
  ON_HOLD

  @@map("projects_status")
}

enum UserCompaniesRole {
  OWNER
  SUPER_ADMIN
  COMPANY_ADMIN
  MANAGER
  AGENT
  AFFILIATE

  @@map("user_companies_role")
}

enum WhatsAppNotificationTemplatesEventType {
  ORDER_CREATED
  ORDER_CONFIRMED
  ORDER_PROCESSING
  ORDER_SHIPPED
  ORDER_OUT_FOR_DELIVERY
  ORDER_DELIVERED
  ORDER_CANCELLED
  ORDER_REFUNDED
  PAYMENT_REMINDER
  PAYMENT_RECEIVED
  BACK_IN_STOCK
  PRICE_DROP
  NEW_PRODUCT
  LOW_STOCK_ALERT
  CART_ABANDONED_1H
  CART_ABANDONED_24H
  CART_ABANDONED_72H
  CART_ABANDONED_WITH_DISCOUNT
  PROMOTIONAL
  COUPON_SENT
  BIRTHDAY_WISH
  LOYALTY_POINTS
  LOYALTY_REWARD
  REVIEW_REQUEST
  ATTENDANCE_REMINDER
  ATTENDANCE_CONFIRMED
  ATTENDANCE_LATE
  ATTENDANCE_LATE_WITH_DEDUCTION
  CHECKOUT_CONFIRMED
  LEAVE_APPROVED
  LEAVE_REJECTED
  PAYROLL_READY
  BIRTHDAY_EMPLOYEE
  WARNING_ISSUED
  CONTRACT_EXPIRY
  TRAINING_REMINDER
  ANNOUNCEMENT

  @@map("whatsapp_notification_templates_eventType")
}

enum TasksStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  CANCELLED

  @@map("tasks_status")
}

enum DevTasksStatus {
  BACKLOG
  TODO
  IN_PROGRESS
  IN_REVIEW
  TESTING
  DONE
  CANCELLED

  @@map("dev_tasks_status")
}

enum StockMovementsReason {
  PURCHASE
  SALE
  DAMAGE
  EXPIRED
  LOST
  FOUND
  TRANSFER
  RETURN
  ADJUSTMENT

  @@map("stock_movements_reason")
}

enum InvoicesStatus {
  DRAFT
  SENT
  PAID
  OVERDUE
  CANCELLED
  REFUNDED

  @@map("invoices_status")
}

enum MerchantOrdersStatus {
  PENDING
  SENT
  CONFIRMED
  FULFILLED
  CANCELLED
  FAILED

  @@map("merchant_orders_status")
}

enum AffiliatesCommissionType {
  PERCENTAGE
  MARKUP

  @@map("affiliates_commissionType")
}

enum TaskTemplatesDefaultPriority {
  LOW
  MEDIUM
  HIGH
  URGENT

  @@map("task_templates_defaultPriority")
}

enum SupportTicketCategory {
  INQUIRY
  TECHNICAL
  BILLING
  OTHER

  @@map("SupportTicket_category")
}

enum DevReleasesStatus {
  PLANNING
  IN_PROGRESS
  READY
  RELEASED
  CANCELLED

  @@map("dev_releases_status")
}

enum OrdersStatus {
  PENDING
  CONFIRMED
  SCHEDULED
  READY_FOR_PROCESSING
  PROCESSING
  SHIPPED
  DELIVERED
  CANCELLED
  REFUNDED
  RETURNED
  PARTIALLY_REFUNDED
  WOO_TAGHEZ
  DRAFT

  @@map("orders_status")
}

enum WhatsAppSessionsStatus {
  CONNECTED
  DISCONNECTED
  QR_PENDING
  CONNECTING
  LOGGED_OUT

  @@map("whatsapp_sessions_status")
}

enum ConversationsStatus {
  ACTIVE
  PENDING
  RESOLVED
  CLOSED

  @@map("conversations_status")
}

enum ProjectsPriority {
  LOW
  MEDIUM
  HIGH
  URGENT

  @@map("projects_priority")
}

enum ReturnRole {
  CUSTOMER
  STORE
  SHIPPING
  OTHER
}

enum PromotionStatus {
  PENDING
  APPROVED
  REJECTED
  COMPLETED
}

enum DeductionType {
  PENALTY // 
  VIOLATION // 
  DAMAGE //   
  INSURANCE // 
  LOAN_REPAYMENT //  
  ADVANCE_REPAYMENT //  
  TAX // 
  SOCIAL_INSURANCE //  
  ABSENCE // 
  LATE // 
  EARLY_LEAVE //  
  OTHER // 
}

enum DeductionStatus {
  PENDING //   
  APPROVED //  
  REJECTED // 
  APPLIED //    
  CANCELLED // 
}

enum AssetStatus {
  AVAILABLE
  IN_USE
  MAINTENANCE
  RETIRED
  LOST
  RESERVED
}

enum AssetCondition {
  NEW
  GOOD
  FAIR
  POOR
  DAMAGED
}

enum AssetRequestStatus {
  PENDING
  APPROVED
  REJECTED
  FULFILLED
  CANCELLED
}

enum AffiliatesStatus {
  PENDING
  ACTIVE
  INACTIVE
  SUSPENDED

  @@map("affiliates_status")
}

enum AffiliatesPaymentMethod {
  TRANSFERS
  WALLET
  CASH

  @@map("affiliates_paymentMethod")
}

enum SupportTicketPriority {
  LOW
  MEDIUM
  HIGH
  URGENT

  @@map("SupportTicket_priority")
}

enum AiKeysKeyType {
  COMPANY
  CENTRAL

  @@map("ai_keys_keyType")
}

enum AssetsStatus {
  AVAILABLE
  ASSIGNED
  MAINTENANCE
  DAMAGED
  LOST
  DISPOSED

  @@map("assets_status")
}

enum AssetsCondition {
  NEW
  GOOD
  FAIR
  POOR
  BROKEN

  @@map("assets_condition")
}

enum WhatsAppNotificationQueueStatus {
  PENDING
  PROCESSING
  SENT
  FAILED
  CANCELLED

  @@map("whatsapp_notification_queue_status")
}

enum WhatsAppNotificationLogsStatus {
  PENDING
  SENT
  DELIVERED
  READ
  FAILED

  @@map("whatsapp_notification_logs_status")
}

enum WhatsAppNotificationLogsRecipientType {
  CUSTOMER
  EMPLOYEE
  ADMIN

  @@map("whatsapp_notification_logs_recipientType")
}

enum WhatsAppNotificationLogsCategory {
  ORDER
  MARKETING
  HR
  SYSTEM

  @@map("whatsapp_notification_logs_category")
}

enum WhatsAppNotificationLogsEventType {
  ORDER_CREATED
  ORDER_CONFIRMED
  ORDER_SHIPPED
  ORDER_DELIVERED
  ORDER_CANCELLED
  PAYMENT_REMINDER
  BACK_IN_STOCK
  PROMOTIONAL
  OTP

  @@map("whatsapp_notification_logs_eventType")
}

enum WhatsAppNotificationQueueRecipientType {
  CUSTOMER
  EMPLOYEE
  ADMIN

  @@map("whatsapp_notification_queue_recipientType")
}

enum WhatsAppNotificationQueueCategory {
  ORDER
  MARKETING
  HR
  SYSTEM

  @@map("whatsapp_notification_queue_category")
}

enum WhatsAppNotificationQueueEventType {
  ORDER_CREATED
  ORDER_CONFIRMED
  ORDER_SHIPPED
  ORDER_DELIVERED
  ORDER_CANCELLED
  PAYMENT_REMINDER
  BACK_IN_STOCK
  PROMOTIONAL
  OTP

  @@map("whatsapp_notification_queue_eventType")
}

enum AffiliatePayoutsStatus {
  PENDING
  PROCESSED
  FAILED
  CANCELLED

  @@map("affiliate_payouts_status")
}

enum AffiliatePayoutsPaymentMethod {
  TRANSFERS
  WALLET
  CASH

  @@map("affiliate_payouts_paymentMethod")
}

enum AssetAssignmentsReturnCondition {
  NEW
  GOOD
  FAIR
  POOR
  BROKEN

  @@map("asset_assignments_returnCondition")
}

enum AssetAssignmentsConditionOnAssign {
  NEW
  GOOD
  FAIR
  POOR
  BROKEN

  @@map("asset_assignments_conditionOnAssign")
}

enum AssetAssignmentsStatus {
  ACTIVE
  RETURNED
  LOST
  DAMAGED

  @@map("asset_assignments_status")
}

enum CommissionType {
  SALE
  RECURRING
  BONUS

  @@map("CommissionType")
}

enum CommissionsCalculationType {
  PERCENTAGE
  FIXED

  @@map("commissions_calculationType")
}

enum CommissionsStatus {
  PENDING
  CONFIRMED
  PAID
  CANCELLED

  @@map("commissions_status")
}

enum CustomerLoyaltyProgramType {
  POINTS
  TIERS
  CASHBACK

  @@map("CustomerLoyaltyProgramType")
}

enum CustomerLoyaltyProgramsStatus {
  DRAFT
  ACTIVE
  INACTIVE

  @@map("customer_loyalty_programs_status")
}

enum CustomerLoyaltyRecordsStatus {
  ACTIVE
  EXPIRED
  CANCELLED

  @@map("customer_loyalty_records_status")
}

enum CustomersStatus {
  LEAD
  ACTIVE
  INACTIVE
  BLOCKED

  @@map("customers_status")
}

enum CustomersCustomerRating {
  EXCELLENT
  GOOD
  AVERAGE
  POOR
  UNKNOWN

  @@map("customers_customerRating")
}

enum DevTasksPriority {
  LOW
  MEDIUM
  HIGH
  URGENT

  @@map("dev_tasks_priority")
}

enum HrAttendanceStatus {
  PRESENT
  ABSENT
  LATE
  EARLY_LEAVE

  @@map("hr_attendance_status")
}

enum HrEmployeeTrainingStatus {
  PLANNED
  ONGOING
  COMPLETED
  CANCELLED

  @@map("hr_employee_training_status")
}

enum HrLeaveRequestsStatus {
  PENDING
  APPROVED
  REJECTED
  CANCELLED

  @@map("hr_leave_requests_status")
}

enum HrManualDeductionsStatus {
  PENDING
  APPROVED
  REJECTED

  @@map("hr_manual_deductions_status")
}

enum HrPayrollStatus {
  DRAFT
  PENDING
  PROCESSED
  PAID

  @@map("hr_payroll_status")
}

enum HrPerformanceReviewsStatus {
  DRAFT
  SUBMITTED
  REVIEWED
  COMPLETED

  @@map("hr_performance_reviews_status")
}

enum HrPromotionsStatus {
  PENDING
  APPROVED
  REJECTED

  @@map("hr_promotions_status")
}

enum HrRewardRecordsRewardCategory {
  PERFORMANCE
  ATTENDANCE
  SERVICE_ANNIVERSARY
  OTHER

  @@map("hr_reward_records_rewardCategory")
}

enum HrRewardRecordsStatus {
  PENDING
  APPROVED
  GIVEN
  CANCELLED

  @@map("hr_reward_records_status")
}

enum HrRewardTypesCategory {
  FINANCIAL
  NON_FINANCIAL

  @@map("hr_reward_types_category")
}

enum HrRewardTypesCalculationMethod {
  FIXED
  PERCENTAGE

  @@map("hr_reward_types_calculationMethod")
}

enum HrRewardTypesTriggerType {
  MANUAL
  AUTOMATIC

  @@map("hr_reward_types_triggerType")
}

enum HrRewardTypesFrequency {
  ONCE
  MONTHLY
  QUARTERLY
  YEARLY

  @@map("hr_reward_types_frequency")
}

enum OrdersPaymentStatus {
  PENDING
  PAID
  PARTIALLY_PAID
  FAILED
  REFUNDED

  @@map("orders_paymentStatus")
}

enum OrdersPaymentMethod {
  CASH
  BANK_TRANSFER
  ONLINE_PAYMENT
  WALLET

  @@map("orders_paymentMethod")
}

enum OrdersOrderSource {
  REGULAR
  DROP_SHIPPING
  POS
  MOBILE

  @@map("orders_orderSource")
}

enum PaymentsStatus {
  PENDING
  COMPLETED
  FAILED
  REFUNDED

  @@map("payments_status")
}

enum PaymentsMethod {
  BANK_TRANSFER
  CASH
  ONLINE
  WALLET

  @@map("payments_method")
}

enum PurchaseInvoicesStatus {
  PENDING
  PAID
  CANCELLED

  @@map("purchase_invoices_status")
}

enum PurchaseOrdersStatus {
  DRAFT
  PENDING
  ORDERED
  RECEIVED
  CANCELLED

  @@map("purchase_orders_status")
}

enum ReturnRequestsStatus {
  PENDING
  APPROVED
  REJECTED
  COMPLETED

  @@map("return_requests_status")
}

enum ReturnRequestsResponsibleParty {
  CUSTOMER
  STORE
  SHIPPING
  OTHER

  @@map("return_requests_responsibleParty")
}

enum StorePagesPageType {
  HOME
  ABOUT
  CONTACT
  CUSTOM

  @@map("store_pages_pageType")
}

enum SupplierPaymentsPaymentMethod {
  CASH
  BANK_TRANSFER
  CHEQUE

  @@map("supplier_payments_paymentMethod")
}

enum TasksPriority {
  LOW
  MEDIUM
  HIGH
  URGENT

  @@map("tasks_priority")
}

enum UserInvitationsStatus {
  PENDING
  ACCEPTED
  EXPIRED

  @@map("user_invitations_status")
}

enum UsersContractType {
  FULL_TIME
  PART_TIME
  CONTRACTOR
  INTERN

  @@map("users_contractType")
}

enum WhatsAppMessagesMessageType {
  TEXT
  IMAGE
  VIDEO
  DOCUMENT
  AUDIO
  LOCATION

  @@map("whatsapp_messages_messageType")
}

enum OrderSource {
  REGULAR
  AFFILIATE_REFERRAL
  AFFILIATE_DIRECT
}

model HrDepartment {
  id                   String         @id
  companyId            String
  name                 String
  nameEn               String?
  code                 String?
  description          String?        @db.Text
  managerId            String?
  parentId             String?
  color                String?        @default("#3B82F6")
  icon                 String?
  isActive             Boolean        @default(true)
  sortOrder            Int            @default(0)
  createdAt            DateTime       @default(now())
  updatedAt            DateTime
  companies            Company        @relation(fields: [companyId], references: [id], onDelete: Cascade)
  hrDepartment         HrDepartment?  @relation("hr_departmentsTohr_departments", fields: [parentId], references: [id])
  other_hr_departments HrDepartment[] @relation("hr_departmentsTohr_departments")
  hrGoals              HrGoal[]
  hrPositions          HrPosition[]
  users                User[]

  hrEmployees HrEmployee[] @relation("DepartmentManager")
  HrEmployee  HrEmployee[]

  @@unique([companyId, code])
  @@index([companyId])
  @@index([managerId])
  @@index([parentId])
  @@map("hr_departments")
}

model HrEmployee {
  id                 String         @id @default(cuid())
  companyId          String
  userId             String?        @unique
  employeeNumber     String
  firstName          String
  lastName           String
  firstNameEn        String?
  lastNameEn         String?
  email              String?
  phone              String?
  mobile             String?
  avatar             String?
  dateOfBirth        DateTime?
  gender             Gender?
  nationality        String?
  nationalId         String?
  passportNumber     String?
  maritalStatus      MaritalStatus?
  address            String?        @db.Text
  city               String?
  country            String?
  postalCode         String?
  departmentId       String?
  positionId         String?
  managerId          String?
  hireDate           DateTime
  probationEndDate   DateTime?
  contractType       ContractType   @default(FULL_TIME)
  contractEndDate    DateTime?
  workLocation       String?
  baseSalary         Decimal?       @db.Decimal(12, 2)
  currency           String         @default("EGP")
  bankName           String?
  bankAccountNumber  String?
  bankIban           String?
  annualLeaveBalance Int            @default(21)
  sickLeaveBalance   Int            @default(15)
  status             EmployeeStatus @default(ACTIVE)
  terminationDate    DateTime?
  terminationReason  String?        @db.Text
  emergencyContact   String?        @db.Text
  documents          String?        @db.Text
  notes              String?        @db.Text
  metadata           String?        @db.Text
  createdAt          DateTime       @default(now())
  updatedAt          DateTime       @updatedAt

  company            Company               @relation(fields: [companyId], references: [id], onDelete: Cascade)
  user               User?                 @relation(fields: [userId], references: [id])
  hrDepartment       HrDepartment?         @relation(fields: [departmentId], references: [id])
  hrPosition         HrPosition?           @relation(fields: [positionId], references: [id])
  manager            HrEmployee?           @relation("EmployeeManager", fields: [managerId], references: [id])
  subordinates       HrEmployee[]          @relation("EmployeeManager")
  managedDepartments HrDepartment[]        @relation("DepartmentManager")
  reviewedReviews    HrPerformanceReview[] @relation("ReviewerReviews")
  approvedLeaves     HrLeaveRequest[]      @relation("LeaveApprover")
  benefitEnrollments HrBenefitEnrollment[]

  leaveRequests   HrLeaveRequest[]   @relation("EmployeeLeaves")
  hrAttendances   HrAttendance[]
  advanceRequests HrAdvanceRequest[]
  payrolls        HrPayroll[]

  employeeDocuments  HrEmployeeDocument[]
  employeeTrainings  HrEmployeeTraining[]
  employeeWarnings   HrEmployeeWarning[]
  goals              HrGoal[]
  feedbacksReceived  HrFeedback[]          @relation("FeedbackTo")
  feedbacksGiven     HrFeedback[]          @relation("FeedbackFrom")
  resignations       Resignation[]
  hrSalaryHistories  HrSalaryHistory[]
  shiftAssignments   HrShiftAssignment[]
  performanceReviews HrPerformanceReview[] @relation("EmployeeReviews")
  LateWarning        LateWarning[]

  @@unique([companyId, employeeNumber])
  @@index([companyId])
  @@index([departmentId])
  @@index([managerId])
  @@index([positionId])
  @@index([status])
  @@map("hr_employees")
}

model HrPosition {
  id                                                       String        @id
  companyId                                                String
  departmentId                                             String?
  title                                                    String
  titleEn                                                  String?
  code                                                     String?
  description                                              String?       @db.Text
  level                                                    Int           @default(1)
  minSalary                                                Decimal?      @db.Decimal(12, 2)
  maxSalary                                                Decimal?      @db.Decimal(12, 2)
  requirements                                             String?       @db.Text
  responsibilities                                         String?       @db.Text
  isActive                                                 Boolean       @default(true)
  createdAt                                                DateTime      @default(now())
  updatedAt                                                DateTime
  companies                                                Company       @relation(fields: [companyId], references: [id], onDelete: Cascade)
  hrDepartment                                             HrDepartment? @relation(fields: [departmentId], references: [id])
  hr_promotions_hr_promotions_fromPositionIdTohr_positions HrPromotion[] @relation("hr_promotions_fromPositionIdTohr_positions")
  hr_promotions_hr_promotions_toPositionIdTohr_positions   HrPromotion[] @relation("hr_promotions_toPositionIdTohr_positions")
  users                                                    User[]

  hrEmployees HrEmployee[] @relation

  @@unique([companyId, code])
  @@index([companyId])
  @@index([departmentId])
  @@map("hr_positions")
}

model HrAttendance {
  id                String             @id
  companyId         String
  userId            String
  date              DateTime           @db.Date
  checkIn           DateTime?
  checkOut          DateTime?
  checkInLocation   String?
  checkOutLocation  String?
  checkInMethod     String?
  checkOutMethod    String?
  workHours         Decimal?           @db.Decimal(5, 2)
  overtimeHours     Decimal?           @db.Decimal(5, 2)
  lateMinutes       Int?               @default(0)
  earlyLeaveMinutes Int?               @default(0)
  status            HrAttendanceStatus @default(PRESENT)
  isApproved        Boolean            @default(false)
  approvedBy        String?
  notes             String?            @db.Text
  createdAt         DateTime           @default(now())
  updatedAt         DateTime
  companies         Company            @relation(fields: [companyId], references: [id], onDelete: Cascade)
  users             User               @relation(fields: [userId], references: [id], onDelete: Cascade)

  hrEmployeeRel   HrEmployee? @relation(fields: [hrEmployeeRelId], references: [id])
  hrEmployeeRelId String?

  @@unique([userId, date])
  @@index([companyId])
  @@index([date])
  @@index([status])
  @@index([userId])
  @@map("hr_attendance")
}

model HrLeaveRequest {
  id              String                @id
  companyId       String
  userId          String
  type            HrLeaveRequestType
  startDate       DateTime              @db.Date
  endDate         DateTime              @db.Date
  totalDays       Int
  isHalfDay       Boolean               @default(false)
  halfDayPeriod   String?
  reason          String?               @db.Text
  attachments     String?               @db.Text
  status          HrLeaveRequestsStatus @default(PENDING)
  approvedBy      String?
  approvedAt      DateTime?
  rejectionReason String?               @db.Text
  substituteId    String?
  createdAt       DateTime              @default(now())
  updatedAt       DateTime
  companies       Company               @relation(fields: [companyId], references: [id], onDelete: Cascade)

  hrEmployeeLeaveApprover   HrEmployee? @relation("LeaveApprover", fields: [hrEmployeeLeaveApproverId], references: [id])
  hrEmployeeLeaveApproverId String?

  hrEmployeeEmployeeLeaves   HrEmployee? @relation("EmployeeLeaves", fields: [hrEmployeeEmployeeLeavesId], references: [id])
  hrEmployeeEmployeeLeavesId String?

  @@index([approvedBy])
  @@index([companyId])
  @@index([startDate])
  @@index([status])
  @@index([userId])
  @@map("hr_leave_requests")
}

model HrPayroll {
  id                  String          @id
  companyId           String
  userId              String
  month               Int
  year                Int
  periodStart         DateTime        @db.Date
  periodEnd           DateTime        @db.Date
  baseSalary          Decimal         @db.Decimal(12, 2)
  workingDays         Int             @default(30)
  actualWorkDays      Int             @default(30)
  allowances          String?         @db.Text
  totalAllowances     Decimal         @default(0.00) @db.Decimal(12, 2)
  deductions          String?         @db.Text
  totalDeductions     Decimal         @default(0.00) @db.Decimal(12, 2)
  overtimeHours       Decimal         @default(0.00) @db.Decimal(5, 2)
  overtimeRate        Decimal         @default(1.50) @db.Decimal(3, 2)
  overtimeAmount      Decimal         @default(0.00) @db.Decimal(12, 2)
  bonuses             Decimal         @default(0.00) @db.Decimal(12, 2)
  bonusNotes          String?         @db.Text
  socialInsurance     Decimal         @default(0.00) @db.Decimal(12, 2)
  taxAmount           Decimal         @default(0.00) @db.Decimal(12, 2)
  grossSalary         Decimal         @db.Decimal(12, 2)
  netSalary           Decimal         @db.Decimal(12, 2)
  status              HrPayrollStatus @default(DRAFT)
  paidAt              DateTime?
  paymentMethod       String?
  paymentReference    String?
  notes               String?         @db.Text
  createdAt           DateTime        @default(now())
  updatedAt           DateTime
  absentDays          Int             @default(0)
  attendanceDeduction Decimal         @default(0.00) @db.Decimal(10, 2)
  latePenalty         Decimal         @default(0.00) @db.Decimal(12, 2)
  rewardDetails       String?         @db.Text
  rewards             String?         @db.Text
  totalRewards        Decimal         @default(0.00) @db.Decimal(12, 2)
  companies           Company         @relation(fields: [companyId], references: [id], onDelete: Cascade)

  hrEmployeeRel   HrEmployee? @relation(fields: [hrEmployeeRelId], references: [id])
  hrEmployeeRelId String?

  @@unique([userId, month, year])
  @@index([companyId])
  @@index([month, year])
  @@index([status])
  @@index([userId])
  @@map("hr_payroll")
}

model HrPerformanceReview {
  id               String                     @id
  companyId        String
  reviewerId       String
  reviewPeriod     String
  periodStart      DateTime                   @db.Date
  periodEnd        DateTime                   @db.Date
  overallRating    Decimal                    @db.Decimal(3, 2)
  ratings          String?                    @db.Text
  goals            String?                    @db.Text
  goalsAchievement Decimal?                   @db.Decimal(5, 2)
  strengths        String?                    @db.Text
  improvements     String?                    @db.Text
  reviewerComments String?                    @db.Text
  employeeComments String?                    @db.Text
  recommendations  String?                    @db.Text
  status           HrPerformanceReviewsStatus @default(DRAFT)
  submittedAt      DateTime?
  acknowledgedAt   DateTime?
  createdAt        DateTime                   @default(now())
  updatedAt        DateTime
  userId           String?
  companies        Company                    @relation(fields: [companyId], references: [id], onDelete: Cascade)

  hrEmployeeReviewerReviews   HrEmployee? @relation("ReviewerReviews", fields: [hrEmployeeReviewerReviewsId], references: [id])
  hrEmployeeReviewerReviewsId String?

  hrEmployeeEmployeeReviews   HrEmployee? @relation("EmployeeReviews", fields: [hrEmployeeEmployeeReviewsId], references: [id])
  hrEmployeeEmployeeReviewsId String?

  @@index([companyId])
  @@index([reviewerId])
  @@index([status])
  @@index([userId])
  @@map("hr_performance_reviews")
}

model HrEmployeeDocument {
  id         String    @id
  companyId  String
  name       String
  type       String
  fileUrl    String
  fileSize   Int?
  mimeType   String?
  expiryDate DateTime?
  isVerified Boolean   @default(false)
  verifiedBy String?
  verifiedAt DateTime?
  notes      String?   @db.Text
  createdAt  DateTime  @default(now())
  updatedAt  DateTime
  userId     String
  companies  Company   @relation(fields: [companyId], references: [id], onDelete: Cascade)

  hrEmployeeRel   HrEmployee? @relation(fields: [hrEmployeeRelId], references: [id])
  hrEmployeeRelId String?

  @@index([companyId])
  @@index([type])
  @@index([userId])
  @@map("hr_employee_documents")
}

model HrSalaryHistory {
  id               String   @id
  companyId        String
  previousSalary   Decimal  @db.Decimal(12, 2)
  newSalary        Decimal  @db.Decimal(12, 2)
  changeType       String
  changePercentage Decimal? @db.Decimal(5, 2)
  effectiveDate    DateTime @db.Date
  reason           String?  @db.Text
  approvedBy       String?
  createdAt        DateTime @default(now())
  userId           String
  companies        Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  hrEmployeeRel   HrEmployee? @relation(fields: [hrEmployeeRelId], references: [id])
  hrEmployeeRelId String?

  @@index([companyId])
  @@index([userId])
  @@map("hr_salary_history")
}

model HrEmployeeWarning {
  id               String                @id
  companyId        String
  type             HrEmployeeWarningType
  severity         String                @default("minor")
  title            String
  description      String                @db.Text
  incidentDate     DateTime              @db.Date
  actionTaken      String?               @db.Text
  issuedBy         String
  acknowledgedAt   DateTime?
  employeeResponse String?               @db.Text
  attachments      String?               @db.Text
  createdAt        DateTime              @default(now())
  updatedAt        DateTime
  userId           String?
  companies        Company               @relation(fields: [companyId], references: [id], onDelete: Cascade)

  hrEmployeeRel   HrEmployee? @relation(fields: [hrEmployeeRelId], references: [id])
  hrEmployeeRelId String?

  @@index([companyId])
  @@index([userId])
  @@map("hr_employee_warnings")
}

model HrEmployeeTraining {
  id             String                   @id
  companyId      String
  trainingName   String
  provider       String?
  type           String
  description    String?                  @db.Text
  startDate      DateTime                 @db.Date
  endDate        DateTime?                @db.Date
  duration       Int?
  cost           Decimal?                 @db.Decimal(12, 2)
  currency       String                   @default("EGP")
  status         HrEmployeeTrainingStatus @default(PLANNED)
  completionDate DateTime?
  certificateUrl String?
  score          Decimal?                 @db.Decimal(5, 2)
  feedback       String?                  @db.Text
  createdAt      DateTime                 @default(now())
  updatedAt      DateTime
  userId         String?
  companies      Company                  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  hrEmployeeRel   HrEmployee? @relation(fields: [hrEmployeeRelId], references: [id])
  hrEmployeeRelId String?

  @@index([companyId])
  @@index([status])
  @@index([userId])
  @@map("hr_employee_training")
}

model HrShift {
  id                 String              @id
  companyId          String
  name               String
  startTime          String
  endTime            String
  breakDuration      Int                 @default(60)
  color              String?             @default("#3B82F6")
  isActive           Boolean             @default(true)
  createdAt          DateTime            @default(now())
  updatedAt          DateTime
  hrShiftAssignments HrShiftAssignment[]
  companies          Company             @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@map("hr_shifts")
}

model HrShiftAssignment {
  id        String   @id
  companyId String
  shiftId   String
  date      DateTime @db.Date
  notes     String?  @db.Text
  createdAt DateTime @default(now())
  updatedAt DateTime
  userId    String?
  companies Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  hrShift   HrShift  @relation(fields: [shiftId], references: [id], onDelete: Cascade)
  users     User?    @relation(fields: [userId], references: [id], onDelete: Cascade)

  hrEmployeeRel   HrEmployee? @relation(fields: [hrEmployeeRelId], references: [id])
  hrEmployeeRelId String?

  @@unique([userId, shiftId, date])
  @@index([companyId])
  @@index([date])
  @@index([shiftId])
  @@index([userId])
  @@map("hr_shift_assignments")
}

model HrBenefit {
  id                   String                @id
  companyId            String
  name                 String
  description          String?               @db.Text
  type                 String
  cost                 Decimal?              @db.Decimal(12, 2)
  currency             String                @default("EGP")
  isActive             Boolean               @default(true)
  createdAt            DateTime              @default(now())
  updatedAt            DateTime
  hrBenefitEnrollments HrBenefitEnrollment[]
  companies            Company               @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@map("hr_benefits")
}

model HrBenefitEnrollment {
  id        String    @id
  companyId String
  benefitId String
  startDate DateTime  @db.Date
  endDate   DateTime? @db.Date
  status    String    @default("ACTIVE")
  notes     String?   @db.Text
  createdAt DateTime  @default(now())
  updatedAt DateTime
  userId    String
  hrBenefit HrBenefit @relation(fields: [benefitId], references: [id], onDelete: Cascade)
  companies Company   @relation(fields: [companyId], references: [id], onDelete: Cascade)

  hrEmployeeRel   HrEmployee? @relation(fields: [hrEmployeeRelId], references: [id])
  hrEmployeeRelId String?

  @@index([benefitId])
  @@index([companyId])
  @@index([userId])
  @@map("hr_benefit_enrollments")
}

model HrGoal {
  id           String        @id
  companyId    String
  departmentId String?
  title        String
  description  String?       @db.Text
  targetValue  Decimal       @db.Decimal(12, 2)
  currentValue Decimal       @default(0.00) @db.Decimal(12, 2)
  unit         String?
  startDate    DateTime      @db.Date
  endDate      DateTime      @db.Date
  status       String        @default("PENDING")
  progress     Int           @default(0)
  createdAt    DateTime      @default(now())
  updatedAt    DateTime
  userId       String?
  companies    Company       @relation(fields: [companyId], references: [id], onDelete: Cascade)
  hrDepartment HrDepartment? @relation(fields: [departmentId], references: [id], onDelete: Cascade)

  hrEmployeeRel   HrEmployee? @relation(fields: [hrEmployeeRelId], references: [id])
  hrEmployeeRelId String?

  @@index([companyId])
  @@index([departmentId])
  @@index([status])
  @@index([userId])
  @@map("hr_goals")
}

model HrFeedback {
  id          String   @id
  companyId   String
  type        String   @default("PEER")
  category    String?
  content     String   @db.Text
  rating      Int?
  isAnonymous Boolean  @default(false)
  status      String   @default("ACTIVE")
  createdAt   DateTime @default(now())
  updatedAt   DateTime
  fromUserId  String?
  toUserId    String?
  companies   Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  hrEmployeeFeedbackTo   HrEmployee? @relation("FeedbackTo", fields: [hrEmployeeFeedbackToId], references: [id])
  hrEmployeeFeedbackToId String?

  hrEmployeeFeedbackFrom   HrEmployee? @relation("FeedbackFrom", fields: [hrEmployeeFeedbackFromId], references: [id])
  hrEmployeeFeedbackFromId String?

  @@index([companyId])
  @@index([fromUserId])
  @@index([toUserId])
  @@index([type])
  @@map("hr_feedback")
}

model Resignation {
  id                    String                 @id
  companyId             String
  resignationDate       DateTime               @db.Date
  lastWorkingDay        DateTime               @db.Date
  reason                String?                @db.Text
  exitInterview         String?                @db.Text
  status                String                 @default("PENDING")
  approvedBy            String?
  approvedAt            DateTime?
  createdAt             DateTime               @default(now())
  updatedAt             DateTime
  actualLastDay         DateTime?              @db.Date
  clearanceCompleted    Boolean                @default(false)
  expectedLastDay       DateTime?              @db.Date
  finalSettlement       Decimal?               @db.Decimal(10, 2)
  noticePeriodDays      Int?
  settlementPaid        Boolean                @default(false)
  userId                String?
  hrClearanceChecklists HrClearanceChecklist[]
  companies             Company                @relation(fields: [companyId], references: [id], onDelete: Cascade)

  hrEmployeeRel   HrEmployee? @relation(fields: [hrEmployeeRelId], references: [id])
  hrEmployeeRelId String?

  @@index([companyId])
  @@index([status])
  @@index([userId])
  @@map("hr_resignations")
}

model HrHRAuditLog {
  id         String   @id @default(cuid())
  companyId  String
  action     String // APPROVE, REJECT, CREATE, UPDATE, DELETE
  entityType String // LEAVE_REQUEST, ADVANCE_REQUEST, RESIGNATION, SETTINGS
  entityId   String?
  actorId    String // UserID of who performed the action
  actorName  String
  details    String?  @db.Text // JSON string for details
  ipAddress  String?
  createdAt  DateTime @default(now())

  company Company @relation(fields: [companyId], references: [id], onDelete: Cascade)
  actor   User    @relation(fields: [actorId], references: [id])

  @@index([companyId])
  @@index([entityType])
  @@index([createdAt])
  @@map("hr_audit_logs")
}

model HrHRSettings {
  id        String @id @default(cuid())
  companyId String @unique

  // Work Schedule Settings
  workDays String @default("[1,2,3,4,5]")

  // Leave Settings
  annualLeaveDefault Int @default(21)
  sickLeaveDefault   Int @default(15)
  carryOverLimit     Int @default(5)

  // Advance Settings
  maxAdvancePercentage   Float @default(50) // % of monthly salary
  maxActiveAdvances      Int   @default(1) // Max concurrent advances
  minMonthsForAdvance    Int   @default(3) // Min employment months
  advanceRepaymentMonths Int   @default(6) // Max repayment period

  // Resignation Settings
  noticePeriodDays Int     @default(30)
  requireClearance Boolean @default(true)
  clearanceItems   String? @db.Text // JSON array

  // Attendance Settings
  monthlyLateLimit      Int     @default(3)
  lateGracePeriod       Int     @default(15)
  earlyLeaveGracePeriod Int     @default(15)
  lateWarningThreshold  Int     @default(3) // Late days per month
  lateWarningLevels     String? @db.Text // JSON array

  // Auto Deduction Settings (New System)
  autoDeductionEnabled          Boolean @default(false)
  gracePeriodMinutes            Int     @default(60)
  lateThresholdMinutes          Int     @default(10)
  maxDailyDeductionDays         Decimal @default(1.0) @db.Decimal(3, 1) // Maximum deduction per day (e.g. 1.0 = one full day)
  earlyCheckoutEnabled          Boolean @default(true)
  earlyCheckoutThresholdMinutes Int     @default(0)
  firstViolationMultiplier      Decimal @default(1.0) @db.Decimal(3, 1)
  secondViolationMultiplier     Decimal @default(2.0) @db.Decimal(3, 1)
  thirdViolationMultiplier      Decimal @default(3.0) @db.Decimal(3, 1)
  notifyAtPercentage            Int     @default(75)
  notifyOnDeduction             Boolean @default(true)
  notifyOnGraceReset            Boolean @default(true)
  deductionCalculationMethod    String  @default("minute") // minute, hourly, daily
  workingDaysPerMonth           Int     @default(22)
  workingHoursPerDay            Int     @default(8)
  requireDeductionReview        Boolean @default(true)
  absencePenaltyRate            Decimal @default(1.0) @db.Decimal(3, 1)
  delayPenaltyTiers             String? @db.Text // JSON array of { minMinutes: number, deductionDays: number }

  // Geofencing Settings (moved from Company model)
  geofenceEnabled Boolean  @default(false)
  officeLatitude  Decimal? @db.Decimal(10, 8)
  officeLongitude Decimal? @db.Decimal(11, 8)
  geofenceRadius  Int?     @default(200)

  // Payroll Settings
  payrollDay          Int     @default(25)
  overtimeMinHours    Decimal @default(1.0) @db.Decimal(3, 1)
  overtimeRate        Decimal @default(1.50) @db.Decimal(3, 2)
  socialInsuranceRate Decimal @default(14.00) @db.Decimal(5, 2)
  taxRate             Decimal @default(0.00) @db.Decimal(5, 2)
  taxBrackets         String? @db.Text
  publicHolidays      String? @db.Text

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  company Company @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@map("hr_settings")
}

model HrAdvanceRequest {
  id        String  @id @default(cuid())
  companyId String
  userId    String?

  // Request Details
  amount            Decimal @db.Decimal(10, 2)
  reason            String  @db.Text
  repaymentType     String // LUMP_SUM, INSTALLMENTS
  installmentsCount Int     @default(1)
  monthlyAmount     Decimal @db.Decimal(10, 2)

  // Validation Fields (NEW)
  employeeSalary    Decimal? @db.Decimal(10, 2) // Salary at request time
  maxAllowedAmount  Decimal? @db.Decimal(10, 2) // Calculated max
  installmentAmount Decimal? @db.Decimal(10, 2) // Monthly deduction
  remainingBalance  Decimal  @default(0) @db.Decimal(10, 2)
  isPaidOff         Boolean  @default(false)

  // Status
  status         String    @default("PENDING") // PENDING, APPROVED, REJECTED
  approvedBy     String?
  approvedAt     DateTime?
  rejectedReason String?   @db.Text

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  company Company @relation(fields: [companyId], references: [id], onDelete: Cascade)
  // user     User?    @relation("AdvanceRequestUser", fields: [userId], references: [id], onDelete: Cascade)
  // approver User?    @relation("AdvanceRequestApprover", fields: [approvedBy], references: [id])

  hrEmployeeRel   HrEmployee? @relation(fields: [hrEmployeeRelId], references: [id])
  hrEmployeeRelId String?

  @@index([companyId])
  @@index([userId])
  @@index([status])
  @@map("hr_advance_requests")
}

model HrClearanceChecklist {
  id            String    @id @default(cuid())
  resignationId String
  itemName      String
  description   String?
  isCompleted   Boolean   @default(false)
  completedBy   String?
  completedAt   DateTime?
  notes         String?   @db.Text
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  resignation     Resignation @relation(fields: [resignationId], references: [id], onDelete: Cascade)
  completedByUser User?       @relation(fields: [completedBy], references: [id])

  @@index([resignationId])
  @@map("clearance_checklists")
}

model LateWarning {
  id             String    @id @default(cuid())
  companyId      String
  userId         String
  month          Int
  year           Int
  lateCount      Int
  totalMinutes   Int
  warningLevel   Int // 1, 2, 3
  issuedAt       DateTime  @default(now())
  acknowledgedAt DateTime?

  company Company @relation(fields: [companyId], references: [id], onDelete: Cascade)
  // user     User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  hrEmployeeRel   HrEmployee? @relation(fields: [hrEmployeeRelId], references: [id])
  hrEmployeeRelId String?

  @@index([companyId])
  @@index([userId])
  @@index([month, year])
  @@map("late_warnings")
}

model HrKudos {
  id                               String   @id
  companyId                        String
  fromUserId                       String
  toUserId                         String
  reason                           String   @db.Text
  points                           Int      @default(1)
  createdAt                        DateTime @default(now())
  updatedAt                        DateTime
  companies                        Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  users_hr_kudos_fromUserIdTousers User     @relation("hr_kudos_fromUserIdTousers", fields: [fromUserId], references: [id], onDelete: Cascade)
  users_hr_kudos_toUserIdTousers   User     @relation("hr_kudos_toUserIdTousers", fields: [toUserId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([fromUserId])
  @@index([toUserId])
  @@map("hr_kudos")
}

model HrLatenessBalance {
  id                   String   @id
  companyId            String
  employeeId           String
  month                Int
  year                 Int
  totalLateMinutes     Int      @default(0)
  graceMinutesUsed     Int      @default(0)
  deductedMinutes      Int      @default(0)
  totalDeductionAmount Decimal  @default(0.00) @db.Decimal(10, 2)
  lateCount            Int      @default(0)
  createdAt            DateTime @default(now())
  updatedAt            DateTime
  companies            Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@unique([employeeId, month, year])
  @@index([companyId])
  @@index([employeeId])
  @@index([month, year])
  @@map("hr_lateness_balance")
}

model HrManualDeduction {
  id               String                   @id
  companyId        String
  employeeId       String
  type             HrManualDeductionType    @default(OTHER)
  category         String?
  amount           Decimal                  @db.Decimal(10, 2)
  reason           String                   @db.Text
  description      String?                  @db.Text
  date             DateTime                 @db.Date
  effectiveMonth   Int
  effectiveYear    Int
  status           HrManualDeductionsStatus @default(PENDING)
  approvedBy       String?
  approvedAt       DateTime?
  rejectedBy       String?
  rejectedAt       DateTime?
  rejectionReason  String?                  @db.Text
  appliedToPayroll Boolean                  @default(false)
  payrollId        String?
  attachments      String?                  @db.Text
  notes            String?                  @db.Text
  createdBy        String
  createdAt        DateTime                 @default(now())
  updatedAt        DateTime
  companies        Company                  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([createdBy])
  @@index([effectiveMonth, effectiveYear])
  @@index([employeeId])
  @@index([status])
  @@map("hr_manual_deductions")
}

model HrPromotion {
  id                                                      String             @id
  companyId                                               String
  fromPositionId                                          String?
  toPositionId                                            String
  fromPositionName                                        String?
  toPositionName                                          String
  fromSalary                                              Decimal?           @db.Decimal(12, 2)
  toSalary                                                Decimal?           @db.Decimal(12, 2)
  promotionDate                                           DateTime           @db.Date
  effectiveDate                                           DateTime           @db.Date
  reason                                                  String             @db.Text
  status                                                  HrPromotionsStatus @default(PENDING)
  approvedBy                                              String?
  approvedAt                                              DateTime?
  rejectedAt                                              DateTime?
  rejectionReason                                         String?            @db.Text
  notes                                                   String?            @db.Text
  createdAt                                               DateTime           @default(now())
  updatedAt                                               DateTime
  userId                                                  String?
  companies                                               Company            @relation(fields: [companyId], references: [id], onDelete: Cascade)
  hr_positions_hr_promotions_fromPositionIdTohr_positions HrPosition?        @relation("hr_promotions_fromPositionIdTohr_positions", fields: [fromPositionId], references: [id])
  hr_positions_hr_promotions_toPositionIdTohr_positions   HrPosition         @relation("hr_promotions_toPositionIdTohr_positions", fields: [toPositionId], references: [id])

  @@index([companyId])
  @@index([fromPositionId])
  @@index([promotionDate])
  @@index([toPositionId])
  @@index([userId])
  @@map("hr_promotions")
}

model HrRewardEligibilityLog {
  id                 String   @id
  companyId          String
  userId             String
  rewardTypeId       String
  evaluationDate     DateTime @default(now())
  periodStart        DateTime @db.Date
  periodEnd          DateTime @db.Date
  isEligible         Boolean
  eligibilityDetails String?  @db.Text
  conditionsChecked  String?  @db.Text
  createdAt          DateTime @default(now())
  companies          Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  users              User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([evaluationDate])
  @@index([rewardTypeId])
  @@index([userId])
  @@map("hr_reward_eligibility_logs")
}

model HrRewardRecord {
  id                  String                        @id
  companyId           String
  userId              String
  rewardTypeId        String?
  rewardName          String
  rewardCategory      HrRewardRecordsRewardCategory
  calculatedValue     Decimal                       @db.Decimal(12, 2)
  calculationDetails  String?                       @db.Text
  periodStart         DateTime                      @db.Date
  periodEnd           DateTime                      @db.Date
  appliedMonth        Int
  appliedYear         Int
  reason              String?                       @db.Text
  eligibilityMet      String?                       @db.Text
  status              HrRewardRecordsStatus         @default(PENDING)
  approvedBy          String?
  approvedAt          DateTime?
  appliedAt           DateTime?
  payrollId           String?
  isIncludedInPayroll Boolean                       @default(false)
  isLocked            Boolean                       @default(false)
  voidedBy            String?
  voidedAt            DateTime?
  voidReason          String?                       @db.Text
  createdAt           DateTime                      @default(now())
  updatedAt           DateTime
  companies           Company                       @relation(fields: [companyId], references: [id], onDelete: Cascade)
  hrRewardType        HrRewardType?                 @relation(fields: [rewardTypeId], references: [id])
  users               User                          @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([appliedMonth, appliedYear])
  @@index([companyId])
  @@index([rewardTypeId])
  @@index([status])
  @@index([userId])
  @@map("hr_reward_records")
}

model HrRewardSettings {
  id                         String   @id
  companyId                  String   @unique
  allowRewardDeductionOffset Boolean  @default(false)
  applyRewardsBeforeTax      Boolean  @default(true)
  autoEvaluationEnabled      Boolean  @default(true)
  evaluationDayOfMonth       Int      @default(1)
  requireManagerApproval     Boolean  @default(false)
  requireHRApproval          Boolean  @default(true)
  notifyEmployeeOnReward     Boolean  @default(true)
  notifyManagerOnReward      Boolean  @default(true)
  createdAt                  DateTime @default(now())
  updatedAt                  DateTime
  companies                  Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@map("hr_reward_settings")
}

model HrRewardType {
  id                    String                         @id
  companyId             String
  name                  String
  nameAr                String?
  description           String?                        @db.Text
  category              HrRewardTypesCategory
  calculationMethod     HrRewardTypesCalculationMethod
  value                 Decimal                        @db.Decimal(12, 2)
  maxCap                Decimal?                       @db.Decimal(12, 2)
  eligibilityConditions String?                        @db.Text
  triggerType           HrRewardTypesTriggerType
  frequency             HrRewardTypesFrequency
  isActive              Boolean                        @default(true)
  priority              Int                            @default(1)
  effectiveFrom         DateTime?                      @db.Date
  effectiveTo           DateTime?                      @db.Date
  createdBy             String
  createdAt             DateTime                       @default(now())
  updatedAt             DateTime
  hrRewardRecords       HrRewardRecord[]
  companies             Company                        @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([category])
  @@index([companyId])
  @@index([isActive])
  @@map("hr_reward_types")
}

generator client {
  provider        = "prisma-client-js"
  output          = "../../generated/verify_client"
  previewFeatures = ["prismaSchemaFolder"]
  binaryTargets   = ["native", "debian-openssl-1.1.x", "debian-openssl-3.0.x", "linux-musl", "linux-musl-openssl-3.0.x"]
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model BroadcastCampaign {
  id                  String               @id
  name                String
  message             String               @db.Text
  targetAudience      String
  scheduledAt         DateTime?
  sentAt              DateTime?
  tags                String?              @db.LongText
  priority            String               @default("medium")
  includeImages       Boolean              @default(false)
  trackClicks         Boolean              @default(true)
  autoResend          Boolean              @default(false)
  images              String?              @db.LongText
  status              String               @default("draft")
  recipientCount      Int                  @default(0)
  sentCount           Int                  @default(0)
  deliveredCount      Int                  @default(0)
  openedCount         Int                  @default(0)
  clickedCount        Int                  @default(0)
  failedCount         Int                  @default(0)
  companyId           String
  creatorId           String?
  createdAt           DateTime             @default(now())
  updatedAt           DateTime
  companies           Company              @relation(fields: [companyId], references: [id], onDelete: Cascade)
  broadcastRecipients BroadcastRecipient[]

  @@index([companyId])
  @@index([scheduledAt])
  @@index([status])
  @@map("broadcast_campaigns")
}

model BroadcastRecipient {
  id                String            @id
  campaignId        String
  conversationId    String
  customerPhone     String
  customerName      String?
  messengerUserId   String?
  status            String            @default("pending")
  sentAt            DateTime?
  deliveredAt       DateTime?
  openedAt          DateTime?
  clickedAt         DateTime?
  repliedAt         DateTime?
  failureReason     String?           @db.Text
  messageId         String?
  createdAt         DateTime          @default(now())
  updatedAt         DateTime
  broadcastCampaign BroadcastCampaign @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  conversation      Conversation      @relation(fields: [conversationId], references: [id], onDelete: Cascade)

  @@index([campaignId])
  @@index([conversationId])
  @@index([status])
  @@map("broadcast_recipients")
}

model BroadcastSettings {
  id                           String   @id
  companyId                    String   @unique
  defaultSendTime              String   @default("10:00")
  timezone                     String   @default("Asia/Riyadh")
  maxRecipientsPerCampaign     Int      @default(5000)
  maxCampaignsPerDay           Int      @default(10)
  enableDeliveryReports        Boolean  @default(true)
  enableOpenTracking           Boolean  @default(true)
  enableClickTracking          Boolean  @default(true)
  enableUnsubscribeTracking    Boolean  @default(true)
  notifyOnCampaignSent         Boolean  @default(true)
  notifyOnHighUnsubscribeRate  Boolean  @default(true)
  notifyOnLowDeliveryRate      Boolean  @default(true)
  adminEmail                   String?
  requireApprovalForHighVolume Boolean  @default(false)
  highVolumeThreshold          Int      @default(1000)
  enableContentFiltering       Boolean  @default(false)
  blockedWords                 String?  @db.LongText
  messagesPerMinute            Int      @default(60)
  messagesPerHour              Int      @default(1000)
  messagesPerDay               Int      @default(10000)
  defaultFooter                String?  @db.Text
  unsubscribeText              String   @default("  STOP")
  companyName                  String?
  companyAddress               String?
  createdAt                    DateTime @default(now())
  updatedAt                    DateTime
  companies                    Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@map("broadcast_settings")
}

model FacebookAdAccount {
  id                         String                      @id
  companyId                  String
  accountId                  String
  name                       String
  currency                   String                      @default("USD")
  timezone                   String?
  accessToken                String                      @db.Text
  isActive                   Boolean                     @default(true)
  settings                   String?                     @db.Text
  createdAt                  DateTime                    @default(now())
  updatedAt                  DateTime
  companies                  Company                     @relation(fields: [companyId], references: [id], onDelete: Cascade)
  facebookCampaigns          FacebookCampaign[]
  facebookCustomAudiences    FacebookCustomAudience[]
  facebookLookalikeAudiences FacebookLookalikeAudience[]
  facebookProductCatalogs    FacebookProductCatalog[]

  @@unique([companyId, accountId])
  @@index([accountId])
  @@index([companyId])
  @@map("facebook_ad_accounts")
}

model FacebookAdInsight {
  id               String     @id
  adId             String
  date             DateTime
  impressions      Int        @default(0)
  clicks           Int        @default(0)
  ctr              Float      @default(0)
  cpc              Float      @default(0)
  spend            Float      @default(0)
  conversions      Int        @default(0)
  cpa              Float      @default(0)
  reach            Int        @default(0)
  frequency        Float      @default(0)
  linkClicks       Int        @default(0)
  costPerLinkClick Float      @default(0)
  landingPageViews Int        @default(0)
  purchases        Int        @default(0)
  purchaseValue    Float      @default(0)
  roas             Float      @default(0)
  breakdown        String?    @db.Text
  createdAt        DateTime   @default(now())
  facebookAd       FacebookAd @relation(fields: [adId], references: [id], onDelete: Cascade)

  @@unique([adId, date])
  @@index([adId])
  @@index([date])
  @@map("facebook_ad_insights")
}

model FacebookAdTestVariant {
  id              String         @id
  testId          String
  name            String
  variantType     String
  variantData     String         @db.Text
  adSetId         String?
  adId            String?
  impressions     Int            @default(0)
  clicks          Int            @default(0)
  conversions     Int            @default(0)
  spend           Float          @default(0)
  ctr             Float          @default(0)
  cpc             Float          @default(0)
  cpa             Float          @default(0)
  roas            Float          @default(0)
  isWinner        Boolean        @default(false)
  pValue          Float?
  confidenceLevel Float?
  createdAt       DateTime       @default(now())
  updatedAt       DateTime
  facebookAd      FacebookAd?    @relation(fields: [adId], references: [id])
  facebookAdset   FacebookAdset? @relation(fields: [adSetId], references: [id])
  facebookAdTest  FacebookAdTest @relation(fields: [testId], references: [id], onDelete: Cascade)

  @@index([adId])
  @@index([adSetId])
  @@index([testId])
  @@index([variantType])
  @@map("facebook_ad_test_variants")
}

model FacebookAdTest {
  id                     String                  @id
  companyId              String
  name                   String
  description            String?                 @db.Text
  testType               String
  status                 String                  @default("DRAFT")
  campaignId             String?
  variants               String                  @db.Text
  winnerVariantId        String?
  confidenceLevel        Float?
  testDuration           Int?
  startDate              DateTime?
  endDate                DateTime?
  trafficSplit           Int                     @default(50)
  minimumResults         Int                     @default(100)
  autoPromote            Boolean                 @default(false)
  totalSpend             Float                   @default(0)
  totalImpressions       Int                     @default(0)
  totalClicks            Int                     @default(0)
  totalConversions       Int                     @default(0)
  settings               String?                 @db.Text
  createdAt              DateTime                @default(now())
  updatedAt              DateTime
  facebookAdTestVariants FacebookAdTestVariant[]
  facebookCampaign       FacebookCampaign?       @relation(fields: [campaignId], references: [id])
  companies              Company                 @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([campaignId])
  @@index([companyId])
  @@index([status])
  @@index([testType])
  @@map("facebook_ad_tests")
}

model FacebookAd {
  id                     String                  @id
  adSetId                String
  companyId              String
  name                   String
  status                 String                  @default("PAUSED")
  facebookAdId           String?
  creativeType           String
  primaryText            String                  @db.Text
  headline               String?
  description            String?                 @db.Text
  callToAction           String?
  imageUrl               String?
  videoUrl               String?
  imageHash              String?
  videoId                String?
  carouselImages         String?                 @db.Text
  carouselCount          Int?                    @default(1)
  linkUrl                String?
  productId              String?
  creative               String?                 @db.Text
  createdAt              DateTime                @default(now())
  updatedAt              DateTime
  lastSyncAt             DateTime?
  facebookAdInsights     FacebookAdInsight[]
  facebookAdTestVariants FacebookAdTestVariant[]
  facebookAdset          FacebookAdset           @relation(fields: [adSetId], references: [id], onDelete: Cascade)

  @@index([adSetId])
  @@index([companyId])
  @@index([facebookAdId])
  @@index([status])
  @@map("facebook_ads")
}

model FacebookAdset {
  id                         String                      @id
  campaignId                 String
  name                       String
  status                     String                      @default("PAUSED")
  facebookAdSetId            String?
  targeting                  String?                     @db.Text
  ageMin                     Int?
  ageMax                     Int?
  genders                    String?                     @db.Text
  locations                  String?                     @db.Text
  interests                  String?                     @db.Text
  behaviors                  String?                     @db.Text
  customAudiencesJson        String?                     @db.Text
  lookalikeAudiencesJson     String?                     @db.Text
  budgetType                 String
  budgetAmount               Float
  optimizationGoal           String?
  billingEvent               String?
  settings                   String?                     @db.Text
  createdAt                  DateTime                    @default(now())
  updatedAt                  DateTime
  lastSyncAt                 DateTime?
  facebookAdTestVariants     FacebookAdTestVariant[]
  facebookAds                FacebookAd[]
  facebookCampaign           FacebookCampaign            @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  facebookDynamicAds         FacebookDynamicAd[]
  facebookCustomAudiences    FacebookCustomAudience[]    @relation("AdSetCustomAudiences")
  facebookLookalikeAudiences FacebookLookalikeAudience[] @relation("AdSetLookalikeAudiences")

  @@index([campaignId])
  @@index([facebookAdSetId])
  @@index([status])
  @@map("facebook_adsets")
}

model FacebookCampaign {
  id                 String             @id
  companyId          String
  adAccountId        String?
  name               String
  objective          String
  status             String             @default("PAUSED")
  facebookCampaignId String?
  budgetType         String
  budgetAmount       Float
  startDate          DateTime?
  endDate            DateTime?
  pixelId            String?
  settings           String?            @db.Text
  createdAt          DateTime           @default(now())
  updatedAt          DateTime
  lastSyncAt         DateTime?
  facebookAdTests    FacebookAdTest[]
  facebookAdsets     FacebookAdset[]
  facebookAdAccount  FacebookAdAccount? @relation(fields: [adAccountId], references: [id])
  companies          Company            @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([adAccountId])
  @@index([companyId])
  @@index([facebookCampaignId])
  @@index([status])
  @@map("facebook_campaigns")
}

model FacebookCatalogProduct {
  id                     String                 @id
  catalogId              String
  productId              String?
  name                   String
  description            String?                @db.Text
  brand                  String?
  category               String?
  sku                    String?
  price                  Decimal?               @db.Decimal(10, 2)
  currency               String?                @default("USD")
  availability           String                 @default("in stock")
  inventory              Int?
  imageUrl               String?
  imageHash              String?
  additionalImages       String?                @db.Text
  linkUrl                String?
  mobileLinkUrl          String?
  facebookProductId      String?
  facebookRetailerId     String?
  syncStatus             String                 @default("PENDING")
  lastSyncedAt           DateTime?
  syncError              String?                @db.Text
  metadata               String?                @db.Text
  createdAt              DateTime               @default(now())
  updatedAt              DateTime
  facebookProductCatalog FacebookProductCatalog @relation(fields: [catalogId], references: [id], onDelete: Cascade)
  products               Product?               @relation(fields: [productId], references: [id])

  @@unique([catalogId, productId])
  @@unique([catalogId, sku])
  @@index([catalogId])
  @@index([facebookProductId])
  @@index([productId])
  @@index([syncStatus])
  @@map("facebook_catalog_products")
}

model FacebookComment {
  id          String    @id
  commentId   String    @unique
  postId      String
  senderId    String
  senderName  String
  message     String    @db.Text
  response    String?   @db.Text
  createdTime DateTime
  respondedAt DateTime?
  pageId      String?
  companyId   String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime
  companies   Company?  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([commentId])
  @@index([companyId])
  @@index([createdTime])
  @@index([postId])
  @@index([senderId])
  @@map("facebook_comments")
}

model FacebookCustomAudience {
  id                         String                      @id
  companyId                  String
  adAccountId                String?
  name                       String
  description                String?                     @db.Text
  audienceType               String
  facebookAudienceId         String?
  customerListId             String?
  matchRate                  Float?
  pixelId                    String?
  eventType                  String?
  retentionDays              Int?                        @default(30)
  engagementType             String?
  videoId                    String?
  videoViewDuration          Int?
  status                     String                      @default("ACTIVE")
  audienceSize               Int?
  settings                   String?                     @db.Text
  createdAt                  DateTime                    @default(now())
  updatedAt                  DateTime
  lastSyncAt                 DateTime?
  facebookAdAccount          FacebookAdAccount?          @relation(fields: [adAccountId], references: [id])
  companies                  Company                     @relation(fields: [companyId], references: [id], onDelete: Cascade)
  facebookLookalikeAudiences FacebookLookalikeAudience[]
  facebookAdsets             FacebookAdset[]             @relation("AdSetCustomAudiences")

  @@index([adAccountId])
  @@index([companyId])
  @@index([facebookAudienceId])
  @@index([status])
  @@map("facebook_custom_audiences")
}

model FacebookDynamicAd {
  id                     String                 @id
  companyId              String
  catalogId              String
  adSetId                String?
  name                   String
  status                 String                 @default("PAUSED")
  facebookAdId           String?
  productSetId           String?
  templateUrl            String?
  templateId             String?
  collectionId           String?
  categoryId             String?
  headline               String?
  description            String?                @db.Text
  callToAction           String?
  createdAt              DateTime               @default(now())
  updatedAt              DateTime
  lastSyncAt             DateTime?
  facebookAdset          FacebookAdset?         @relation(fields: [adSetId], references: [id])
  facebookProductCatalog FacebookProductCatalog @relation(fields: [catalogId], references: [id], onDelete: Cascade)
  companies              Company                @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@unique([companyId, facebookAdId])
  @@index([adSetId])
  @@index([catalogId])
  @@index([companyId])
  @@index([facebookAdId])
  @@index([status])
  @@map("facebook_dynamic_ads")
}

model FacebookLookalikeAudience {
  id                     String                 @id
  companyId              String
  adAccountId            String?
  sourceAudienceId       String
  name                   String
  description            String?                @db.Text
  facebookAudienceId     String?
  lookalikeSpec          String
  country                String
  ratio                  Int                    @default(1)
  status                 String                 @default("ACTIVE")
  audienceSize           Int?
  settings               String?                @db.Text
  createdAt              DateTime               @default(now())
  updatedAt              DateTime
  lastSyncAt             DateTime?
  facebookAdAccount      FacebookAdAccount?     @relation(fields: [adAccountId], references: [id])
  companies              Company                @relation(fields: [companyId], references: [id], onDelete: Cascade)
  facebookCustomAudience FacebookCustomAudience @relation(fields: [sourceAudienceId], references: [id], onDelete: Cascade)
  facebookAdsets         FacebookAdset[]        @relation("AdSetLookalikeAudiences")

  @@index([adAccountId])
  @@index([companyId])
  @@index([facebookAudienceId])
  @@index([sourceAudienceId])
  @@index([status])
  @@map("facebook_lookalike_audiences")
}

model FacebookPage {
  id                      String                   @id
  pageId                  String                   @unique
  pageAccessToken         String                   @db.Text
  pageName                String
  companyId               String?
  status                  String                   @default("connected")
  connectedAt             DateTime                 @default(now())
  createdAt               DateTime                 @default(now())
  updatedAt               DateTime
  disconnectedAt          DateTime?
  blockedCustomersOnPages BlockedCustomersOnPage[]
  companies               Company?                 @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@map("facebook_pages")
}

model FacebookPixelConfig {
  id                        String             @id
  storefrontSettingsId      String
  pixelId                   String
  pixelName                 String
  accessToken               String?            @db.Text
  isActive                  Boolean            @default(true)
  isPrimary                 Boolean            @default(false)
  trackPageView             Boolean            @default(true)
  trackViewContent          Boolean            @default(true)
  trackAddToCart            Boolean            @default(true)
  trackInitiateCheckout     Boolean            @default(true)
  trackPurchase             Boolean            @default(true)
  trackSearch               Boolean            @default(true)
  trackAddToWishlist        Boolean            @default(false)
  trackLead                 Boolean            @default(false)
  trackCompleteRegistration Boolean            @default(false)
  lastTestAt                DateTime?
  lastTestResult            String?            @default("not_tested")
  lastEventSentAt           DateTime?
  totalEventsSent           Int                @default(0)
  errorCount                Int                @default(0)
  lastError                 String?            @db.Text
  tokenStatus               String?            @default("unknown")
  tokenExpiresAt            DateTime?
  eventMatchQuality         Float?
  createdAt                 DateTime           @default(now())
  updatedAt                 DateTime
  storefrontSettings        StorefrontSettings @relation(fields: [storefrontSettingsId], references: [id], onDelete: Cascade)

  @@unique([storefrontSettingsId, pixelId])
  @@index([isActive])
  @@index([storefrontSettingsId])
  @@map("facebook_pixel_configs")
}

model FacebookProductCatalog {
  id                      String                   @id
  companyId               String
  adAccountId             String?
  name                    String
  description             String?                  @db.Text
  facebookCatalogId       String?
  catalogType             String                   @default("PRODUCTS")
  isActive                Boolean                  @default(true)
  status                  String                   @default("ACTIVE")
  lastSyncAt              DateTime?
  lastSyncStatus          String?
  totalProducts           Int                      @default(0)
  syncedProducts          Int                      @default(0)
  settings                String?                  @db.Text
  createdAt               DateTime                 @default(now())
  updatedAt               DateTime
  facebookCatalogProducts FacebookCatalogProduct[]
  facebookDynamicAds      FacebookDynamicAd[]
  facebookAdAccount       FacebookAdAccount?       @relation(fields: [adAccountId], references: [id])
  companies               Company                  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  facebookProductFeeds    FacebookProductFeed[]

  @@unique([companyId, facebookCatalogId])
  @@index([adAccountId])
  @@index([companyId])
  @@index([facebookCatalogId])
  @@index([status])
  @@map("facebook_product_catalogs")
}

model FacebookProductFeed {
  id                     String                 @id
  catalogId              String
  name                   String
  feedType               String                 @default("PRODUCT")
  format                 String                 @default("CSV")
  fileUrl                String?
  fileName               String?
  fileSize               Int?
  facebookFeedId         String?
  feedUrl                String?
  schedule               String?
  lastUploadedAt         DateTime?
  nextUploadAt           DateTime?
  status                 String                 @default("ACTIVE")
  uploadStatus           String?
  settings               String?                @db.Text
  createdAt              DateTime               @default(now())
  updatedAt              DateTime
  facebookProductCatalog FacebookProductCatalog @relation(fields: [catalogId], references: [id], onDelete: Cascade)

  @@index([catalogId])
  @@index([facebookFeedId])
  @@index([status])
  @@map("facebook_product_feeds")
}

model WhatsAppNotificationLog {
  id                              String                                @id
  companyId                       String
  templateId                      String?
  sessionId                       String
  recipientPhone                  String
  recipientName                   String?
  recipientType                   WhatsAppNotificationLogsRecipientType @default(CUSTOMER)
  category                        WhatsAppNotificationLogsCategory
  eventType                       WhatsAppNotificationLogsEventType
  content                         String                                @db.Text
  orderId                         String?
  customerId                      String?
  productId                       String?
  employeeId                      String?
  cartId                          String?
  status                          WhatsAppNotificationLogsStatus        @default(PENDING)
  sentAt                          DateTime?
  deliveredAt                     DateTime?
  readAt                          DateTime?
  failedAt                        DateTime?
  failureReason                   String?
  clicked                         Boolean                               @default(false)
  clickedAt                       DateTime?
  responded                       Boolean                               @default(false)
  respondedAt                     DateTime?
  whatsappMessageId               String?
  cost                            Decimal                               @default(0.0000) @db.Decimal(10, 4)
  createdAt                       DateTime                              @default(now())
  updatedAt                       DateTime
  companies                       Company                               @relation(fields: [companyId], references: [id], onDelete: Cascade)
  customers                       Customer?                             @relation(fields: [customerId], references: [id])
  orders                          Order?                                @relation(fields: [orderId], references: [id])
  products                        Product?                              @relation(fields: [productId], references: [id])
  whatsapp_notification_templates WhatsAppNotificationTemplate?         @relation(fields: [templateId], references: [id])

  @@index([companyId, category, createdAt])
  @@index([companyId, eventType, createdAt])
  @@index([companyId, status, createdAt])
  @@index([customerId])
  @@index([orderId])
  @@index([productId])
  @@index([recipientPhone, companyId])
  @@index([templateId])
  @@map("whatsapp_notification_logs")
}

model WhatsAppNotificationQueue {
  id             String                                 @id
  companyId      String
  templateId     String?
  sessionId      String
  recipientPhone String
  recipientName  String?
  recipientType  WhatsAppNotificationQueueRecipientType @default(CUSTOMER)
  category       WhatsAppNotificationQueueCategory
  eventType      WhatsAppNotificationQueueEventType
  content        String                                 @db.Text
  mediaUrl       String?
  buttons        String?                                @db.Text
  orderId        String?
  customerId     String?
  productId      String?
  employeeId     String?
  cartId         String?
  scheduledAt    DateTime
  priority       Int                                    @default(5)
  retryCount     Int                                    @default(0)
  maxRetries     Int                                    @default(3)
  status         WhatsAppNotificationQueueStatus        @default(PENDING)
  processedAt    DateTime?
  createdAt      DateTime                               @default(now())
  companies      Company                                @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId, status])
  @@index([status, scheduledAt, priority])
  @@map("whatsapp_notification_queue")
}

model WhatsAppNotificationSettings {
  id                            String   @id
  companyId                     String   @unique
  isEnabled                     Boolean  @default(true)
  defaultSessionId              String?
  orderNotificationsEnabled     Boolean  @default(true)
  orderCreatedEnabled           Boolean  @default(true)
  orderConfirmedEnabled         Boolean  @default(true)
  orderProcessingEnabled        Boolean  @default(true)
  orderShippedEnabled           Boolean  @default(true)
  orderDeliveredEnabled         Boolean  @default(true)
  orderCancelledEnabled         Boolean  @default(true)
  paymentReminderEnabled        Boolean  @default(true)
  paymentReminderHours          Int      @default(24)
  productNotificationsEnabled   Boolean  @default(true)
  backInStockEnabled            Boolean  @default(true)
  priceDropEnabled              Boolean  @default(true)
  newProductEnabled             Boolean  @default(false)
  abandonedCartEnabled          Boolean  @default(true)
  abandonedCartFirstReminder    Int      @default(1)
  abandonedCartSecondReminder   Int      @default(24)
  abandonedCartThirdReminder    Int      @default(72)
  abandonedCartDiscountEnabled  Boolean  @default(false)
  abandonedCartDiscountPercent  Int      @default(10)
  marketingNotificationsEnabled Boolean  @default(false)
  promotionalEnabled            Boolean  @default(false)
  couponEnabled                 Boolean  @default(false)
  birthdayEnabled               Boolean  @default(false)
  loyaltyEnabled                Boolean  @default(false)
  hrNotificationsEnabled        Boolean  @default(false)
  attendanceReminderEnabled     Boolean  @default(false)
  leaveApprovalEnabled          Boolean  @default(false)
  payrollEnabled                Boolean  @default(false)
  birthdayWishEnabled           Boolean  @default(false)
  warningNotificationEnabled    Boolean  @default(false)
  rateLimitPerMinute            Int      @default(30)
  quietHoursEnabled             Boolean  @default(true)
  quietHoursStart               String   @default("22:00")
  quietHoursEnd                 String   @default("08:00")
  createdAt                     DateTime @default(now())
  updatedAt                     DateTime
  companies                     Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@map("whatsapp_notification_settings")
}

model WhatsAppNotificationTemplate {
  id                         String                                 @id
  companyId                  String
  name                       String
  category                   WhatsAppNotificationTemplatesCategory
  eventType                  WhatsAppNotificationTemplatesEventType
  content                    String                                 @db.Text
  contentWithMedia           Boolean                                @default(false)
  mediaUrl                   String?
  mediaType                  String?
  hasButtons                 Boolean                                @default(false)
  buttons                    String?                                @db.Text
  hasList                    Boolean                                @default(false)
  listData                   String?                                @db.Text
  variables                  String?                                @db.Text
  isActive                   Boolean                                @default(true)
  isDefault                  Boolean                                @default(false)
  sentCount                  Int                                    @default(0)
  deliveredCount             Int                                    @default(0)
  readCount                  Int                                    @default(0)
  clickCount                 Int                                    @default(0)
  createdAt                  DateTime                               @default(now())
  updatedAt                  DateTime
  whatsapp_notification_logs WhatsAppNotificationLog[]
  companies                  Company                                @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@unique([companyId, eventType, isDefault])
  @@index([companyId, category])
  @@index([companyId, eventType])
  @@map("whatsapp_notification_templates")
}

model ConversionEvent {
  id        String   @id @default(cuid())
  companyId String
  sessionId String
  eventType String
  productId String?
  orderId   String?
  value     Decimal? @db.Decimal(10, 2)
  createdAt DateTime @default(now())
  metadata  String?  @db.Text
  company   Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  product   Product? @relation(fields: [productId], references: [id], onDelete: Cascade)
  order     Order?   @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@index([companyId, eventType, createdAt])
  @@index([sessionId, companyId])
  @@index([companyId, productId, eventType, createdAt])
  @@index([productId, companyId])
  @@map("conversion_events")
}

model SupportTicket {
  id                                        String                @id
  ticketId                                  String                @unique
  subject                                   String
  description                               String                @db.Text
  category                                  SupportTicketCategory @default(INQUIRY)
  status                                    SupportTicketStatus   @default(OPEN)
  rating                                    Int?
  feedback                                  String?               @db.Text
  userId                                    String
  companyId                                 String?
  createdAt                                 DateTime              @default(now())
  updatedAt                                 DateTime
  closedAt                                  DateTime?
  assignedUserId                            String?
  priority                                  SupportTicketPriority @default(MEDIUM)
  SupportAttachment                         SupportAttachment[]
  SupportMessage                            SupportMessage[]
  users_SupportTicket_assignedUserIdTousers User?                 @relation("SupportTicket_assignedUserIdTousers", fields: [assignedUserId], references: [id])
  companies                                 Company?              @relation(fields: [companyId], references: [id])
  users_SupportTicket_userIdTousers         User                  @relation("SupportTicket_userIdTousers", fields: [userId], references: [id], onDelete: Cascade)

  @@index([assignedUserId])
  @@index([category])
  @@index([companyId])
  @@index([priority])
  @@index([status])
  @@index([userId])
}

model SupportMessage {
  id                String              @id
  content           String              @db.Text
  isFromAdmin       Boolean             @default(false)
  ticketId          String
  senderId          String
  createdAt         DateTime            @default(now())
  isInternal        Boolean             @default(false)
  SupportAttachment SupportAttachment[]
  users             User                @relation(fields: [senderId], references: [id], onDelete: Cascade)
  SupportTicket     SupportTicket       @relation(fields: [ticketId], references: [id], onDelete: Cascade)

  @@index([senderId])
  @@index([ticketId])
}

model SupportAttachment {
  id             String          @id
  filename       String
  originalName   String
  mimeType       String
  size           Int
  url            String
  ticketId       String?
  messageId      String?
  createdAt      DateTime        @default(now())
  SupportMessage SupportMessage? @relation(fields: [messageId], references: [id], onDelete: Cascade)
  SupportTicket  SupportTicket?  @relation(fields: [ticketId], references: [id], onDelete: Cascade)

  @@index([messageId])
  @@index([ticketId])
}

// TelegramConfig is defined in common.prisma

model TelegramScheduledMessage {
  id               String    @id @default(cuid())
  userbotConfigId  String
  companyId        String
  chatId           String
  message          String    @db.Text
  mediaUrl         String?
  mediaType        String?
  scheduledTime    DateTime
  status           String    @default("PENDING") // PENDING, SENT, FAILED
  sentAt           DateTime?
  error            String?   @db.Text
  recurring        Boolean   @default(false)
  recurringPattern String?
  createdBy        String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userbotConfigId])
  @@index([companyId])
  @@map("telegram_scheduled_messages")
}

model TelegramAutoReplyRule {
  id               String  @id @default(cuid())
  userbotConfigId  String
  isActive         Boolean @default(true)
  priority         Int     @default(0)
  response         String  @db.Text
  triggerType      String // KEYWORD, REGEX, ALL
  triggerValue     String  @db.Text
  workingHoursOnly Boolean @default(false)
  startTime        String? // "09:00"
  endTime          String? // "17:00"
  daysOfWeek       Json? // Array of Int [0-6]
  maxUsesPerUser   Int?
  cooldownMinutes  Int     @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userbotConfigId])
  @@map("telegram_auto_reply_rules")
}

model TelegramAutoReplyUsage {
  id     String   @id @default(cuid())
  ruleId String
  userId String
  usedAt DateTime @default(now())

  @@index([ruleId])
  @@index([userId])
  @@map("telegram_auto_reply_usage")
}

model TelegramBulkMessage {
  id                   String    @id @default(cuid())
  status               String    @default("PENDING") // PENDING, IN_PROGRESS, COMPLETED, FAILED
  recipients           Json // Array of strings (chatIds/usernames)
  message              String    @db.Text
  delayBetweenMessages Int       @default(1000) // ms
  sentCount            Int       @default(0)
  failedCount          Int       @default(0)
  startedAt            DateTime?
  completedAt          DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("telegram_bulk_messages")
}

model TelegramBulkMessageLog {
  id            String   @id @default(cuid())
  bulkMessageId String
  recipient     String
  status        String // SENT, FAILED
  error         String?  @db.Text
  sentAt        DateTime @default(now())

  @@index([bulkMessageId])
  @@map("telegram_bulk_message_logs")
}

model TelegramGroup {
  id              String  @id @default(cuid())
  userbotConfigId String
  companyId       String
  telegramId      String
  title           String
  type            String // GROUP, CHANNEL
  description     String? @db.Text
  isPublic        Boolean @default(false)
  managedByUs     Boolean @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([companyId])
  @@map("telegram_groups")
}

model TelegramContact {
  id              String  @id @default(cuid())
  userbotConfigId String
  companyId       String
  telegramId      String
  firstName       String?
  lastName        String?
  username        String?
  phone           String?
  isBot           Boolean @default(false)
  isPremium       Boolean @default(false)
  source          String?
  sourceGroupId   String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([telegramId, companyId], name: "telegramId_companyId")
  @@index([companyId])
  @@map("telegram_contacts")
}

model TelegramForwardRule {
  id               String  @id @default(cuid())
  isActive         Boolean @default(true)
  sourceChats      Json // Array of strings
  targetChat       String
  filterKeywords   Json? // Array of strings
  filterMediaTypes Json? // Array of strings
  forwardCount     Int     @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("telegram_forward_rules")
}
