model Company {
  id                              String                           @id
  name                            String
  email                           String                           @unique
  phone                           String?
  website                         String?
  logo                            String?
  address                         String?
  currency                        String                           @default("EGP")
  plan                            CompaniesPlan                    @default(BASIC)
  planConfigurationId             String?
  isActive                        Boolean                          @default(true)
  settings                        String?                          @db.Text
  createdAt                       DateTime                         @default(now())
  updatedAt                       DateTime
  slug                            String?                          @unique
  facebookUserAccessToken         String?                          @db.Text
  facebookPixelAccessToken        String?                          @db.Text
  useCentralKeys                  Boolean                          @default(false)
  facebookAdsAccessToken          String?                          @db.Text
  turboApiKey                     String?                          @db.Text
  turboAutoCreate                 Boolean                          @default(false)
  turboEnabled                    Boolean                          @default(false)
  turboWebhookUrl                 String?
  turboMainClientCode             Int?
  turboWebhookToken               String?                          @db.Text
  turboSenderNumber               String?
  sidebarLayout                   String                           @default("three-tier")
  customDomain                    String?                          @unique
  timezone                        String                           @default("Asia/Riyadh")
  geofenceEnabled                 Boolean                          @default(false)
  geofenceRadius                  Int?                             @default(200)
  officeLatitude                  Decimal?                         @db.Decimal(10, 8)
  officeLongitude                 Decimal?                         @db.Decimal(11, 8)
  platformCommissionRate          Float?                           @default(5)
  SupportTicket                   SupportTicket[]
  activity_logs                   ActivityLog[]
  affiliate_settings              AffiliateSetting?
  affiliates                      Affiliate[]
  aiInteractions                  AiInteraction[]
  aiKeies                         AiKey[]
  aiSettings                      AiSettings?
  aiTraces                        AiTrace[]
  appointments                    Appointment[]
  assetCategories                 AssetCategory[]
  assets                          Asset[]
  backInStockNotifications        BackInStockNotification[]
  branches                        Branche[]
  broadcastCampaigns              BroadcastCampaign[]
  broadcastSettings               BroadcastSettings?
  categories                      Category[]
  checkoutFormSettings            CheckoutFormSettings?
  commissions                     Commission[]
  planConfiguration               PlanConfiguration?               @relation(fields: [planConfigurationId], references: [id])
  conversationMemories            ConversationMemory[]
  conversationOutcomes            ConversationOutcome[]
  conversations                   Conversation[]
  conversion_events               ConversionEvent[]
  coupons                         Coupon[]
  customerLists                   CustomerList[]
  customerLoyaltyPrograms         CustomerLoyaltyProgram[]
  customerLoyaltyRecords          CustomerLoyaltyRecord[]
  customerLoyaltyTiers            CustomerLoyaltyTier[]
  customerNotificationPreferences CustomerNotificationPreference[]
  customers                       Customer[]

  dailyAnalytics                  DailyAnalytic[]
  deliveryOptions                 DeliveryOption[]
  employeeNotificationPreferences EmployeeNotificationPreference[]
  facebookAdAccounts              FacebookAdAccount[]
  facebookAdTests                 FacebookAdTest[]
  facebookCampaigns               FacebookCampaign[]
  facebookComments                FacebookComment[]
  facebookCustomAudiences         FacebookCustomAudience[]
  facebookDynamicAds              FacebookDynamicAd[]
  facebookLookalikeAudiences      FacebookLookalikeAudience[]
  facebookPages                   FacebookPage[]
  facebookProductCatalogs         FacebookProductCatalog[]
  faqs                            Faq[]
  footerSettings                  FooterSettings?
  guestCarts                      GuestCart[]
  guestOrders                     GuestOrder[]
  homepageTemplates               HomepageTemplate[]
  hrAdvanceRequests               HrAdvanceRequest[]
  hrAttendances                   HrAttendance[]
  hrHRAuditLogs                   HrHRAuditLog[]
  hrBenefitEnrollments            HrBenefitEnrollment[]
  hrBenefits                      HrBenefit[]
  hrDepartments                   HrDepartment[]
  hrEmployeeDocuments             HrEmployeeDocument[]
  hrEmployeeTrainings             HrEmployeeTraining[]
  hrEmployeeWarnings              HrEmployeeWarning[]
  hrFeedbacks                     HrFeedback[]
  hrGoals                         HrGoal[]
  hrKudos                         HrKudos[]
  hrLatenessBalances              HrLatenessBalance[]
  hrLeaveRequests                 HrLeaveRequest[]
  hrManualDeductions              HrManualDeduction[]
  hrPayrolls                      HrPayroll[]
  hrPerformanceReviews            HrPerformanceReview[]
  hrPositions                     HrPosition[]
  hrPromotions                    HrPromotion[]
  hr_resignations                 Resignation[]

  hrRewardEligibilityLogs HrRewardEligibilityLog[]
  hrRewardRecords         HrRewardRecord[]
  hrRewardSettings        HrRewardSettings?
  hrRewardTypes           HrRewardType[]
  hrSalaryHistories       HrSalaryHistory[]
  hrHRSettings            HrHRSettings?
  hrShiftAssignments      HrShiftAssignment[]
  hrShifts                HrShift[]
  imageGalleries          ImageGallery[]
  imageStudioHistories    ImageStudioHistory[]
  imageStudioUsages       ImageStudioUsage[]
  integrations            Integration[]
  invoices                Invoice[]
  lateWarnings            LateWarning[]
  learningDatas           LearningData[]
  learningSettings        LearningSettings?
  merchants               Merchant[]

  orderInvoiceSettings OrderInvoiceSettings?
  orderStatusConfigs   OrderStatusConfig[]
  orders               Order[]
  pageResponseSettings PageResponseSettings[]
  payments             Payment[]
  policies             Policy[]
  postResponseSettings PostResponseSettings[]
  postTrackings        PostTracking[]
  productAnalytics     ProductAnalytic[]
  productReviews       ProductReview[]
  productVisits        ProductVisit[]
  products             Product[]

  projects                        Project[]
  purchaseInvoices                PurchaseInvoice[]
  purchaseOrders                  PurchaseOrder[]
  recentlyVieweds                 RecentlyViewed[]
  responseEffectiveness           ResponseEffectiveness[]
  returnReasonCategories          ReturnReasonCategory[]
  returnReasons                   ReturnReason[]
  returnRequests                  ReturnRequest[]
  returnSettings                  ReturnSettings?
  sentMessageStats                SentMessageStat[]
  shippingZones                   ShippingZone[]
  storePages                      StorePage[]
  storePromotionSettings          StorePromotionSettings?
  storeVisits                     StoreVisit[]
  storefrontSettings              StorefrontSettings?
  subscriptions                   Subscription[]
  supplierPayments                SupplierPayment[]
  suppliers                       Supplier[]
  systemPrompts                   SystemPrompt[]
  taskActivities                  TaskActivity[]
  taskAttachments                 TaskAttachment[]
  taskCategories                  TaskCategory[]
  taskChecklists                  TaskChecklist[]
  taskComments                    TaskComment[]
  taskDependencies                TaskDependency[]
  taskNotifications               TaskNotification[]
  taskTemplates                   TaskTemplate[]
  taskWatchers                    TaskWatcher[]
  tasks                           Task[]
  telegramConfigs                 TelegramConfig[]
  textGalleries                   TextGallery[]
  time_entries                    TimeEntry[]
  userCompanies                   UserCompany[]
  dev_projects                    DevProject[]
  dev_team_members                DevTeamMember[]
  dev_tasks                       DevTask[]
  users                           User[]
  warehouses                      Warehouse[]
  whatsapp_notification_logs      WhatsAppNotificationLog[]
  whatsapp_notification_queue     WhatsAppNotificationQueue[]
  whatsapp_notification_settings  WhatsAppNotificationSettings?
  whatsapp_notification_templates WhatsAppNotificationTemplate[]
  whatsAppQuickReplies            WhatsAppQuickReply[]
  whatsAppSessions                WhatsAppSession[]
  whatsAppSettings                WhatsAppSettings?
  wishlists                       Wishlist[]
  woocommerceSettings             WoocommerceSettings?
  woocommerceSyncLogs             WoocommerceSyncLog[]
  installedApps                   CompanyApp[]
  wallet                          CompanyWallet?

  notifications                   Notification[]
  appReviews                      AppReview[]

  userInvitations UserInvitation[] @relation

  hrEmployees HrEmployee[] @relation

  customerWallets CustomerWallet[] @relation

  @@index([planConfigurationId])
  @@map("companies")
}

model User {
  id                                                String                   @id
  email                                             String                   @unique
  password                                          String
  firstName                                         String
  lastName                                          String
  avatar                                            String?
  phone                                             String?
  role                                              String?
  isActive                                          Boolean                  @default(true)
  isEmailVerified                                   Boolean                  @default(false)
  emailVerifiedAt                                   DateTime?
  lastLoginAt                                       DateTime?
  passwordChangedAt                                 DateTime?
  companyId                                         String?
  createdAt                                         DateTime                 @default(now())
  updatedAt                                         DateTime
  resetPasswordExpires                              DateTime?
  resetPasswordToken                                String?
  availability                                      String?                  @default("available")
  department                                        String?
  skills                                            String?                  @db.Text
  baseSalary                                        Decimal?                 @db.Decimal(12, 2)
  contractType                                      UsersContractType?
  departmentId                                      String?
  employeeNumber                                    String?
  hireDate                                          DateTime?
  positionId                                        String?
  timezone                                          String                   @default("Asia/Riyadh")
  enableAutoDeduction                               Boolean                  @default(true)
  lateDeductionRate                                 Decimal?                 @db.Decimal(10, 2)
  maxDailyLateMinutes                               Int?                     @default(10)
  monthlyGraceMinutes                               Int?                     @default(60)
  SupportMessage                                    SupportMessage[]
  SupportTicket_SupportTicket_assignedUserIdTousers SupportTicket[]          @relation("SupportTicket_assignedUserIdTousers")
  SupportTicket_SupportTicket_userIdTousers         SupportTicket[]          @relation("SupportTicket_userIdTousers")
  activities                                        Activity[]
  activity_logs                                     ActivityLog[]
  affiliates                                        Affiliate?
  callAttemptLogs                                   CallAttemptLog[]
  hrClearanceChecklists                             HrClearanceChecklist[]
  conversations                                     Conversation[]
  customerNotes                                     CustomerNote[]
  dev_team_members                                  DevTeamMember?
  guestOrders                                       GuestOrder[]
  hrAttendances                                     HrAttendance[]
  hrHRAuditLogs                                     HrHRAuditLog[]
  hr_kudos_hr_kudos_fromUserIdTousers               HrKudos[]                @relation("hr_kudos_fromUserIdTousers")
  hr_kudos_hr_kudos_toUserIdTousers                 HrKudos[]                @relation("hr_kudos_toUserIdTousers")
  hrRewardEligibilityLogs                           HrRewardEligibilityLog[]
  hrRewardRecords                                   HrRewardRecord[]
  hrShiftAssignments                                HrShiftAssignment[]
  imageGalleries                                    ImageGallery[]
  imageStudioHistories                              ImageStudioHistory[]
  messages                                          Message[]
  notifications                                     Notification[]
  orderNotes                                        OrderNote[]
  orders                                            Order[]                  @relation("OrderCreatedBy")
  projects                                          Project[]
  returnActivityLogs                                ReturnActivityLog[]
  returnContactAttempts                             ReturnContactAttempt[]
  returnRequests                                    ReturnRequest[]
  taskActivities                                    TaskActivity[]
  taskAttachments                                   TaskAttachment[]
  taskChecklistItems                                TaskChecklistItem[]
  taskComments                                      TaskComment[]
  taskNotifications                                 TaskNotification[]
  taskTemplates                                     TaskTemplate[]
  taskWatchers                                      TaskWatcher[]
  tasks_tasks_assignedToTousers                     Task[]                   @relation("tasks_assignedToTousers")
  tasks_tasks_createdByTousers                      Task[]                   @relation("tasks_createdByTousers")
  textGalleries                                     TextGallery[]
  time_entries                                      TimeEntry[]
  userCompanies                                     UserCompany[]
  userInvitations                                   UserInvitation[]
  company                                           Company?                 @relation(fields: [companyId], references: [id], onDelete: Cascade)
  hrDepartment                                      HrDepartment?            @relation(fields: [departmentId], references: [id])
  hrPosition                                        HrPosition?              @relation(fields: [positionId], references: [id])
  whatsAppMessages                                  WhatsAppMessage[]

  hrEmployees HrEmployee[] @relation
  Order       Order[]

  appReviews AppReview[]

  @@index([companyId])
  @@index([departmentId])
  @@index([positionId])
}

model UserCompany {
  id        String            @id
  userId    String
  companyId String
  role      UserCompaniesRole @default(AGENT)
  isActive  Boolean           @default(true)
  isDefault Boolean           @default(false)
  joinedAt  DateTime          @default(now())
  createdAt DateTime          @default(now())
  updatedAt DateTime
  company   Company           @relation(fields: [companyId], references: [id], onDelete: Cascade)
  user      User              @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, companyId])
  @@index([companyId])
  @@index([userId])
  @@map("user_companies")
}

model UserInvitation {
  id         String                @id
  email      String
  firstName  String
  lastName   String
  role       String                @default("AGENT")
  token      String                @unique
  status     UserInvitationsStatus @default(PENDING)
  invitedBy  String
  companyId  String
  expiresAt  DateTime
  acceptedAt DateTime?
  createdAt  DateTime              @default(now())
  updatedAt  DateTime
  company    Company               @relation(fields: [companyId], references: [id], onDelete: Cascade)
  user       User                  @relation(fields: [invitedBy], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([invitedBy])
  @@index([token])
  @@map("user_invitations")
}

model Activity {
  id          String    @id
  userId      String?
  customerId  String?
  action      String
  description String
  metadata    String?   @db.Text
  ipAddress   String?
  userAgent   String?
  createdAt   DateTime  @default(now())
  customers   Customer? @relation(fields: [customerId], references: [id])
  users       User?     @relation(fields: [userId], references: [id])

  @@index([customerId])
  @@index([userId])
  @@map("activities")
}

model ActivityLog {
  id           String   @id
  userId       String
  companyId    String
  category     String
  action       String
  description  String   @db.Text
  targetType   String?
  targetId     String?
  targetName   String?
  metadata     String?  @db.Text
  severity     String   @default("LOW")
  isSuccess    Boolean  @default(true)
  errorMessage String?  @db.Text
  tags         String?  @db.Text
  isLocked     Boolean  @default(true)
  createdAt    DateTime @default(now())
  updatedAt    DateTime
  company      Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([action])
  @@index([category])
  @@index([companyId, createdAt(sort: Desc)])
  @@index([companyId])
  @@index([createdAt(sort: Desc)])
  @@index([isSuccess])
  @@index([severity])
  @@index([userId, createdAt(sort: Desc)])
  @@index([userId])
  @@map("activity_logs")
}

model Integration {
  id          String    @id
  name        String
  type        String
  platform    String
  externalId  String
  accessToken String?   @db.Text
  config      String    @db.Text
  settings    String?   @db.Text
  status      String    @default("ACTIVE")
  isActive    Boolean   @default(true)
  lastSyncAt  DateTime?
  companyId   String
  createdAt   DateTime  @default(now())
  updatedAt   DateTime
  companies   Company   @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@unique([companyId, platform, externalId])
  @@map("integrations")
}

model Policy {
  id                   String    @id
  companyId            String
  title                String
  content              String    @db.Text
  category             String    @default("general")
  tags                 String?   @db.Text
  order                Int       @default(0)
  isActive             Boolean   @default(true)
  version              Int       @default(1)
  effectiveAt          DateTime  @default(now())
  expiresAt            DateTime?
  createdAt            DateTime  @default(now())
  updatedAt            DateTime
  embedding            String?   @db.Text
  embeddingGeneratedAt DateTime?
  companies            Company   @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([category])
  @@index([companyId])
  @@index([companyId, isActive, effectiveAt])
  @@index([isActive])
  @@map("policies")
}