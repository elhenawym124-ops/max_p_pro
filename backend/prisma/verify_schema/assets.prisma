model AssetAssignment {
  id              String          @id @default(cuid())
  assetId         String
  userId          String
  assignedBy      String? // User ID
  assignedAt      DateTime        @default(now())
  returnedAt      DateTime?
  returnCondition AssetCondition?
  notes           String?         @db.Text

  asset Asset @relation(fields: [assetId], references: [id], onDelete: Cascade)
  // user     User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  // assigner User?    @relation("AssetAssigner", fields: [assignedBy], references: [id])

  @@index([assetId])
  @@index([userId])
  @@index([assignedBy])
  @@map("asset_assignments")
}

model AssetCategory {
  id          String   @id @default(cuid())
  companyId   String
  name        String
  description String?  @db.Text
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  company Company @relation(fields: [companyId], references: [id], onDelete: Cascade)
  assets  Asset[]

  @@unique([companyId, name])
  @@index([companyId])
  @@map("asset_categories")
}

model AssetMaintenance {
  id             String    @id @default(cuid())
  assetId        String
  type           String // Repair, Maintenance, Upgrade
  description    String    @db.Text
  cost           Decimal?  @db.Decimal(12, 2)
  status         String // Scheduled, In Progress, Completed
  startDate      DateTime
  completionDate DateTime?
  performedBy    String? // Vendor or Person
  notes          String?   @db.Text
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  asset Asset @relation(fields: [assetId], references: [id], onDelete: Cascade)

  @@index([assetId])
  @@map("asset_maintenance")
}

model Asset {
  id            String         @id @default(cuid())
  companyId     String
  categoryId    String?
  name          String
  description   String?        @db.Text
  code          String? // Asset Tag/Number
  serialNumber  String?
  model         String?
  brand         String?
  status        AssetStatus    @default(AVAILABLE)
  condition     AssetCondition @default(NEW)
  purchaseDate  DateTime?
  purchaseValue Decimal?       @db.Decimal(12, 2)
  currency      String         @default("EGP")
  location      String?
  branchId      String? // Branch/Location
  image         String?
  notes         String?        @db.Text
  metadata      String?        @db.Text

  // Warranty fields
  warrantyStartDate DateTime?
  warrantyEndDate   DateTime?
  warrantyMonths    Int?
  warrantyProvider  String?

  // Depreciation fields
  depreciationMethod String?  @default("STRAIGHT_LINE") // STRAIGHT_LINE, DECLINING_BALANCE
  usefulLifeYears    Int?     @default(5)
  salvageValue       Decimal? @db.Decimal(12, 2)
  currentBookValue   Decimal? @db.Decimal(12, 2)

  assignedToId String? // Current holder (User)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  company        Company               @relation(fields: [companyId], references: [id], onDelete: Cascade)
  category       AssetCategory?        @relation(fields: [categoryId], references: [id])
  // currentHolder User?              @relation("CurrentAssetHolder", fields: [assignedToId], references: [id])
  assignments    AssetAssignment[]
  maintenance    AssetMaintenance[]
  custodyHistory AssetCustodyHistory[]
  requests       AssetRequest[]
  audits         AssetAudit[]
  attachments    AssetAttachment[]

  @@unique([companyId, code])
  @@index([companyId])
  @@index([categoryId])
  @@index([status])
  @@index([assignedToId])
  @@index([branchId])
  @@map("assets")
}

model AssetCustodyHistory {
  id              String          @id @default(cuid())
  assetId         String
  userId          String
  assignedBy      String?
  action          String // ASSIGNED, RETURNED, TRANSFERRED
  assignedAt      DateTime        @default(now())
  returnedAt      DateTime?
  returnCondition AssetCondition?
  notes           String?         @db.Text
  documentUrl     String? // PDF custody form
  signatureUrl    String? // Signature image
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt

  asset Asset @relation(fields: [assetId], references: [id], onDelete: Cascade)

  @@index([assetId])
  @@index([userId])
  @@index([assignedBy])
  @@map("asset_custody_history")
}

model AssetRequest {
  id              String             @id @default(cuid())
  companyId       String
  assetId         String?
  requestedBy     String // User ID
  assetType       String // Type of asset requested
  category        String?
  reason          String             @db.Text
  priority        String             @default("NORMAL") // LOW, NORMAL, HIGH, URGENT
  status          AssetRequestStatus @default(PENDING)
  approvedBy      String?
  approvedAt      DateTime?
  rejectedBy      String?
  rejectedAt      DateTime?
  rejectionReason String?            @db.Text
  fulfilledBy     String?
  fulfilledAt     DateTime?
  notes           String?            @db.Text
  createdAt       DateTime           @default(now())
  updatedAt       DateTime           @updatedAt

  asset Asset? @relation(fields: [assetId], references: [id])

  @@index([companyId])
  @@index([assetId])
  @@index([requestedBy])
  @@index([status])
  @@map("asset_requests")
}

model AssetAudit {
  id             String          @id @default(cuid())
  companyId      String
  assetId        String?
  auditName      String
  auditDate      DateTime
  status         String          @default("IN_PROGRESS") // IN_PROGRESS, COMPLETED
  conductedBy    String
  assetFound     Boolean?
  assetCondition AssetCondition?
  discrepancy    String?         @db.Text
  notes          String?         @db.Text
  completedAt    DateTime?
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt

  asset Asset? @relation(fields: [assetId], references: [id])

  @@index([companyId])
  @@index([assetId])
  @@index([status])
  @@map("asset_audits")
}

model AssetAttachment {
  id          String   @id @default(cuid())
  assetId     String
  type        String // IMAGE, INVOICE, WARRANTY, MANUAL, OTHER
  fileName    String
  fileUrl     String
  fileSize    Int?
  mimeType    String?
  description String?  @db.Text
  uploadedBy  String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  asset Asset @relation(fields: [assetId], references: [id], onDelete: Cascade)

  @@index([assetId])
  @@index([type])
  @@map("asset_attachments")
}