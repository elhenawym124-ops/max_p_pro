model Conversation {
  id                        String               @id
  customerId                String
  assignedUserId            String?
  channel                   ConversationsChannel
  status                    ConversationsStatus  @default(ACTIVE)
  subject                   String?
  priority                  Int                  @default(1)
  tags                      String?
  lastMessageAt             DateTime?
  lastMessagePreview        String?
  isRead                    Boolean              @default(false)
  metadata                  String?              @db.Text
  companyId                 String
  createdAt                 DateTime             @default(now())
  updatedAt                 DateTime
  aiEnabled                 Boolean              @default(true)
  lastMessageIsFromCustomer Boolean              @default(false)
  unreadCount               Int                  @default(0)
  broadcastRecipients       BroadcastRecipient[]
  users                     User?                @relation(fields: [assignedUserId], references: [id])
  companies                 Company              @relation(fields: [companyId], references: [id], onDelete: Cascade)
  customers                 Customer             @relation(fields: [customerId], references: [id], onDelete: Cascade)
  messages                  Message[]
  orders                    Order[]

  @@index([assignedUserId])
  @@index([companyId])
  @@index([companyId, lastMessageAt])
  @@index([companyId, status, lastMessageAt])
  @@index([customerId])
  @@index([lastMessageAt])
  @@index([status])
  @@index([companyId, lastMessageIsFromCustomer, status])
  @@map("conversations")
}

model PromptTemplate {
  id          String   @id
  companyId   String
  key         String
  content     String
  description String?
  category    String   @default("general")
  variables   String?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime

  @@unique([companyId, key])
  @@index([companyId])
}

model CheckoutFormSettings {
  id                     String   @id
  companyId              String   @unique
  showGuestName          Boolean  @default(true)
  requireGuestName       Boolean  @default(true)
  showGuestPhone         Boolean  @default(true)
  requireGuestPhone      Boolean  @default(true)
  showGuestEmail         Boolean  @default(true)
  requireGuestEmail      Boolean  @default(false)
  showCity               Boolean  @default(true)
  requireCity            Boolean  @default(true)
  showShippingAddress    Boolean  @default(true)
  requireShippingAddress Boolean  @default(true)
  showPaymentMethod      Boolean  @default(true)
  showNotes              Boolean  @default(true)
  createdAt              DateTime @default(now())
  updatedAt              DateTime
  companies              Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@map("checkout_form_settings")
}

model ConversationMemory {
  id             String   @id
  conversationId String
  senderId       String
  userMessage    String
  aiResponse     String
  intent         String?
  sentiment      String?
  timestamp      DateTime @default(now())
  metadata       String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime
  companyId      String
  companies      Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId, conversationId])
  @@index([companyId])
  @@index([companyId, senderId])
  @@index([conversationId])
  @@index([senderId])
  @@index([timestamp])
  @@map("conversation_memory")
}

model ConversationOutcome {
  id                   String   @id
  conversationId       String
  customerId           String
  companyId            String
  outcome              String
  outcomeValue         Float?
  responseQuality      Float?
  customerSatisfaction Float?
  conversionTime       Int?
  messageCount         Int?
  aiResponseCount      Int?
  humanHandoff         Boolean  @default(false)
  metadata             String?  @db.Text
  createdAt            DateTime @default(now())
  updatedAt            DateTime
  companies            Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  customers            Customer @relation(fields: [customerId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([conversationId])
  @@index([createdAt])
  @@index([customerId])
  @@index([outcome])
  @@map("conversation_outcomes")
}

model DevNotification {
  id               String        @id
  memberId         String
  taskId           String?
  projectId        String?
  type             String
  title            String
  message          String        @db.Text
  isRead           Boolean       @default(false)
  readAt           DateTime?
  link             String?
  createdAt        DateTime      @default(now())
  dev_team_members DevTeamMember @relation(fields: [memberId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([isRead])
  @@index([memberId])
  @@map("dev_notifications")
}

model DevProject {
  id               String              @id
  name             String
  description      String              @db.Text
  status           DevProjectsStatus   @default(PLANNING)
  priority         DevProjectsPriority @default(MEDIUM)
  color            String              @default("#6366f1")
  icon             String?
  startDate        DateTime?
  endDate          DateTime?
  progress         Int                 @default(0)
  managerId        String?
  teamMembers      String?             @db.LongText
  tags             String?             @db.LongText
  repository       String?
  createdAt        DateTime            @default(now())
  updatedAt        DateTime
  dev_team_members DevTeamMember?      @relation(fields: [managerId], references: [id])
  dev_releases     DevRelease[]
  dev_tasks        DevTask[]

  companyRel   Company? @relation(fields: [companyRelId], references: [id])
  companyRelId String?

  @@index([managerId])
  @@index([priority])
  @@index([status])
  @@map("dev_projects")
}

model DevRelease {
  id           String            @id
  version      String
  name         String
  description  String?           @db.Text
  status       DevReleasesStatus @default(PLANNING)
  releaseDate  DateTime?
  changelog    String?           @db.LongText
  projectId    String?
  createdAt    DateTime          @default(now())
  updatedAt    DateTime
  dev_projects DevProject?       @relation(fields: [projectId], references: [id])
  dev_tasks    DevTask[]

  @@index([projectId])
  @@index([releaseDate])
  @@index([status])
  @@map("dev_releases")
}

model DevTaskActivity {
  id               String         @id
  taskId           String
  memberId         String?
  action           String
  field            String?
  oldValue         String?        @db.Text
  newValue         String?        @db.Text
  description      String?        @db.Text
  createdAt        DateTime       @default(now())
  dev_team_members DevTeamMember? @relation(fields: [memberId], references: [id])
  dev_tasks        DevTask        @relation(fields: [taskId], references: [id], onDelete: Cascade)

  @@index([action])
  @@index([createdAt])
  @@index([memberId])
  @@index([taskId])
  @@map("dev_task_activities")
}

model DevTaskAttachment {
  id           String   @id
  taskId       String
  fileName     String
  originalName String
  fileSize     Int
  fileType     String
  filePath     String
  uploadedBy   String
  createdAt    DateTime @default(now())
  dev_tasks    DevTask  @relation(fields: [taskId], references: [id], onDelete: Cascade)

  @@index([taskId])
  @@map("dev_task_attachments")
}

model DevTaskChecklistItem {
  id               String           @id
  checklistId      String
  content          String
  isCompleted      Boolean          @default(false)
  completedAt      DateTime?
  completedBy      String?
  position         Int              @default(0)
  createdAt        DateTime         @default(now())
  updatedAt        DateTime
  devTaskChecklist DevTaskChecklist @relation(fields: [checklistId], references: [id], onDelete: Cascade)

  @@index([checklistId])
  @@map("dev_task_checklist_items")
}

model DevTaskChecklist {
  id                    String                 @id
  taskId                String
  title                 String
  position              Int                    @default(0)
  createdAt             DateTime               @default(now())
  updatedAt             DateTime
  devTaskChecklistItems DevTaskChecklistItem[]
  dev_tasks             DevTask                @relation(fields: [taskId], references: [id], onDelete: Cascade)

  @@index([taskId])
  @@map("dev_task_checklists")
}

model DevTaskComment {
  id                      String           @id
  taskId                  String
  authorId                String
  content                 String           @db.Text
  parentCommentId         String?
  mentions                String?          @db.LongText
  isEdited                Boolean          @default(false)
  editedAt                DateTime?
  createdAt               DateTime         @default(now())
  updatedAt               DateTime
  dev_team_members        DevTeamMember    @relation(fields: [authorId], references: [id])
  devTaskComment          DevTaskComment?  @relation("dev_task_commentsTodev_task_comments", fields: [parentCommentId], references: [id])
  other_dev_task_comments DevTaskComment[] @relation("dev_task_commentsTodev_task_comments")
  dev_tasks               DevTask          @relation(fields: [taskId], references: [id], onDelete: Cascade)

  @@index([authorId])
  @@index([parentCommentId])
  @@index([taskId])
  @@map("dev_task_comments")
}

model DevTaskWatcher {
  id               String        @id
  taskId           String
  memberId         String
  createdAt        DateTime      @default(now())
  dev_team_members DevTeamMember @relation(fields: [memberId], references: [id], onDelete: Cascade)
  dev_tasks        DevTask       @relation(fields: [taskId], references: [id], onDelete: Cascade)

  @@unique([taskId, memberId])
  @@index([memberId])
  @@index([taskId])
  @@map("dev_task_watchers")
}

model DevTask {
  id                                                      String              @id
  title                                                   String
  description                                             String              @db.Text
  type                                                    DevTaskType         @default(FEATURE)
  status                                                  DevTasksStatus      @default(BACKLOG)
  priority                                                DevTasksPriority    @default(MEDIUM)
  component                                               String?
  assigneeId                                              String?
  reporterId                                              String
  projectId                                               String?
  releaseId                                               String?
  parentTaskId                                            String?
  order                                                   Int                 @default(0)
  dueDate                                                 DateTime?
  startDate                                               DateTime?
  completedDate                                           DateTime?
  estimatedHours                                          Float               @default(0)
  actualHours                                             Float               @default(0)
  progress                                                Int                 @default(0)
  tags                                                    String?             @db.LongText
  labels                                                  String?             @db.LongText
  gitBranch                                               String?
  gitPR                                                   String?
  companyId                                               String?
  ticketId                                                String?
  createdAt                                               DateTime            @default(now())
  updatedAt                                               DateTime
  acceptanceCriteria                                      String?             @db.Text
  businessValue                                           String?             @db.Text
  xpEarned                                                Int?
  relatedLinks                                            String?             @db.LongText
  devTaskActivities                                       DevTaskActivity[]
  devTaskAttachments                                      DevTaskAttachment[]
  devTaskChecklists                                       DevTaskChecklist[]
  devTaskComments                                         DevTaskComment[]
  devTaskWatchers                                         DevTaskWatcher[]
  dev_team_members_dev_tasks_assigneeIdTodev_team_members DevTeamMember?      @relation("dev_tasks_assigneeIdTodev_team_members", fields: [assigneeId], references: [id])
  dev_tasks                                               DevTask?            @relation("dev_tasksTodev_tasks", fields: [parentTaskId], references: [id])
  other_dev_tasks                                         DevTask[]           @relation("dev_tasksTodev_tasks")
  dev_projects                                            DevProject?         @relation(fields: [projectId], references: [id])
  dev_releases                                            DevRelease?         @relation(fields: [releaseId], references: [id])
  dev_team_members_dev_tasks_reporterIdTodev_team_members DevTeamMember       @relation("dev_tasks_reporterIdTodev_team_members", fields: [reporterId], references: [id])
  devTimeLogs                                             DevTimeLog[]

  companyRel   Company? @relation(fields: [companyRelId], references: [id])
  companyRelId String?

  @@index([assigneeId])
  @@index([component])
  @@index([dueDate])
  @@index([order])
  @@index([parentTaskId])
  @@index([priority])
  @@index([projectId])
  @@index([releaseId])
  @@index([reporterId])
  @@index([status])
  @@index([type])
  @@map("dev_tasks")
}

model ExcludedModel {
  id          String    @id
  modelName   String
  keyId       String?
  companyId   String?
  reason      String
  excludedAt  DateTime  @default(now())
  retryAt     DateTime
  retryCount  Int       @default(0)
  lastRetryAt DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime

  @@index([companyId])
  @@index([modelName, keyId])
  @@index([retryAt])
  @@map("excluded_models")
}

model FewShotExample {
  id              String    @id
  companyId       String
  customerMessage String    @db.Text
  aiResponse      String    @db.Text
  category        String?
  tags            String?   @db.Text
  priority        Int       @default(0)
  isActive        Boolean   @default(true)
  usageCount      Int       @default(0)
  lastUsedAt      DateTime?
  notes           String?   @db.Text
  createdAt       DateTime  @default(now())
  updatedAt       DateTime

  @@index([category])
  @@index([companyId])
  @@index([isActive])
  @@index([priority])
  @@map("few_shot_examples")
}

model FewShotSettings {
  id                   String   @id
  companyId            String   @unique
  enabled              Boolean  @default(false)
  maxExamplesPerPrompt Int      @default(3)
  selectionStrategy    String   @default("priority")
  autoLearnFromGood    Boolean  @default(false)
  minQualityScore      Float    @default(80)
  createdAt            DateTime @default(now())
  updatedAt            DateTime

  @@map("few_shot_settings")
}

model FooterSettings {
  id             String   @id
  companyId      String   @unique
  aboutStore     String?  @db.Text
  showAboutStore Boolean  @default(true)
  email          String?
  showEmail      Boolean  @default(true)
  phone          String?
  showPhone      Boolean  @default(true)
  address        String?  @db.Text
  showAddress    Boolean  @default(true)
  showQuickLinks Boolean  @default(true)
  copyrightText  String?  @db.Text
  showCopyright  Boolean  @default(true)
  createdAt      DateTime @default(now())
  updatedAt      DateTime
  companies      Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@map("footer_settings")
}

model GlobalAiConfig {
  id              String                         @id
  defaultProvider GlobalAiConfigsDefaultProvider @default(GOOGLE)
  isActive        Boolean                        @default(true)
  settings        String?                        @db.Text
  createdAt       DateTime                       @default(now())
  updatedAt       DateTime
  enableFailover  Boolean                        @default(true)

  @@map("global_ai_configs")
}

model HomepageTemplate {
  id          String   @id
  companyId   String
  name        String
  description String?  @db.Text
  content     String   @db.LongText
  thumbnail   String?  @db.Text
  isActive    Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime
  companies   Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([isActive])
  @@map("homepage_templates")
}

model ImageGallery {
  id        String   @id
  userId    String
  companyId String
  filename  String
  fileUrl   String
  fileType  String
  fileSize  Int
  createdAt DateTime @default(now())
  updatedAt DateTime
  companies Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  users     User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([createdAt])
  @@index([userId])
  @@map("image_gallery")
}

model Inventory {
  id              String    @id
  productId       String
  warehouseId     String
  quantity        Int       @default(0)
  reserved        Int       @default(0)
  available       Int       @default(0)
  minStock        Int       @default(0)
  maxStock        Int?
  reorderPoint    Int       @default(0)
  reorderQuantity Int       @default(0)
  cost            Decimal?  @db.Decimal(10, 2)
  createdAt       DateTime  @default(now())
  updatedAt       DateTime
  batchNumber     String?
  expiryDate      DateTime?
  products        Product   @relation(fields: [productId], references: [id], onDelete: Cascade)
  warehouse       Warehouse @relation(fields: [warehouseId], references: [id], onDelete: Cascade)

  @@unique([productId, warehouseId, batchNumber])
  @@index([productId])
  @@index([warehouseId])
  @@map("inventory")
}

model KnowledgeBase {
  id        String   @id
  title     String
  content   String
  category  String
  tags      String?
  isActive  Boolean  @default(true)
  priority  Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime

  @@index([category])
  @@index([isActive])
  @@map("knowledge_base")
}

model MediaFile {
  id             String   @id
  conversationId String
  senderId       String
  fileName       String
  fileType       String
  fileSize       Int?
  fileUrl        String
  analysis       String?
  processed      Boolean  @default(false)
  createdAt      DateTime @default(now())

  @@index([conversationId])
  @@index([fileType])
  @@map("media_files")
}

model Message {
  id             String       @id
  conversationId String
  senderId       String?
  type           MessageType  @default(TEXT)
  content        String       @db.Text
  attachments    String?      @db.Text
  metadata       String?      @db.Text
  isFromCustomer Boolean      @default(true)
  isRead         Boolean      @default(false)
  readAt         DateTime?
  createdAt      DateTime     @default(now())
  updatedAt      DateTime
  conversation   Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  users          User?        @relation(fields: [senderId], references: [id])

  @@index([conversationId, isFromCustomer, createdAt])
  @@index([conversationId])
  @@index([conversationId, createdAt])
  @@index([createdAt])
  @@index([isFromCustomer])
  @@index([senderId])
  @@map("messages")
}

model Notification {
  id        String    @id @default(cuid())
  title     String
  message   String
  type      String
  data      Json?
  isRead    Boolean   @default(false)
  readAt    DateTime?
  createdAt DateTime  @default(now())

  userId    String?
  companyId String

  user    User?   @relation(fields: [userId], references: [id])
  company Company @relation(fields: [companyId], references: [id])

  @@index([companyId])
  @@index([userId])
  @@map("notifications")
}

model PageResponseSettings {
  id                    String   @id
  pageId                String
  companyId             String
  responseMethod        String
  fixedMessengerMessage String?  @db.Text
  aiPrompt              String?  @db.Text
  createdAt             DateTime @default(now())
  updatedAt             DateTime
  commentMessages       String?  @db.Text
  companies             Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@unique([pageId, companyId])
  @@index([companyId])
  @@index([pageId])
  @@map("page_response_settings")
}

model PlanConfiguration {
  id            String    @id
  planType      String    @unique
  price         Float
  currency      String    @default("EGP")
  billingCycle  String    @default("monthly")
  features      String    @db.LongText
  description   String?
  descriptionEn String?
  isActive      Boolean   @default(true)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime
  companies     Company[]

  @@map("plan_configurations")
}

model PostResponseSettings {
  id                    String   @id
  postId                String
  companyId             String
  responseMethod        String
  createdAt             DateTime @default(now())
  updatedAt             DateTime
  aiPrompt              String?  @db.Text
  fixedMessengerMessage String?  @db.Text
  commentMessages       String?  @db.Text
  featuredProductId     String?
  companies             Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  products              Product? @relation(fields: [featuredProductId], references: [id])

  @@unique([postId, companyId])
  @@index([companyId])
  @@index([featuredProductId])
  @@index([postId])
  @@map("post_response_settings")
}

model PostTracking {
  id           String   @id
  postId       String
  companyId    String
  visitCount   Int      @default(1)
  firstVisitAt DateTime @default(now())
  lastVisitAt  DateTime @default(now())
  createdAt    DateTime @default(now())
  updatedAt    DateTime
  companies    Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@unique([postId, companyId])
  @@index([companyId])
  @@index([lastVisitAt])
  @@index([postId])
  @@map("post_tracking")
}

model Project {
  id          String           @id
  name        String
  description String           @db.Text
  status      ProjectsStatus   @default(PLANNING)
  priority    ProjectsPriority @default(MEDIUM)
  startDate   DateTime?
  endDate     DateTime?
  budget      Decimal?         @db.Decimal(10, 2)
  spentBudget Decimal?         @default(0.00) @db.Decimal(10, 2)
  progress    Int              @default(0)
  managerId   String
  teamMembers String?          @db.LongText
  tags        String?          @db.LongText
  companyId   String
  createdAt   DateTime         @default(now())
  updatedAt   DateTime
  companies   Company          @relation(fields: [companyId], references: [id], onDelete: Cascade)
  users       User             @relation(fields: [managerId], references: [id])
  tasks       Task[]

  @@index([companyId])
  @@index([managerId])
  @@index([priority])
  @@index([status])
}

model PromptLibrary {
  id             String   @id
  name           String
  nameAr         String?
  description    String   @db.Text
  descriptionAr  String?  @db.Text
  category       String
  businessType   String?
  promptContent  String   @db.Text
  responsePrompt String?  @db.Text
  variables      String?  @db.Text
  tags           String?  @db.Text
  icon           String?
  previewImage   String?
  isActive       Boolean  @default(true)
  isFeatured     Boolean  @default(false)
  usageCount     Int      @default(0)
  rating         Float    @default(0)
  sortOrder      Int      @default(0)
  createdBy      String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime

  @@index([businessType])
  @@index([category])
  @@index([isActive])
  @@index([isFeatured])
  @@map("prompt_library")
}

model RecentlyViewed {
  id        String   @id
  sessionId String
  productId String
  companyId String
  viewedAt  DateTime @default(now())
  companies Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  products  Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([sessionId, productId, companyId])
  @@index([companyId])
  @@index([productId])
  @@index([sessionId, companyId])
  @@index([viewedAt])
  @@map("recently_viewed")
}

model ResponseEffectiveness {
  id                 String   @id
  companyId          String
  messageId          String?
  conversationId     String
  responseText       String   @db.Text
  responseType       String
  customerReaction   String?
  effectivenessScore Float
  leadToPurchase     Boolean  @default(false)
  responseTime       Int?
  wordCount          Int?
  sentimentScore     Float?
  keywords           String?  @db.Text
  metadata           String?  @db.Text
  createdAt          DateTime @default(now())
  companies          Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([conversationId])
  @@index([createdAt])
  @@index([effectivenessScore])
  @@index([leadToPurchase])
  @@index([responseType])
  @@map("response_effectiveness")
}

model SentMessageStat {
  id                    String    @id
  companyId             String
  facebookPageId        String?
  recipientFacebookId   String
  recipientCustomerId   String?
  messageId             String    @unique
  messageContent        String?   @db.Text
  messageType           String?
  messageStatus         String
  ignoredReason         String?
  conversationId        String?
  conversationStatus    String?
  sentAt                DateTime  @default(now())
  savedAt               DateTime?
  conversationCreatedAt DateTime?
  createdAt             DateTime  @default(now())
  updatedAt             DateTime
  companies             Company   @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([companyId, sentAt])
  @@index([conversationStatus])
  @@index([messageStatus])
  @@index([recipientFacebookId])
  @@index([sentAt])
  @@map("sent_message_stats")
}

model SkippedFacebookPage {
  id                   String    @id
  pageId               String
  pageName             String
  reason               String
  attemptedCompanyId   String
  connectedToCompanyId String?
  isResolved           Boolean   @default(false)
  resolvedAt           DateTime?
  createdAt            DateTime  @default(now())
  updatedAt            DateTime

  @@index([attemptedCompanyId])
  @@index([createdAt])
  @@index([isResolved])
  @@map("skipped_facebook_pages")
}

model DevSystemSettings {
  id        String   @id
  key       String   @unique @default("default")
  value     String   @db.LongText
  group     String   @default("general")
  createdAt DateTime @default(now())
  updatedAt DateTime

  @@map("dev_system_settings")
}

model StorePage {
  id              String             @id
  companyId       String
  title           String
  slug            String
  content         String             @db.Text
  pageType        StorePagesPageType @default(CUSTOM)
  isActive        Boolean            @default(true)
  showInFooter    Boolean            @default(true)
  showInMenu      Boolean            @default(false)
  order           Int                @default(0)
  metaTitle       String?
  metaDescription String?            @db.Text
  createdAt       DateTime           @default(now())
  updatedAt       DateTime
  companies       Company            @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@unique([companyId, slug])
  @@index([companyId])
  @@index([isActive])
  @@index([slug])
  @@map("store_pages")
}

model StorePromotionSettings {
  id                    String   @id
  companyId             String   @unique
  freeShippingEnabled   Boolean  @default(false)
  freeShippingThreshold Decimal  @default(0.00) @db.Decimal(10, 2)
  freeShippingMessage   String?  @db.Text
  createdAt             DateTime @default(now())
  updatedAt             DateTime
  companies             Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@map("store_promotion_settings")
}

model StorefrontSettings {
  id                               String                @id
  companyId                        String                @unique
  quickViewEnabled                 Boolean               @default(true)
  quickViewShowAddToCart           Boolean               @default(true)
  quickViewShowWishlist            Boolean               @default(true)
  comparisonEnabled                Boolean               @default(true)
  maxComparisonProducts            Int                   @default(4)
  comparisonShowPrice              Boolean               @default(true)
  comparisonShowSpecs              Boolean               @default(true)
  wishlistEnabled                  Boolean               @default(true)
  wishlistRequireLogin             Boolean               @default(false)
  wishlistMaxItems                 Int                   @default(100)
  advancedFiltersEnabled           Boolean               @default(true)
  filterByPrice                    Boolean               @default(true)
  filterByRating                   Boolean               @default(true)
  filterByBrand                    Boolean               @default(false)
  filterByAttributes               Boolean               @default(true)
  reviewsEnabled                   Boolean               @default(true)
  reviewsRequirePurchase           Boolean               @default(false)
  reviewsModerationEnabled         Boolean               @default(true)
  reviewsShowRating                Boolean               @default(true)
  minRatingToDisplay               Int                   @default(1)
  countdownEnabled                 Boolean               @default(true)
  countdownShowOnProduct           Boolean               @default(true)
  countdownShowOnListing           Boolean               @default(false)
  backInStockEnabled               Boolean               @default(true)
  backInStockNotifyEmail           Boolean               @default(true)
  backInStockNotifySMS             Boolean               @default(false)
  recentlyViewedEnabled            Boolean               @default(true)
  recentlyViewedCount              Int                   @default(8)
  recentlyViewedDays               Int                   @default(30)
  imageZoomEnabled                 Boolean               @default(true)
  imageZoomType                    String                @default("hover")
  productVideosEnabled             Boolean               @default(true)
  videoAutoplay                    Boolean               @default(false)
  videoShowControls                Boolean               @default(true)
  sizeGuideEnabled                 Boolean               @default(true)
  sizeGuideShowOnProduct           Boolean               @default(true)
  socialSharingEnabled             Boolean               @default(true)
  shareFacebook                    Boolean               @default(true)
  shareTwitter                     Boolean               @default(true)
  shareWhatsApp                    Boolean               @default(true)
  shareTelegram                    Boolean               @default(true)
  badgesEnabled                    Boolean               @default(true)
  badgeNew                         Boolean               @default(true)
  badgeBestSeller                  Boolean               @default(true)
  badgeOnSale                      Boolean               @default(true)
  badgeOutOfStock                  Boolean               @default(true)
  tabsEnabled                      Boolean               @default(true)
  tabDescription                   Boolean               @default(true)
  tabSpecifications                Boolean               @default(true)
  tabReviews                       Boolean               @default(true)
  tabShipping                      Boolean               @default(true)
  stickyAddToCartEnabled           Boolean               @default(true)
  stickyShowOnMobile               Boolean               @default(true)
  stickyShowOnDesktop              Boolean               @default(true)
  seoEnabled                       Boolean               @default(true)
  seoMetaDescription               Boolean               @default(true)
  seoStructuredData                Boolean               @default(true)
  seoSitemap                       Boolean               @default(true)
  seoOpenGraph                     Boolean               @default(true)
  multiLanguageEnabled             Boolean               @default(false)
  defaultLanguage                  String                @default("ar")
  supportedLanguages               String                @db.LongText
  createdAt                        DateTime              @default(now())
  updatedAt                        DateTime
  capiStatus                       String?               @default("not_configured")
  capiTrackAddToCart               Boolean               @default(true)
  capiTrackInitiateCheckout        Boolean               @default(true)
  capiTrackPageView                Boolean               @default(true)
  capiTrackPurchase                Boolean               @default(true)
  capiTrackSearch                  Boolean               @default(true)
  capiTrackViewContent             Boolean               @default(true)
  eventDeduplicationEnabled        Boolean               @default(true)
  eventMatchQualityTarget          Int                   @default(8)
  facebookConvApiEnabled           Boolean               @default(false)
  facebookConvApiTestCode          String?
  facebookConvApiToken             String?               @db.Text
  facebookPixelEnabled             Boolean               @default(false)
  facebookPixelId                  String?
  gdprCompliant                    Boolean               @default(true)
  hashUserData                     Boolean               @default(true)
  lastCapiTest                     DateTime?
  lastPixelTest                    DateTime?
  pixelStatus                      String?               @default("not_configured")
  pixelTrackAddToCart              Boolean               @default(true)
  pixelTrackAddToWishlist          Boolean               @default(false)
  pixelTrackInitiateCheckout       Boolean               @default(true)
  pixelTrackPageView               Boolean               @default(true)
  pixelTrackPurchase               Boolean               @default(true)
  pixelTrackSearch                 Boolean               @default(true)
  pixelTrackViewContent            Boolean               @default(true)
  stickyAutoScrollToCheckout       Boolean               @default(false)
  stickyScrollThreshold            Int                   @default(300)
  stickyShowBuyNow                 Boolean               @default(true)
  stickyTrackAnalytics             Boolean               @default(true)
  stickyShowAddToCartButton        Boolean               @default(true)
  stickyShowProductImage           Boolean               @default(true)
  stickyShowProductName            Boolean               @default(true)
  stickyShowQuantity               Boolean               @default(true)
  badgeBuyerProtection             Boolean               @default(true)
  badgeCashOnDelivery              Boolean               @default(true)
  badgeCustom1                     Boolean               @default(false)
  badgeCustom1Text                 String?
  badgeCustom2                     Boolean               @default(false)
  badgeCustom2Text                 String?
  badgeFreeShipping                Boolean               @default(true)
  badgeHighRating                  Boolean               @default(true)
  badgeLayout                      String                @default("horizontal")
  badgeQualityGuarantee            Boolean               @default(true)
  badgeSecurePayment               Boolean               @default(true)
  keyboardShortcuts                Boolean               @default(true)
  navigationEnabled                Boolean               @default(false)
  navigationType                   String                @default("sameCategory")
  onlineVisitorsEnabled            Boolean               @default(false)
  onlineVisitorsMax                Int                   @default(50)
  onlineVisitorsMin                Int                   @default(5)
  onlineVisitorsText               String                @default("{count} شخص يشاهدون هذا المنتج الآن")
  onlineVisitorsType               String                @default("fake")
  onlineVisitorsUpdateInterval     Int                   @default(30)
  reasonsToPurchaseEnabled         Boolean               @default(false)
  reasonsToPurchaseList            String?               @db.Text
  reasonsToPurchaseMaxItems        Int                   @default(4)
  reasonsToPurchaseStyle           String                @default("list")
  reasonsToPurchaseType            String                @default("global")
  securityBadgesEnabled            Boolean               @default(false)
  showNavigationButtons            Boolean               @default(true)
  soldNumberEnabled                Boolean               @default(false)
  soldNumberMax                    Int                   @default(500)
  soldNumberMin                    Int                   @default(10)
  soldNumberText                   String                @default("تم بيع {count} قطعة")
  soldNumberType                   String                @default("real")
  stockProgressEnabled             Boolean               @default(false)
  stockProgressHighColor           String                @default("#10b981")
  stockProgressLowColor            String                @default("#ef4444")
  stockProgressMediumColor         String                @default("#f59e0b")
  stockProgressThreshold           Int                   @default(10)
  stockProgressType                String                @default("percentage")
  variantColorShowName             Boolean               @default(true)
  variantColorSize                 String                @default("medium")
  variantColorStyle                String                @default("buttons")
  variantSizeShowGuide             Boolean               @default(false)
  variantSizeShowStock             Boolean               @default(true)
  variantSizeStyle                 String                @default("buttons")
  estimatedDeliveryDefaultText     String                @default("التوصيل خلال {time}")
  estimatedDeliveryEnabled         Boolean               @default(false)
  estimatedDeliveryShowOnProduct   Boolean               @default(true)
  fomoDelay                        Int                   @default(30)
  fomoEnabled                      Boolean               @default(false)
  fomoMessage                      String?               @db.Text
  fomoShowOncePerSession           Boolean               @default(true)
  fomoTrigger                      String                @default("time")
  fomoType                         String                @default("soldCount")
  productPageLayoutEnabled         Boolean               @default(false)
  productPageOrder                 String?               @db.Text
  productPageShowActions           Boolean               @default(true)
  productPageShowBackInStock       Boolean               @default(true)
  productPageShowBadges            Boolean               @default(true)
  productPageShowCategory          Boolean               @default(true)
  productPageShowCheckoutForm      Boolean               @default(true)
  productPageShowCountdown         Boolean               @default(true)
  productPageShowDescription       Boolean               @default(true)
  productPageShowEstimatedDelivery Boolean               @default(true)
  productPageShowFreeShipping      Boolean               @default(true)
  productPageShowOnlineVisitors    Boolean               @default(true)
  productPageShowPreOrder          Boolean               @default(true)
  productPageShowPrice             Boolean               @default(true)
  productPageShowQuantity          Boolean               @default(true)
  productPageShowReasonsToPurchase Boolean               @default(true)
  productPageShowSKU               Boolean               @default(true)
  productPageShowSecurityBadges    Boolean               @default(true)
  productPageShowSizeGuide         Boolean               @default(true)
  productPageShowSocialSharing     Boolean               @default(true)
  productPageShowSoldNumber        Boolean               @default(true)
  productPageShowStockProgress     Boolean               @default(true)
  productPageShowStockStatus       Boolean               @default(true)
  productPageShowTabs              Boolean               @default(true)
  productPageShowTitle             Boolean               @default(true)
  productPageShowVariants          Boolean               @default(true)
  productPageShowVolumeDiscounts   Boolean               @default(true)
  galleryLayout                    String                @default("bottom")
  galleryStyle                     String                @default("slider")
  imageBorderRadius                Int                   @default(8)
  imageHoverEffect                 String                @default("zoom")
  imageLoadingEffect               String                @default("skeleton")
  imagePlaceholder                 String                @default("?")
  imageShadow                      Boolean               @default(true)
  lightboxBackgroundColor          String                @default("rgba(0,0,0,0.9)")
  lightboxCloseOnOverlay           Boolean               @default(true)
  lightboxEnabled                  Boolean               @default(true)
  lightboxKeyboardNav              Boolean               @default(true)
  lightboxShowArrows               Boolean               @default(true)
  lightboxShowCounter              Boolean               @default(true)
  lightboxShowThumbnails           Boolean               @default(true)
  lightboxZoomEnabled              Boolean               @default(true)
  mainImageAspectRatio             String                @default("1:1")
  mobileFullscreenOnTap            Boolean               @default(true)
  mobileGalleryLayout              String                @default("slider")
  mobilePinchZoom                  Boolean               @default(true)
  mobileShowThumbnails             Boolean               @default(false)
  mobileSwipeEnabled               Boolean               @default(true)
  mouseWheelZoom                   Boolean               @default(false)
  sliderAutoplay                   Boolean               @default(false)
  sliderAutoplaySpeed              Int                   @default(3000)
  sliderEnabled                    Boolean               @default(true)
  sliderInfiniteLoop               Boolean               @default(true)
  sliderShowArrows                 Boolean               @default(true)
  sliderShowDots                   Boolean               @default(false)
  sliderTransitionEffect           String                @default("slide")
  sliderTransitionSpeed            Int                   @default(300)
  thumbnailBorderRadius            Int                   @default(8)
  thumbnailSize                    String                @default("medium")
  thumbnailSpacing                 Int                   @default(8)
  thumbnailsPerRow                 Int                   @default(4)
  variationImagesAnimation         String                @default("fade")
  variationImagesBehavior          String                @default("replace")
  variationImagesEnabled           Boolean               @default(true)
  videoMuted                       Boolean               @default(true)
  videoPlayMode                    String                @default("inline")
  videoPosition                    String                @default("end")
  videoSources                     String                @default("[\"youtube\", \"vimeo\", \"self-hosted\"]")
  videoThumbnailIcon               Boolean               @default(true)
  view360AutoRotate                Boolean               @default(true)
  view360Enabled                   Boolean               @default(false)
  view360RotateSpeed               Int                   @default(5)
  view360ShowControls              Boolean               @default(true)
  zoomLensShape                    String                @default("square")
  zoomLensSize                     Int                   @default(150)
  zoomLevel                        Float                 @default(2.5)
  zoomStyle                        String                @default("side")
  zoomWindowPosition               String                @default("right")
  zoomWindowSize                   Int                   @default(400)
  mobileBottomNavbarEnabled        Boolean               @default(true)
  mobileBottomNavbarShowAccount    Boolean               @default(true)
  mobileBottomNavbarShowCart       Boolean               @default(false)
  mobileBottomNavbarShowCompare    Boolean               @default(true)
  mobileBottomNavbarShowHome       Boolean               @default(true)
  mobileBottomNavbarShowSearch     Boolean               @default(false)
  mobileBottomNavbarShowShop       Boolean               @default(true)
  mobileBottomNavbarShowWishlist   Boolean               @default(true)
  facebookPixelConfigs             FacebookPixelConfig[]
  companies                        Company               @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([facebookConvApiEnabled])
  @@index([facebookPixelEnabled])
  @@map("storefront_settings")
}

model Subscription {
  id              String                @id
  companyId       String
  planType        SubscriptionsPlanType
  status          SubscriptionsStatus   @default(ACTIVE)
  startDate       DateTime              @default(now())
  endDate         DateTime?
  nextBillingDate DateTime?
  billingCycle    String                @default("monthly")
  price           Float
  currency        String                @default("EGP")
  autoRenew       Boolean               @default(true)
  trialEndDate    DateTime?
  cancelledAt     DateTime?
  cancelReason    String?
  metadata        String?               @db.LongText
  createdAt       DateTime              @default(now())
  updatedAt       DateTime
  invoices        Invoice[]
  payments        Payment[]
  companies       Company               @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@map("subscriptions")
}

model SystemPrompt {
  id        String   @id
  name      String
  content   String   @db.Text
  category  String   @default("general")
  isActive  Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime
  companyId String?
  companies Company? @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@map("system_prompts")
}

model SystemSettings {
  id               String    @id
  systemName       String    @unique
  displayName      String
  description      String?
  category         String    @default("general")
  isEnabled        Boolean   @default(true)
  config           String?   @db.LongText
  resourceUsage    String?   @db.LongText
  lastStatusChange DateTime?
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @default(now())

  @@map("system_settings")
}

model TaskActivity {
  id          String   @id
  taskId      String
  userId      String
  action      String
  field       String?
  oldValue    String?  @db.Text
  newValue    String?  @db.Text
  description String?  @db.Text
  companyId   String
  createdAt   DateTime @default(now())
  companies   Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  tasks       Task     @relation(fields: [taskId], references: [id], onDelete: Cascade)
  users       User     @relation(fields: [userId], references: [id])

  @@index([companyId])
  @@index([createdAt])
  @@index([taskId])
  @@index([userId])
  @@map("task_activities")
}

model TaskAttachment {
  id            String   @id
  taskId        String
  userId        String
  fileName      String
  originalName  String
  fileSize      Int
  fileType      String
  filePath      String
  downloadCount Int      @default(0)
  companyId     String
  createdAt     DateTime @default(now())
  companies     Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  tasks         Task     @relation(fields: [taskId], references: [id], onDelete: Cascade)
  users         User     @relation(fields: [userId], references: [id])

  @@index([companyId])
  @@index([taskId])
  @@index([userId])
  @@map("task_attachments")
}

model TaskChecklistItem {
  id            String        @id
  checklistId   String
  content       String
  isCompleted   Boolean       @default(false)
  completedAt   DateTime?
  completedBy   String?
  position      Int           @default(0)
  createdAt     DateTime      @default(now())
  updatedAt     DateTime
  taskChecklist TaskChecklist @relation(fields: [checklistId], references: [id], onDelete: Cascade)
  users         User?         @relation(fields: [completedBy], references: [id])

  @@index([checklistId])
  @@index([completedBy])
  @@map("task_checklist_items")
}

model TaskChecklist {
  id                 String              @id
  taskId             String
  title              String
  position           Int                 @default(0)
  companyId          String
  createdAt          DateTime            @default(now())
  updatedAt          DateTime
  taskChecklistItems TaskChecklistItem[]
  companies          Company             @relation(fields: [companyId], references: [id], onDelete: Cascade)
  tasks              Task                @relation(fields: [taskId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([taskId])
  @@map("task_checklists")
}

model TaskComment {
  id                  String        @id
  taskId              String
  userId              String
  content             String        @db.Text
  parentCommentId     String?
  mentions            String?       @db.LongText
  isEdited            Boolean       @default(false)
  editedAt            DateTime?
  companyId           String
  createdAt           DateTime      @default(now())
  updatedAt           DateTime
  companies           Company       @relation(fields: [companyId], references: [id], onDelete: Cascade)
  taskComment         TaskComment?  @relation("task_commentsTotask_comments", fields: [parentCommentId], references: [id])
  other_task_comments TaskComment[] @relation("task_commentsTotask_comments")
  tasks               Task          @relation(fields: [taskId], references: [id], onDelete: Cascade)
  users               User          @relation(fields: [userId], references: [id])

  @@index([companyId])
  @@index([parentCommentId])
  @@index([taskId])
  @@index([userId])
  @@map("task_comments")
}

model TaskDependency {
  id                                         String   @id
  taskId                                     String
  dependsOnId                                String
  type                                       String   @default("blocked_by")
  companyId                                  String
  createdAt                                  DateTime @default(now())
  companies                                  Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  tasks_task_dependencies_dependsOnIdTotasks Task     @relation("task_dependencies_dependsOnIdTotasks", fields: [dependsOnId], references: [id], onDelete: Cascade)
  tasks_task_dependencies_taskIdTotasks      Task     @relation("task_dependencies_taskIdTotasks", fields: [taskId], references: [id], onDelete: Cascade)

  @@unique([taskId, dependsOnId])
  @@index([companyId])
  @@index([dependsOnId])
  @@index([taskId])
  @@map("task_dependencies")
}

model TaskNotification {
  id        String    @id
  userId    String
  taskId    String?
  projectId String?
  type      String
  title     String
  message   String    @db.Text
  isRead    Boolean   @default(false)
  readAt    DateTime?
  link      String?
  companyId String
  createdAt DateTime  @default(now())
  companies Company   @relation(fields: [companyId], references: [id], onDelete: Cascade)
  users     User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([createdAt])
  @@index([isRead])
  @@index([userId])
  @@map("task_notifications")
}

model TaskTemplate {
  id              String                       @id
  name            String
  description     String?                      @db.Text
  defaultStatus   TaskTemplatesDefaultStatus   @default(PENDING)
  defaultPriority TaskTemplatesDefaultPriority @default(MEDIUM)
  type            String                       @default("general")
  estimatedHours  Int                          @default(0)
  tags            String?                      @db.LongText
  checklist       String?                      @db.LongText
  isPublic        Boolean                      @default(false)
  createdBy       String
  companyId       String
  createdAt       DateTime                     @default(now())
  updatedAt       DateTime
  companies       Company                      @relation(fields: [companyId], references: [id], onDelete: Cascade)
  users           User                         @relation(fields: [createdBy], references: [id])

  @@index([companyId])
  @@index([createdBy])
  @@map("task_templates")
}

model TaskWatcher {
  id        String   @id
  taskId    String
  userId    String
  companyId String
  createdAt DateTime @default(now())
  companies Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  tasks     Task     @relation(fields: [taskId], references: [id], onDelete: Cascade)
  users     User     @relation(fields: [userId], references: [id])

  @@unique([taskId, userId])
  @@index([companyId])
  @@index([taskId])
  @@index([userId])
  @@map("task_watchers")
}

model Task {
  id                                                     String           @id
  projectId                                              String?
  title                                                  String
  description                                            String           @db.Text
  status                                                 TasksStatus      @default(PENDING)
  priority                                               TasksPriority    @default(MEDIUM)
  type                                                   String           @default("general")
  assignedTo                                             String
  createdBy                                              String
  dueDate                                                DateTime?
  estimatedHours                                         Int              @default(0)
  actualHours                                            Int              @default(0)
  progress                                               Int              @default(0)
  tags                                                   String?          @db.LongText
  dependencies                                           String?          @db.LongText
  companyId                                              String
  createdAt                                              DateTime         @default(now())
  updatedAt                                              DateTime
  categoryId                                             String?
  color                                                  String?
  completedDate                                          DateTime?
  isRecurring                                            Boolean          @default(false)
  order                                                  Int              @default(0)
  parentTaskId                                           String?
  recurringRule                                          String?          @db.LongText
  startDate                                              DateTime?
  taskActivities                                         TaskActivity[]
  taskAttachments                                        TaskAttachment[]
  taskChecklists                                         TaskChecklist[]
  taskComments                                           TaskComment[]
  task_dependencies_task_dependencies_dependsOnIdTotasks TaskDependency[] @relation("task_dependencies_dependsOnIdTotasks")
  task_dependencies_task_dependencies_taskIdTotasks      TaskDependency[] @relation("task_dependencies_taskIdTotasks")
  taskWatchers                                           TaskWatcher[]
  users_tasks_assignedToTousers                          User             @relation("tasks_assignedToTousers", fields: [assignedTo], references: [id])
  taskCategory                                           TaskCategory?    @relation(fields: [categoryId], references: [id])
  companies                                              Company          @relation(fields: [companyId], references: [id], onDelete: Cascade)
  users_tasks_createdByTousers                           User             @relation("tasks_createdByTousers", fields: [createdBy], references: [id])
  tasks                                                  Task?            @relation("tasksTotasks", fields: [parentTaskId], references: [id])
  other_tasks                                            Task[]           @relation("tasksTotasks")
  projects                                               Project?         @relation(fields: [projectId], references: [id])
  time_entries                                           TimeEntry[]

  @@index([assignedTo])
  @@index([categoryId])
  @@index([companyId])
  @@index([createdBy])
  @@index([dueDate])
  @@index([order])
  @@index([parentTaskId])
  @@index([priority])
  @@index([projectId])
  @@index([status])
}

model TelegramConfig {
  id            String   @id
  companyId     String
  botToken      String?  @db.Text
  botName       String?
  botUsername   String?
  apiId         String?  @db.Text
  apiHash       String?  @db.Text
  isActive      Boolean  @default(false)
  clientSession String?  @db.Text
  clientPhone   String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime
  label         String   @default("Official Bot")
  sessionString String?  @db.Text
  type          String   @default("BOT")
  companies     Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@unique([companyId, type])
  @@index([companyId])
  @@index([type])
  @@map("telegram_configs")
}

model TextGallery {
  id        String   @id
  userId    String
  companyId String
  title     String?
  content   String   @db.Text
  imageUrls String?  @db.LongText
  createdAt DateTime @default(now())
  updatedAt DateTime
  isPinned  Boolean  @default(false)
  companies Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  users     User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([createdAt])
  @@index([userId])
  @@map("text_gallery")
}

model TimeEntry {
  id          String    @id
  taskId      String
  userId      String
  startTime   DateTime
  endTime     DateTime?
  duration    Int       @default(0)
  description String?   @db.Text
  isBillable  Boolean   @default(false)
  hourlyRate  Decimal?  @db.Decimal(10, 2)
  isRunning   Boolean   @default(false)
  companyId   String
  createdAt   DateTime  @default(now())
  updatedAt   DateTime
  companies   Company   @relation(fields: [companyId], references: [id], onDelete: Cascade)
  tasks       Task      @relation(fields: [taskId], references: [id], onDelete: Cascade)
  users       User      @relation(fields: [userId], references: [id])

  @@index([companyId])
  @@index([startTime])
  @@index([taskId])
  @@index([userId])
}

model WalletNumber {
  id              String           @id
  name            String
  number          String
  isActive        Boolean          @default(true)
  icon            String
  color           String
  createdAt       DateTime         @default(now())
  updatedAt       DateTime
  paymentReceipts PaymentReceipt[]

  @@map("wallet_numbers")
}

model WhatsAppContact {
  id              String          @id
  sessionId       String
  jid             String
  phoneNumber     String
  name            String?
  pushName        String?
  profilePicUrl   String?         @db.Text
  isGroup         Boolean         @default(false)
  isBlocked       Boolean         @default(false)
  customerId      String?
  category        String?         @default("LEAD")
  tags            String?         @db.Text
  notes           String?         @db.Text
  lastMessageAt   DateTime?
  unreadCount     Int             @default(0)
  totalMessages   Int             @default(0)
  isArchived      Boolean         @default(false)
  isPinned        Boolean         @default(false)
  isMuted         Boolean         @default(false)
  createdAt       DateTime        @default(now())
  updatedAt       DateTime
  customers       Customer?       @relation(fields: [customerId], references: [id])
  whatsAppSession WhatsAppSession @relation(fields: [sessionId], references: [id], onDelete: Cascade)

  @@unique([sessionId, jid])
  @@index([category])
  @@index([customerId])
  @@index([lastMessageAt])
  @@index([phoneNumber])
  @@index([sessionId])
  @@map("whatsapp_contacts")
}

model WhatsAppEventLog {
  id        String   @id
  sessionId String
  companyId String
  eventType String
  eventData String?  @db.Text
  level     String   @default("info")
  createdAt DateTime @default(now())

  @@index([companyId])
  @@index([createdAt])
  @@index([eventType])
  @@index([sessionId])
  @@map("whatsapp_event_logs")
}

model WhatsAppMessage {
  id              String                      @id
  sessionId       String
  remoteJid       String
  messageId       String                      @unique
  fromMe          Boolean
  messageType     WhatsAppMessagesMessageType @default(TEXT)
  content         String?                     @db.Text
  mediaUrl        String?                     @db.Text
  mediaType       String?
  mediaMimeType   String?
  mediaSize       Int?
  mediaFileName   String?
  quotedMessageId String?
  quotedContent   String?                     @db.Text
  status          WhatsAppMessagesStatus      @default(SENT)
  timestamp       DateTime
  isAIResponse    Boolean                     @default(false)
  aiConfidence    Float?
  interactiveData String?                     @db.Text
  metadata        String?                     @db.Text
  createdAt       DateTime                    @default(now())
  updatedAt       DateTime
  senderId        String?
  participant     String?
  users           User?                       @relation(fields: [senderId], references: [id])
  whatsAppSession WhatsAppSession             @relation(fields: [sessionId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([remoteJid])
  @@index([senderId])
  @@index([sessionId])
  @@index([sessionId, remoteJid])
  @@index([sessionId, timestamp])
  @@index([timestamp])
  @@map("whatsapp_messages")
}

model WhatsAppQuickReply {
  id         String    @id
  companyId  String
  title      String
  shortcut   String?
  content    String    @db.Text
  category   String    @default("general")
  variables  String?   @db.Text
  mediaUrl   String?   @db.Text
  mediaType  String?
  usageCount Int       @default(0)
  lastUsedAt DateTime?
  isActive   Boolean   @default(true)
  sortOrder  Int       @default(0)
  createdAt  DateTime  @default(now())
  updatedAt  DateTime
  companies  Company   @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@unique([companyId, shortcut])
  @@index([category])
  @@index([companyId])
  @@index([isActive])
  @@map("whatsapp_quick_replies")
}

model WhatsAppSession {
  id                  String                 @id
  companyId           String
  name                String
  phoneNumber         String?
  status              WhatsAppSessionsStatus @default(DISCONNECTED)
  lastConnectedAt     DateTime?
  lastDisconnectedAt  DateTime?
  authState           String?                @db.LongText
  isDefault           Boolean                @default(false)
  aiEnabled           Boolean                @default(true)
  autoReply           Boolean                @default(false)
  aiMode              String                 @default("suggest")
  welcomeMessage      String?                @db.Text
  awayMessage         String?                @db.Text
  workingHoursEnabled Boolean                @default(false)
  workingHours        String?                @db.Text
  metadata            String?                @db.Text
  createdAt           DateTime               @default(now())
  updatedAt           DateTime
  profileName         String?
  profilePictureUrl   String?                @db.Text
  profileStatus       String?
  whatsAppContacts    WhatsAppContact[]
  whatsAppMessages    WhatsAppMessage[]
  companies           Company                @relation(fields: [companyId], references: [id], onDelete: Cascade)
  whatsAppStatuses    WhatsAppStatuse[]

  @@index([companyId])
  @@index([phoneNumber])
  @@index([status])
  @@map("whatsapp_sessions")
}

model WhatsAppSettings {
  id                   String   @id
  companyId            String   @unique
  isEnabled            Boolean  @default(true)
  maxSessions          Int      @default(3)
  notificationSound    Boolean  @default(true)
  browserNotifications Boolean  @default(true)
  defaultAIMode        String   @default("suggest")
  aiWelcomeEnabled     Boolean  @default(false)
  aiAwayEnabled        Boolean  @default(false)
  maxImageSize         Int      @default(16)
  maxVideoSize         Int      @default(64)
  maxDocumentSize      Int      @default(100)
  autoCompressImages   Boolean  @default(true)
  autoArchiveDays      Int?
  metadata             String?  @db.Text
  createdAt            DateTime @default(now())
  updatedAt            DateTime
  companies            Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@map("whatsapp_settings")
}

model WhatsAppStatuse {
  id              String             @id
  sessionId       String
  remoteJid       String
  messageId       String             @unique
  type            WhatsAppStatusType @default(TEXT)
  content         String?            @db.Text
  mediaUrl        String?            @db.Text
  mediaType       String?
  mediaMimeType   String?
  timestamp       DateTime
  expiresAt       DateTime
  isViewed        Boolean            @default(false)
  viewedAt        DateTime?
  metadata        String?            @db.Text
  createdAt       DateTime           @default(now())
  updatedAt       DateTime
  whatsAppSession WhatsAppSession    @relation(fields: [sessionId], references: [id], onDelete: Cascade)

  @@index([expiresAt])
  @@index([remoteJid])
  @@index([sessionId])
  @@index([timestamp])
  @@map("whatsapp_statuses")
}

model Faq {
  id                   String    @id
  companyId            String
  question             String    @db.Text
  answer               String    @db.Text
  category             String    @default("general")
  tags                 String?   @db.Text
  order                Int       @default(0)
  helpful              Int       @default(0)
  notHelpful           Int       @default(0)
  isActive             Boolean   @default(true)
  version              Int       @default(1)
  createdAt            DateTime  @default(now())
  updatedAt            DateTime
  embedding            String?   @db.Text
  embeddingGeneratedAt DateTime?
  companies            Company   @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([category])
  @@index([companyId])
  @@index([companyId, isActive])
  @@index([isActive])
  @@map("faqs")
}

model RagPerformance {
  id            String   @id
  companyId     String
  operation     String
  responseTime  Int
  tokensUsed    Int?
  cacheHit      Boolean  @default(false)
  errorOccurred Boolean  @default(false)
  errorMessage  String?  @db.Text
  metadata      String?  @db.Text
  createdAt     DateTime @default(now())

  @@index([companyId, createdAt])
  @@index([companyId])
  @@index([errorOccurred])
  @@index([operation])
  @@map("rag_performance")
}

model RagRateLimit {
  id           String   @id
  companyId    String
  ipAddress    String?
  requestType  String   @default("search")
  requestCount Int      @default(1)
  windowStart  DateTime @default(now())
  createdAt    DateTime @default(now())
  updatedAt    DateTime

  @@unique([companyId, ipAddress, windowStart])
  @@index([companyId])
  @@index([ipAddress])
  @@index([windowStart])
  @@map("rag_rate_limits")
}

model ReturnReason {
  id                   String                @id
  reason               String
  description          String?
  companyId            String
  isActive             Boolean               @default(true)
  createdAt            DateTime              @default(now())
  updatedAt            DateTime
  categoryId           String?
  returnReasonCategory ReturnReasonCategory? @relation(fields: [categoryId], references: [id])
  companies            Company               @relation(fields: [companyId], references: [id], onDelete: Cascade)
  returnRequests       ReturnRequest[]

  @@index([categoryId])
  @@index([companyId])
  @@map("return_reasons")
}

model ReturnRequest {
  id                    String                         @id
  orderId               String
  customerId            String
  companyId             String
  reasonId              String
  status                ReturnRequestsStatus           @default(PENDING)
  adminNotes            String?                        @db.Text
  customerNotes         String?                        @db.Text
  refundAmount          Decimal?                       @db.Decimal(10, 2)
  assignedTo            String?
  createdAt             DateTime                       @default(now())
  updatedAt             DateTime
  isReviewed            Boolean                        @default(false)
  orderItemId           String?
  rejectionReason       String?                        @db.Text
  responsibleParty      ReturnRequestsResponsibleParty @default(OTHER)
  reviewedAt            DateTime?
  reviewedBy            String?
  returnActivityLogs    ReturnActivityLog[]
  returnContactAttempts ReturnContactAttempt[]
  users                 User?                          @relation(fields: [assignedTo], references: [id])
  companies             Company                        @relation(fields: [companyId], references: [id], onDelete: Cascade)
  customers             Customer                       @relation(fields: [customerId], references: [id], onDelete: Cascade)
  orders                Order                          @relation(fields: [orderId], references: [id], onDelete: Cascade)
  returnReason          ReturnReason                   @relation(fields: [reasonId], references: [id])

  @@index([assignedTo])
  @@index([companyId])
  @@index([customerId])
  @@index([orderId])
  @@index([reasonId])
  @@index([status])
  @@map("return_requests")
}

model ReturnSettings {
  id                 String   @id
  companyId          String   @unique
  excellentThreshold Int      @default(90)
  goodThreshold      Int      @default(70)
  minOrdersForRating Int      @default(3)
  autoApproveScore   Int      @default(95)
  enableAutoApproval Boolean  @default(false)
  createdAt          DateTime @default(now())
  updatedAt          DateTime
  companies          Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@map("return_settings")
}

model ReturnContactAttempt {
  id              String        @id
  returnRequestId String
  userId          String
  method          String
  result          String
  notes           String?       @db.Text
  createdAt       DateTime      @default(now())
  returnRequest   ReturnRequest @relation(fields: [returnRequestId], references: [id], onDelete: Cascade)
  users           User          @relation(fields: [userId], references: [id])

  @@index([returnRequestId])
  @@index([userId])
  @@map("return_contact_attempts")
}

model ReturnActivityLog {
  id              String        @id
  returnRequestId String
  userId          String?
  action          String
  details         String?       @db.Text
  createdAt       DateTime      @default(now())
  returnRequest   ReturnRequest @relation(fields: [returnRequestId], references: [id], onDelete: Cascade)
  users           User?         @relation(fields: [userId], references: [id])

  @@index([returnRequestId])
  @@index([userId])
  @@map("return_activity_logs")
}

model ImageStudioSettings {
  id                  String   @id
  enabled             Boolean  @default(true)
  basicModelName      String   @default("gemini-2.5-flash-image")
  proModelName        String   @default("gemini-3-pro-image-preview")
  defaultModel        String   @default("basic")
  maxImagesPerRequest Int      @default(1)
  maxRequestsPerDay   Int      @default(50)
  allowedCompanies    String?  @db.Text
  createdAt           DateTime @default(now())
  updatedAt           DateTime
  selectedKeyId       String?

  @@map("image_studio_settings")
}

model ImageStudioUsage {
  id               String   @id
  companyId        String
  date             DateTime @db.Date
  basicImagesCount Int      @default(0)
  proImagesCount   Int      @default(0)
  totalImagesCount Int      @default(0)
  createdAt        DateTime @default(now())
  updatedAt        DateTime
  companies        Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@unique([companyId, date])
  @@index([companyId])
  @@index([date])
  @@map("image_studio_usage")
}

model ImageStudioHistory {
  id           String   @id
  companyId    String
  userId       String
  prompt       String   @db.Text
  modelType    String
  modelName    String
  imageUrl     String?
  status       String   @default("pending")
  errorMessage String?  @db.Text
  metadata     String?  @db.Text
  createdAt    DateTime @default(now())
  updatedAt    DateTime
  companies    Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  users        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([createdAt])
  @@index([status])
  @@index([userId])
  @@map("image_studio_history")
}

model DevTeamMember {
  id                                               String            @id
  userId                                           String            @unique
  role                                             String            @default("developer")
  department                                       String?
  skills                                           String?           @db.LongText
  availability                                     String            @default("available")
  isActive                                         Boolean           @default(true)
  createdAt                                        DateTime          @default(now())
  updatedAt                                        DateTime
  level                                            Int               @default(1)
  xp                                               Int               @default(0)
  dailyTarget                                      Int?
  hourlyRate                                       Decimal?          @db.Decimal(10, 2)
  weeklyTarget                                     Int?
  ai_chat_sessions                                 AIChatSession[]
  dev_member_badges                                DevMemberBadge[]
  dev_notifications                                DevNotification[]
  dev_projects                                     DevProject[]
  devTaskActivities                                DevTaskActivity[]
  devTaskComments                                  DevTaskComment[]
  devTaskWatchers                                  DevTaskWatcher[]
  dev_tasks_dev_tasks_assigneeIdTodev_team_members DevTask[]         @relation("dev_tasks_assigneeIdTodev_team_members")
  dev_tasks_dev_tasks_reporterIdTodev_team_members DevTask[]         @relation("dev_tasks_reporterIdTodev_team_members")
  users                                            User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  devTimeLogs                                      DevTimeLog[]

  companyRel   Company? @relation(fields: [companyRelId], references: [id])
  companyRelId String?

  @@index([isActive])
  @@index([role])
  @@index([userId])
  @@map("dev_team_members")
}

model DevTimeLog {
  id               String        @id
  taskId           String
  memberId         String
  startTime        DateTime
  endTime          DateTime?
  duration         Int           @default(0)
  description      String?       @db.Text
  isBillable       Boolean       @default(false)
  isRunning        Boolean       @default(false)
  createdAt        DateTime      @default(now())
  updatedAt        DateTime
  activityType     String?
  isPaused         Boolean       @default(false)
  pauseDuration    Int           @default(0)
  pauseHistory     String?       @db.LongText
  pausedAt         DateTime?
  dev_team_members DevTeamMember @relation(fields: [memberId], references: [id])
  dev_tasks        DevTask       @relation(fields: [taskId], references: [id], onDelete: Cascade)

  @@index([isPaused])
  @@index([isRunning])
  @@index([memberId])
  @@index([taskId])
  @@map("dev_time_logs")
}

model WalletTransaction {
  id            String                @id @default(cuid())
  walletId      String
  type          WalletTransactionType
  amount        Float
  balanceBefore Float
  balanceAfter  Float
  orderId       String?
  description   String
  metadata      String?               @db.Text
  createdAt     DateTime              @default(now())

  wallet CustomerWallet @relation(fields: [walletId], references: [id], onDelete: Cascade)
  order  Order?         @relation(fields: [orderId], references: [id], onDelete: SetNull)

  @@index([walletId])
  @@index([type])
  @@index([createdAt])
  @@map("wallet_transactions")
}

model Appointment {
  id              String   @id @default(cuid())
  companyId       String
  customerId      String?
  customerName    String
  customerEmail   String?
  customerPhone   String?
  staffId         String
  staffName       String
  title           String
  description     String?  @db.Text
  appointmentDate DateTime @db.Date
  startTime       String // Format: "HH:mm"
  endTime         String? // Format: "HH:mm"
  duration        Int      @default(30) // in minutes
  status          String   @default("pending") // pending, confirmed, completed, cancelled, no_show
  type            String   @default("consultation") // consultation, training, meeting, demo
  location        String?
  meetingLink     String?  @db.Text
  notes           String?  @db.Text
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  company  Company   @relation(fields: [companyId], references: [id], onDelete: Cascade)
  customer Customer? @relation(fields: [customerId], references: [id], onDelete: SetNull)

  @@index([companyId])
  @@index([customerId])
  @@index([staffId])
  @@index([appointmentDate])
  @@index([status])
  @@map("appointments")
}

model CallAttemptLog {
  id        String   @id
  orderId   String
  userId    String
  result    String?
  notes     String?
  createdAt DateTime @default(now())
  orders    Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  users     User     @relation(fields: [userId], references: [id])

  @@index([orderId])
  @@index([userId])
  @@map("call_attempt_logs")
}


model EmployeeNotificationPreference {
  id                 String   @id
  companyId          String
  employeeId         String
  phone              String
  attendanceReminder Boolean  @default(true)
  leaveUpdates       Boolean  @default(true)
  payrollNotice      Boolean  @default(true)
  birthdayWish       Boolean  @default(true)
  announcements      Boolean  @default(true)
  isOptedIn          Boolean  @default(true)
  createdAt          DateTime @default(now())
  updatedAt          DateTime
  companies          Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@unique([companyId, employeeId])
  @@unique([companyId, phone])
  @@map("employee_notification_preferences")
}

model StoreVisit {
  id          String   @id @default(cuid())
  companyId   String
  sessionId   String
  ipAddress   String?
  userAgent   String?  @db.Text
  referrer    String?  @db.Text
  landingPage String?  @db.Text
  visitedAt   DateTime @default(now())
  duration    Int?
  pagesViewed Int      @default(1)
  company     Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId, visitedAt])
  @@index([sessionId, companyId])
  @@map("store_visits")
}

model DevMemberBadge {
  id        String        @id @default(cuid())
  memberId  String
  badgeCode String
  earnedAt  DateTime      @default(now())
  member    DevTeamMember @relation(fields: [memberId], references: [id], onDelete: Cascade)

  @@index([memberId])
  @@map("dev_member_badges")
}

model MarketplaceApp {
  id          String  @id @default(cuid())
  slug        String  @unique
  name        String
  description String  @db.Text
  logo        String?
  images      Json?

  monthlyPrice Decimal @db.Decimal(10, 2)
  yearlyPrice  Decimal @db.Decimal(10, 2)

  features Json?

  isActive   Boolean @default(true)
  isPublic   Boolean @default(true)
  isFeatured Boolean @default(false)

  installations CompanyApp[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  mainRoute  String?
  adminRoute String?

  category String @default("general")

  reviews      AppReview[]
  pricingRules AppPricingRule[]

  rating      Float @default(0)
  reviewCount Int   @default(0)
  installCount Int  @default(0)
  isPopular    Boolean @default(false)
  requiredApps Json?
  trialDays    Int      @default(14)
  icon         String?

  @@map("marketplace_apps")
}

model CompanyApp {
  id        String @id @default(cuid())
  companyId String
  appId     String

  status String @default("ACTIVE") // ACTIVE, TRIAL, CANCELLED, EXPIRED

  trialEndsAt DateTime?
  validUntil  DateTime?

  settings Json?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  company Company        @relation(fields: [companyId], references: [id], onDelete: Cascade)
  app     MarketplaceApp @relation(fields: [appId], references: [id], onDelete: Cascade)

  usageLogs AppUsageLog[]

  @@unique([companyId, appId])
  @@map("company_apps")
}

model AppUsageLog {
  id           String     @id @default(cuid())
  companyAppId String
  feature      String?
  quantity     Int        @default(1)
  totalCost    Decimal    @default(0) @db.Decimal(10, 2)
  metadata     Json?
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt

  companyApp   CompanyApp @relation(fields: [companyAppId], references: [id], onDelete: Cascade)

  @@index([companyAppId])
  @@index([createdAt])
  @@index([feature])
  @@map("app_usage_logs")
}

model AppReview {
  id        String   @id @default(cuid())
  appId     String
  companyId String
  userId    String
  rating    Int
  title     String?
  comment   String?  @db.Text
  isVerified Boolean @default(false)
  isPublished Boolean @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  app     MarketplaceApp @relation(fields: [appId], references: [id], onDelete: Cascade)
  company Company        @relation(fields: [companyId], references: [id], onDelete: Cascade)
  user    User           @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([appId, companyId])
  @@index([appId])
  @@index([companyId])
  @@index([userId])
  @@map("app_reviews")
}

model AppPricingRule {
  id        String   @id @default(cuid())
  appId     String
  name      String
  condition Json
  action    Json
  priority  Int      @default(0)
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  app MarketplaceApp @relation(fields: [appId], references: [id], onDelete: Cascade)

  @@index([appId])
  @@map("app_pricing_rules")
}

model AppBundle {
  id          String  @id @default(cuid())
  slug        String  @unique
  name        String
  nameEn      String?
  description String  @db.Text

  appIds Json

  monthlyPrice Decimal  @db.Decimal(10, 2)
  yearlyPrice  Decimal? @db.Decimal(10, 2)

  discount Decimal @db.Decimal(5, 2)

  isActive   Boolean @default(true)
  isFeatured Boolean @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([slug])
  @@index([isActive])
  @@map("app_bundles")
}

model CompanyWallet {
  id        String  @id @default(cuid())
  companyId String  @unique
  balance   Decimal @default(0) @db.Decimal(10, 2)
  currency  String  @default("EGP")

  updatedAt DateTime @updatedAt

  company      Company       @relation(fields: [companyId], references: [id], onDelete: Cascade)
  transactions Transaction[]

  @@map("company_wallets")
}

model Transaction {
  id          String  @id @default(cuid())
  walletId    String
  amount      Decimal @db.Decimal(10, 2)
  type        String // DEPOSIT, WITHDRAWAL, PAYMENT, REFUND
  status      String  @default("COMPLETED")
  description String?
  referenceId String?

  createdAt DateTime @default(now())

  wallet CompanyWallet @relation(fields: [walletId], references: [id], onDelete: Cascade)

  @@index([walletId])
  @@map("transactions")
}